<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>infiniterelic</title>
    <style>
        /* 以前の安定したスタイルを保持 */
        body { background-color: #000; color: #ccc; font-family: sans-serif; margin: 0; padding: 10px; display: flex; flex-direction: column; align-items: center; }
        #stats { width: 100%; max-width: 500px; display: flex; justify-content: space-between; margin-bottom: 10px; font-size: 14px; }
        #hp-container { width: 100%; max-width: 500px; height: 20px; background: #220000; border: 1px solid #440000; margin-bottom: 20px; }
        #hp-bar { height: 100%; background: #ff0000; width: 100%; }
        #battle-area { text-align: center; margin-bottom: 20px; }
        #click-btn { width: 120px; height: 120px; border-radius: 50%; border: 1px solid #555; background: #111; color: #888; cursor: pointer; }
        #log { width: 100%; max-width: 500px; height: 150px; background: #050505; border: 1px solid #333; overflow-y: auto; font-size: 12px; padding: 5px; }
        .tab-content { display: none; width: 100%; max-width: 500px; margin-top: 20px; border-top: 1px solid #333; padding-top: 10px; }
        .show { display: block; }
        
        /* ドロップ率のみ指定通り強調 */
        .rate-table { width: 100%; font-family: monospace; }
        .rate-table td { padding: 2px 5px; font-size: 1.2em; font-weight: bold; }
        .rate-num { text-align: right; }
    </style>
</head>
<body>

<div id="stats">
    <div>ATK: <span id="atk">10</span></div>
    <div>HP: <span id="hp">100</span></div>
    <div>再起: <span id="rebirth">0</span></div>
</div>
<div id="stats" style="font-size: 12px; color: #888;">
    <div>Max Damage: <span id="max-dmg">0</span></div>
</div>

<div id="hp-container"><div id="hp-bar"></div></div>

<div id="battle-area">
    <div style="margin-bottom: 10px; color: #666;">― 魔神 ―</div>
    <button id="click-btn" onclick="attack()">こうげき</button>
</div>

<div id="log"></div>

<div style="margin-top: 10px;">
    <button onclick="showTab('log-tab')">ログ</button>
    <button onclick="showTab('info-tab')">詳細</button>
</div>

<div id="info-tab" class="tab-content">
    <h3>死を刻む</h3>
    <p>再起1回につきダメージ+0.004%</p>
    <p>現在の補正: <span id="death-val">0</span>%</p>
    
    <h3>魂の研磨</h3>
    <p>再起1万回ごとに固定ドロップ枠+1</p>

    <h3>ドロップ確率</h3>
    <table class="rate-table">
        <tr><td>★1</td><td class="rate-num">81.88888%</td></tr>
        <tr><td>★2</td><td class="rate-num">12%</td></tr>
        <tr><td>★3</td><td class="rate-num">5%</td></tr>
        <tr><td>★4</td><td class="rate-num">1%</td></tr>
        <tr style="color:#ff0044"><td>★5</td><td class="rate-num">0.1%</td></tr>
        <tr style="color:#0088ff"><td>★6</td><td class="rate-num">0.01%</td></tr>
        <tr style="color:#4b0082"><td>★7</td><td class="rate-num">0.001%</td></tr>
    </table>
</div>

<script>
    const SAVE_KEY = "infiniterelic_v1_base";
    let state = {
        atk: 10, hp: 100, maxHp: 100, rebirth: 0, maxDmg: 0
    };

    function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }
    function load() {
        const data = localStorage.getItem(SAVE_KEY);
        if(data) state = JSON.parse(data);
        update();
    }

    function update() {
        document.getElementById('atk').innerText = Math.floor(state.atk).toLocaleString();
        document.getElementById('hp').innerText = Math.max(0, Math.floor(state.hp)).toLocaleString();
        document.getElementById('rebirth').innerText = state.rebirth.toLocaleString();
        document.getElementById('max-dmg').innerText = Math.floor(state.maxDmg).toLocaleString();
        document.getElementById('death-val').innerText = (state.rebirth * 0.004).toFixed(3);
        document.getElementById('hp-bar').style.width = (state.hp / state.maxHp * 100) + "%";
    }

    function addLog(m) {
        const l = document.getElementById('log');
        l.innerHTML = `<div>${m}</div>` + l.innerHTML;
    }

    function attack() {
        const bonus = 1 + (state.rebirth * 0.00004);
        const dmg = state.atk * bonus;
        if(dmg > state.maxDmg) state.maxDmg = dmg;
        addLog(`${Math.floor(dmg).toLocaleString()} のダメージを与えた。`);
        
        state.hp -= 999999999999;
        if(state.hp <= 0) {
            state.rebirth++;
            const aPlus = Math.max(1, Math.floor(Math.random() * state.rebirth) + 1);
            const hPlus = Math.max(1, Math.floor(Math.random() * state.rebirth * 10) + 1);
            state.atk += aPlus;
            state.maxHp += hPlus;
            state.hp = state.maxHp;
            addLog(`魔神から 999,999,999,999 ダメージを受けた。`);
            addLog(`再起の誓いによって新たなる力を得た`);
            save();
        }
        update();
    }

    function showTab(id) {
        document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('show'));
        if(id === 'info-tab') document.getElementById('info-tab').classList.add('show');
    }

    load();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --death: #6f42c1; --exp: #28a745;
        --rarity0: #868e96; --rarity1: #28a745; --rarity2: #007bff; --rarity3: #a335ee; --rarity4: #ff8000;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 8px 12px; border-bottom: 2px solid var(--border); flex-shrink: 0; font-size: 0.9em; }
    .bar-container { margin-bottom: 6px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.85em; margin-bottom: 2px; font-weight: bold; }
    .bar { height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; border: 1px solid rgba(0,0,0,0.1); }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: linear-gradient(90deg, #28a745, #20c997); }
    #exp-bar { background: var(--primary); }
    #job-exp-bar { background: var(--death); }
    .stats-summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 4px; margin-top: 6px; background: rgba(0,0,0,0.05); padding: 6px; border-radius: 6px; }
    .stat-item { display: flex; justify-content: space-between; font-size: 0.85em; font-weight: bold; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 10px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.75em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    
    /* 職業一覧（2列） */
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding-bottom: 80px; } /* 下部余白を確保 */
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 8px; cursor: pointer; position: relative; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .job-name-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 6px; }
    .job-name-label { font-weight: bold; font-size: 0.9em; }
    .job-desc-label { font-size: 0.75em; color: var(--sub); line-height: 1.3; }
    .mini-btn { padding: 4px 8px; font-size: 0.7em; background: var(--primary); color: #fff; border: none; border-radius: 4px; cursor: pointer; }

    /* 職業詳細（サイズ調整と転職ボタン追加） */
    .detail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #fff; z-index: 20; display: none; flex-direction: column; }
    .detail-header { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); background: var(--panel); }
    .detail-body { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 40px; }
    .job-title-area { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
    .skill-list { display: grid; grid-template-columns: 1fr; gap: 6px; }
    .skill-box { background: #f1f3f5; padding: 8px; border-radius: 6px; font-size: 0.85em; }
    .skill-name { font-weight: bold; color: var(--primary); font-size: 0.9em; }
    .slide-ctrl { display: flex; justify-content: space-between; margin-bottom: 15px; }
    .slide-btn { background: var(--panel); border: 1px solid var(--border); padding: 6px 12px; border-radius: 4px; font-size: 0.8em; font-weight: bold; }
    
    .status-large { font-size: 1.1em; font-weight: bold; padding: 15px; background: #fff; border: 1px solid var(--border); border-radius: 8px; margin-bottom: 10px; line-height: 1.6; }
    .btn-attack { width: 100%; padding: 12px; background: var(--primary); color: #fff; font-size: 1.0em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; }
    #log { flex-grow: 1; margin-top: 6px; overflow-y: auto; font-size: 0.7em; background: #fafafa; padding: 6px; border: 1px solid var(--border); border-radius: 4px; height: 200px; }
    .log-entry { margin-bottom: 1px; border-bottom: 1px solid #eee; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-container">
        <div class="bar-label"><span>魔神</span><span id="bosshp-text">100%</span></div>
        <div class="bar"><div id="bosshp" class="fill"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label"><span>主人公HP</span><span id="playerhp-text">0/0</span></div>
        <div class="bar"><div id="playerhp" class="fill"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label"><span id="p-lv-text">Lv.1 主人公</span><span id="exp-text">0%</span></div>
        <div class="bar"><div id="exp-bar" class="fill"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label"><span id="p-job-text">Lv.1 剣聖</span><span id="job-exp-text">0%</span></div>
        <div class="bar"><div id="job-exp-bar" class="fill"></div></div>
    </div>
    <div class="stats-summary">
        <div class="stat-item"><span>ATK:</span><span id="sum-atk">0</span></div>
        <div class="stat-item"><span>敗北数:</span><span id="sum-death" style="color:var(--death)">0</span></div>
        <div class="stat-item"><span>クリ率:</span><span id="sum-crit">5%</span></div>
        <div class="stat-item"><span>増幅:</span><span id="sum-dmg">100%</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">討伐</button>
    <button onclick="showTab('status', this)">ステータス</button>
    <button onclick="showTab('job', this)">職業</button>
    <button onclick="showTab('equip', this)">遺物</button>
</div>

<div id="content">
    <div id="battle" class="tab active">
        <button class="btn-attack" id="attackBtn">魔神に攻撃</button>
        <div id="log"></div>
    </div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="job" class="tab"><div id="jobList" class="grid-2col"></div></div>
    <div id="equip" class="tab"><div id="relicGrid" class="grid-2col"></div></div>
    
    <div id="detailPanel" class="detail-overlay">
        <div class="detail-header">
            <button onclick="closeDetail()">戻る</button>
            <div style="flex-grow:1; text-align:center; font-weight:bold;">職業詳細</div>
        </div>
        <div class="detail-body">
            <div class="slide-ctrl">
                <button class="slide-btn" onclick="slideJob(-1)">◀ 前の職業</button>
                <button class="slide-btn" onclick="slideJob(1)">次の職業 ▶</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>
</div>

<script>
const BOSS_MAX_HP = 1e24;
const SAVE_KEY = "MAJIN_DPS_V10_100SKILLS"; 

// 10ジョブ × 10スキル = 100スキル
const JOBS_DATA = {
    "神話の剣聖": { desc: "クリティカルと斬撃の極致。圧倒的な単体火力を誇る。", skills: [
        {n:"烈風斬", e:"ATK300%のダメージ。"}, {n:"雷鳴一閃", e:"クリティカル率を2倍にして攻撃。"}, {n:"空破斬", e:"敵の防御を20%貫通する。"}, {n:"奥義・天断", e:"現在のATKの1000%で一刀両断。"}, {n:"神殺しの刃", e:"魔神への最終ダメージ+50%。"},
        {n:"心眼", e:"クリティカルダメージ+100%。"}, {n:"無想転生", e:"攻撃時、5%の確率でダメージ10倍。"}, {n:"次元斬", e:"Lvに応じた固定ダメージを追加。"}, {n:"八相発破", e:"ATK100%の8連撃を放つ。"}, {n:"剣神の加護", e:"全スキルの威力を1.2倍にする。"}
    ]},
    "大聖者": { desc: "敗北（徳）を力に変え、経験値効率を極大化する。", skills: [
        {n:"癒しの光", e:"敗北経験値を20%加算。"}, {n:"守護の結界", e:"遺物の防御力をATKに変換。"}, {n:"天罰の光", e:"敗北数に応じて威力が上昇。"}, {n:"奇跡の風", e:"低確率で全回復（演出）。"}, {n:"聖域の守り", e:"スキル発動率を永続1.1倍。"},
        {n:"慈愛の雨", e:"全ジョブ経験値を+10%底上げ。"}, {n:"福音", e:"Lvアップ時のATK上昇量+50%。"}, {n:"魂の救済", e:"敗北時のATK加算値を+500。"}, {n:"終焉の賛歌", e:"魔神のHPを0.01%削る。"}, {n:"神の領域", e:"全ステータスを1.5倍にする。"}
    ]},
    "賢者魔導王": { desc: "遺物と知恵の融合。倍率計算を支配する。", skills: [
        {n:"火炎球", e:"ATK250%の爆発ダメージ。"}, {n:"氷結槍", e:"固定ダメージをLv×500追加。"}, {n:"落雷", e:"クリティカルダメージを上乗せ。"}, {n:"崩壊の魔印", e:"遺物倍率に0.1倍を加算。"}, {n:"宇宙の真理", e:"全属性ダメージ1.5倍。"},
        {n:"魔力収束", e:"次の攻撃のダメージを2.5倍。"}, {n:"賢者の石", e:"遺物1種につきATK+1%。"}, {n:"深淵の知識", e:"ジョブ経験値効率+200%。"}, {n:"時空崩壊", e:"攻撃間隔を体感10%短縮。"}, {n:"全知全能", e:"全パッシブを1.5%ずつ獲得。"}
    ]},
    "至高の覇王": { desc: "基礎ステータスが最強。存在自体が暴力。", skills: [
        {n:"覇気", e:"最低ダメージ保証を底上げ。"}, {n:"支配の眼光", e:"常に最大打点を出す。"}, {n:"次元の蹂虙", e:"ATK500%の多段ヒット。"}, {n:"覇道一撃", e:"単発1500%ダメージ。"}, {n:"天地開闢", e:"基礎ATKを永続+5000。"},
        {n:"王の凱旋", e:"遺物ドロップ率が2倍になる。"}, {n:"絶対君主", e:"敗北による恩恵を1.5倍に強化。"}, {n:"黄金の夜明け", e:"全ダメージを+100%加算。"}, {n:"蹂躙", e:"クリティカル倍率を固定+2.0。"}, {n:"覇王の証", e:"基礎ATK倍率をさらに2倍。"}
    ]},
    "絶影の暗殺者": { desc: "速攻とクリティカル。一撃必殺のスペシャリスト。", skills: [
        {n:"毒刃乱舞", e:"ATK150%の3連撃。"}, {n:"隠影の術", e:"次のクリ倍率を+100%。"}, {n:"急所穿ち", e:"10%でダメージが即死級に。"}, {n:"影縫い", e:"ATK100%の追撃を発生。"}, {n:"絶命の極意", e:"クリ時、経験値獲得+50%。"},
        {n:"霧隠れ", e:"攻撃速度を永続1.2倍にする。"}, {n:"死の刻印", e:"魔神の耐久力を10%低下。"}, {n:"暗殺の心得", e:"クリ率を常に+50%加算。"}, {n:"不意打ち", e:"攻撃の初撃ダメージを5倍。"}, {n:"闇の理", e:"全スキルの追撃率を2倍。"}
    ]},
    "竜血の修羅": { desc: "レベルと敗北を燃料にする戦闘狂。", skills: [
        {n:"竜の跳躍", e:"Lv×1000の追加ダメージ。"}, {n:"火竜の吐息", e:"ATK200%の持続ダメージ。"}, {n:"闘気爆発", e:"敗北寸前にATKが400%上昇。"}, {n:"無双連撃", e:"1タップで2回攻撃判定。"}, {n:"真・阿修羅", e:"全ダメージをクリティカルに。"},
        {n:"竜鱗の鎧", e:"HP最大値をATKに10%還元。"}, {n:"逆鱗", e:"敗北数による倍率を2倍に。"}, {n:"ドラゴニックATK", e:"Lvに応じてATKが指数増。"}, {n:"滅竜奥義", e:"Lvの2乗をATKに直接加算。"}, {n:"修羅の道", e:"敗北するほど経験値が増加。"}
    ]},
    "真理の錬金術師": { desc: "遺物収集と変換の達人。運を力に変える。", skills: [
        {n:"混合薬液", e:"ランダムステータス100%強化。"}, {n:"等価交換", e:"所持金を経験値に変換。"}, {n:"物質変質", e:"高レア遺物出現率アップ。"}, {n:"黄金律", e:"遺物ドロップが稀に2個に。"}, {n:"賢者の石", e:"全ダメージに遺物数×1.5%ボーナス。"},
        {n:"エリクサー", e:"ジョブLvアップ速度を2倍。"}, {n:"超合金", e:"遺物ATK上昇値を1.3倍に。"}, {n:"万物創生", e:"攻撃時に1%で遺物獲得。"}, {n:"変換の極意", e:"不要な遺物をATKに変換。"}, {n:"真理の扉", e:"全スキルの発動威力を2倍。"}
    ]},
    "神託の吟遊詩人": { desc: "歌で全ステータスを底上げする万能職。", skills: [
        {n:"鎮魂歌", e:"敗北デメリットを無効化。"}, {n:"勇気の賛歌", e:"ATKをLv×200加算。"}, {n:"希望の旋律", e:"経験値バーを3%即座に進める。"}, {n:"終焉の歌", e:"現在HPの0.1%を削る。"}, {n:"共鳴する魂", e:"共鳴スキルの発動率2倍。"},
        {n:"星の歌", e:"全ステータスにLvの200倍加算。"}, {n:"風の詩", e:"攻撃速度を1.3倍にする。"}, {n:"英雄の叙事詩", e:"クリ倍率を常に+1.5。"}, {n:"神々の絶唱", e:"ATK1000%の共鳴ダメージ。"}, {n:"宇宙の調べ", e:"全獲得リソースを+100%。"}
    ]},
    "虚無の死霊使い": { desc: "死（敗北）を重ねるほど無尽蔵に強くなる。", skills: [
        {n:"亡者召喚", e:"敗北数×10の固定ダメージ。"}, {n:"腐食の呪い", e:"ダメージ倍率を1.3倍。"}, {n:"魂の捕食", e:"敵から経験値を直接奪う。"}, {n:"冥府の門", e:"敗北時のATK上昇を2倍。"}, {n:"不死者の王", e:"HPが1残る（演出）。"},
        {n:"死の舞踏", e:"敗北するたびATK+2000。"}, {n:"墓標", e:"敗北数をATK倍率に再利用。"}, {n:"虚無の抱擁", e:"クリ倍率を敗北数×0.01強化。"}, {n:"魂の器", e:"全ジョブの特性を一部継承。"}, {n:"終焉の導き", e:"全ダメージを敗北数に応じて倍増。"}
    ]},
    "魔導機工士": { desc: "機械的な連撃と固定ダメージの暴風雨。", skills: [
        {n:"照準固定", e:"クリ率を+20%固定加算。"}, {n:"自動砲台", e:"ATK50%の追撃×4回。"}, {n:"過負荷稼働", e:"ダメージ倍率を永続+50%。"}, {n:"展開型兵装", e:"遺物効果を1.3倍。"}, {n:"最終兵器", e:"現在Lv×10000の超固定ダメ。"},
        {n:"ブースト", e:"攻撃速度を極大化。"}, {n:"ミサイル発射", e:"Lv×2000の火属性ダメージ。"}, {n:"ナノマシン", e:"全スキル威力+20%加算。"}, {n:"高出力レーザー", e:"ATK800%の貫通攻撃。"}, {n:"オーバークロック", e:"10%でダメージ100倍。"}
    ]}
};

const R_ADJ = ["星辰の", "冥府の", "黄金の", "深淵の", "聖天の", "古の", "虚無の", "永劫の", "混沌の", "因果の"];
const R_CORE = ["竜王", "熾天使", "魔帝", "賢者", "精霊", "狂戦士", "覇道", "極夜", "神光", "奈落"];
const R_OBJ = ["秘石", "紋章", "聖杯", "指輪", "魔冠", "剣片", "盾刻", "首飾り", "宝珠", "断罪"];

function getRelicData(id) {
    const seed = parseInt(id);
    const adj = R_ADJ[seed % 10]; const core = R_CORE[Math.floor(seed / 10) % 10]; const obj = R_OBJ[Math.floor(seed / 25) % 10];
    const rarity = seed % 50 === 0 ? 4 : seed % 20 === 0 ? 3 : seed % 10 === 0 ? 2 : seed % 5 === 0 ? 1 : 0;
    const typeKey = ["ATK", "CRIT", "C_DMG", "FAST"][seed % 4];
    const baseVal = (rarity + 1) * (seed % 5 + 1);
    let effectText = typeKey === "ATK" ? `ATK +${(baseVal * 100).toLocaleString()}` : typeKey === "CRIT" ? `クリ率 +${baseVal}%` : typeKey === "C_DMG" ? `クリ倍率 +${baseVal*10}%` : `経験値 +${baseVal}%`;
    if (seed % 13 === 0) effectText = "敗北数強化";
    return { id, name: adj + core + "の" + obj, effectText, rarity, stars: "★".repeat(rarity + 1) };
}

let p, currentDetailJobIdx = 0, currentBossHP = BOSS_MAX_HP, currentPlayerHP = 0, isProcessing = false, longPressIdx = null;

function fmt(num) { return Math.floor(num).toLocaleString(); }
const nextLv = (l) => Math.pow(l, 3) * 1000;
const nextJobLv = (l) => Math.pow(l, 3) * 500;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, job: "神話の剣聖", inventory: {}, jobLevels: {}, jobExp: {}, deathCount: 0, extraAtk: 0 };
    Object.keys(JOBS_DATA).forEach(j => { if (!p.jobLevels[j]) p.jobLevels[j] = 1; if (p.jobExp[j] === undefined) p.jobExp[j] = 0; });
    currentPlayerHP = calcStats().maxHP;
    const btn = document.getElementById("attackBtn");
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); if(!longPressIdx) { battle(); longPressIdx = setInterval(battle, 100); } });
    btn.addEventListener("touchend", () => { clearInterval(longPressIdx); longPressIdx = null; });
    refresh();
}

function calcStats() {
    let baseAtk = 5000 + (p.lv * 500) + (p.jobLevels[p.job] * 200) + (p.extraAtk || 0);
    if (p.job === "至高の覇王") baseAtk *= 4;
    let stats = { baseAtk, atkRelic: 0, crit: 5, critM: 1.5, deathM: 1.0 + (p.deathCount * 0.01), fast: 1.0, maxHP: 1000 + (p.lv * 100) };
    if (p.job === "神話の剣聖") { stats.crit += 20; stats.critM += 2.0; }
    if (p.job === "絶影の暗殺者") stats.crit += 50;
    Object.keys(p.inventory).forEach(id => {
        const d = getRelicData(id); const count = p.inventory[id];
        const rawVal = (d.rarity + 1) * (parseInt(id) % 5 + 1);
        if (d.effectText.includes("ATK")) stats.atkRelic += rawVal * 100 * count;
        if (d.effectText.includes("クリ率")) stats.crit += rawVal * count;
        if (d.effectText.includes("クリ倍率")) stats.critM += (rawVal * 0.1 * count);
        if (d.effectText.includes("経験値")) stats.fast += (rawVal * 0.01 * count);
    });
    let totalAtk = (stats.baseAtk + stats.atkRelic) * stats.deathM;
    return { ...stats, totalAtk };
}

function battle() {
    if (isProcessing) return; isProcessing = true;
    const stats = calcStats();
    let dmg = Math.floor(stats.totalAtk * (0.9 + Math.random() * 0.2));
    if (Math.random() < (stats.crit / 100)) dmg = Math.floor(dmg * stats.critM);
    currentBossHP -= dmg; addLog(`⚔️ ${fmt(dmg)}`);
    if (currentBossHP <= 0) currentBossHP = BOSS_MAX_HP;
    p.deathCount++; refresh();
    p.exp += Math.floor(dmg * 0.01 * stats.fast) + 10;
    p.jobExp[p.job] += Math.floor(dmg * 0.01 * stats.fast) + 10;
    if (Math.random() < 0.1) { let rId = Math.floor(Math.random() * 250); p.inventory[rId] = (p.inventory[rId] || 0) + 1; }
    while (p.exp >= nextLv(p.lv)) { p.exp -= nextLv(p.lv); p.lv++; }
    while (p.jobExp[p.job] >= nextJobLv(p.jobLevels[p.job])) { p.jobExp[p.job] -= nextJobLv(p.jobLevels[p.job]); p.jobLevels[p.job]++; }
    setTimeout(() => { isProcessing = false; }, 50);
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / BOSS_MAX_HP * 100).toFixed(4) + "%";
    document.getElementById("exp-bar").style.width = (p.exp / nextLv(p.lv) * 100) + "%";
    document.getElementById("job-exp-bar").style.width = (p.jobExp[p.job] / nextJobLv(p.jobLevels[p.job]) * 100) + "%";
    document.getElementById("sum-atk").innerText = fmt(s.totalAtk);
    document.getElementById("sum-death").innerText = fmt(p.deathCount);
    document.getElementById("sum-crit").innerText = s.crit + "%";
    document.getElementById("sum-dmg").innerText = Math.floor(s.deathM * 100) + "%";
    document.getElementById("p-lv-text").innerText = `Lv.${p.lv} 主人公`;
    document.getElementById("p-job-text").innerText = `Lv.${p.jobLevels[p.job]} ${p.job}`;
    if (document.getElementById("job").classList.contains("active")) renderJobs();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderJobs() {
    const list = document.getElementById("jobList");
    const jobs = Object.keys(JOBS_DATA);
    list.innerHTML = jobs.map((j, idx) => `
        <div class="card-cell" onclick="openJobDetailByIdx(${idx})">
            <div class="job-name-row">
                <span class="job-name-label">${j}</span>
                <button class="mini-btn" onclick="event.stopPropagation(); changeJob('${j}')">転職</button>
            </div>
            <div class="job-desc-label">${JOBS_DATA[j].desc}</div>
            <div style="font-size:0.65em; margin-top:4px; color:var(--death)">Lv.${p.jobLevels[j]}</div>
        </div>`).join("");
}

function openJobDetailByIdx(idx) {
    currentDetailJobIdx = idx;
    const jName = Object.keys(JOBS_DATA)[currentDetailJobIdx];
    const d = JOBS_DATA[jName];
    document.getElementById("detailContent").innerHTML = `
        <div class="job-title-area">
            <div>
                <h2 style="margin:0; font-size:1.2em;">${jName}</h2>
                <div style="font-size:0.8em; color:var(--sub);">Job Level: ${p.jobLevels[jName]}</div>
            </div>
            <button class="btn-attack" style="width:auto; padding:8px 15px;" onclick="changeJob('${jName}')">この職に転職</button>
        </div>
        <p style="font-size:0.85em; border-left:3px solid var(--primary); padding-left:10px; margin-bottom:15px;">${d.desc}</p>
        <div class="skill-list">
            ${d.skills.map((s,i)=>`<div class="skill-box"><span class="skill-name">No.${i+1} ${s.n}</span><br>${s.e}</div>`).join("")}
        </div>`;
    document.getElementById("detailPanel").style.display = "flex";
}

function slideJob(dir) {
    const jobs = Object.keys(JOBS_DATA);
    currentDetailJobIdx = (currentDetailJobIdx + dir + jobs.length) % jobs.length;
    openJobDetailByIdx(currentDetailJobIdx);
}

function changeJob(jName) { p.job = jName; closeDetail(); refresh(); }
function addLog(m) { const l = document.getElementById("log"); const d = document.createElement("div"); d.className = "log-entry"; d.innerHTML = m; l.prepend(d); if (l.childNodes.length > 20) l.removeChild(l.lastChild); }
function showTab(id, btn) { document.querySelectorAll(".tab").forEach(t => t.classList.remove("active")); document.getElementById(id).classList.add("active"); document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active")); btn.classList.add("active"); refresh(); }
function closeDetail() { document.getElementById("detailPanel").style.display = "none"; }

init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic_debug</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --hp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .bar-container { margin-bottom: 4px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: var(--hp); }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 10px; }
    .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 8px; }
    .skill-item { font-size: 0.6em; padding: 4px; border-radius: 4px; background: #f1f3f5; color: #888; }
    .skill-unlocked { background: #e7f5ff; color: var(--primary); font-weight: bold; }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.1em; font-weight: bold; border: none; border-radius: 8px; }
    #log { font-size: 0.75em; background: #fdfdfd; padding: 8px; border: 1px solid var(--border); border-radius: 6px; height: 150px; overflow-y: auto; }
    .status-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
</style>
</head>
<body>
<div id="header">
    <div class="bar-container"><div class="bar-label"><span>魔神</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>HP</span><span id="playerhp-text">0/0</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div style="font-size:0.8em; margin-top:5px;">ATK: <span id="sum-atk">0</span> | Lv: <span id="p-lv">1</span></div>
</div>
<div class="nav">
    <button onclick="showTab('battle', this)" class="active">討伐</button>
    <button onclick="showTab('status', this)">能力</button>
    <button onclick="showTab('power', this)">権能</button>
    <button onclick="showTab('relic', this)">遺物</button>
</div>
<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">魔神に攻撃</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="power" class="tab"><div id="powerList"></div></div>
    <div id="relic" class="tab"><div id="relicList"></div></div>
</div>
<script>
const SAVE_KEY = "MAJIN_DEBUG_FULL_UNLOCK";
const POWER_NAMES = ["剣神の残火","不滅の守護者","魔導王の遺志","覇王の残光","絶影の残影","修羅の咆哮","真理の残滓","神託の残響","虚無の深淵","機工の心臓"];
const RELIC_GRADES = ["欠片", "心得", "記憶", "極意", "魂", "神域", "深淵", "虚無", "真理", "超越"];
const STEPS = [10, 50, 150, 300, 500, 800, 1200, 2000, 3500, 5000];

const SKILL_MASTER = {
    "剣神の残火": ["一の太刀(ATK 5倍)","燕返し","心眼","無想","天断","神速","流星","真空","極・一文字(会心1000倍)","剣神降臨"],
    "不滅の守護者": ["不屈","再生の楔","逆境の理","不死の魂","守護神の誇り(HP1万毎100%)","金剛の体","鉄壁の構え","報復の棘","絶望への抗い","不滅の聖域(耐時速度10倍)"],
    "魔導王の遺志": ["魔力導線","術式展開","詠唱破棄(25%連撃)","多重構築","深淵の知恵","魔導の極致","元素爆発(追撃500%)","真理の門","賢者の石","魔導王の再臨(全権能2倍)"],
    "覇王の残光": ["威圧","王の進軍","凱旋の鬨","統率の才","覇王の盾","黄金の夜明け","天をも統べる","不抜の城塞","絶対王政","至高の御座(Lv毎5000)"],
    "絶影の残影": ["急所穿ち","影走り","死の刻印","虚像の舞","暗殺者の誇り(1000倍)","刹那の閃き","闇に溶ける","絶影の連撃","魂の収穫","虚無の終焉"],
    "修羅の咆哮": ["狂乱","血戦の契り","屠殺の牙","闘神の血","修羅の道","飽くなき闘争(長押し10倍)","憤怒の波動","鬼神の連撃","命を喰らう(最大HP増)","冥府の王"],
    "真理の残滓": ["等価交換","因果の糸","世界の記憶","理の改変","根源の理解","虚構の崩壊(割合削)","天の秤","知識の激流","運命の断罪(10%で1万倍)","神の数式"],
    "神託の残響": ["祈り(再起後100倍)","聖なる光(断末魔)","天使の加護","奇跡の予兆(20%でもう1つ)","天啓の調べ","聖域の盾(即死回避)","神の審判","福音の響き","至福の時","主の御手(神速自動)"],
    "虚無の深淵": ["忘却","影の浸食","暗黒の底(散り際1%)","空虚な夢","存在の否定(HP1000倍)","無への還元(乗算化)","深淵の眼","終焉の予言","滅びの歌","絶対零"],
    "機工の心臓": ["歯車の回転","過負荷の熱(全快100倍)","精密演算","鋼鉄の意志","自動修復(ヒットHP+100)","蒸気の噴進","機工の連鎖","次元の歯車","神の設計図","究極の機構"]
};

let p, currentBossHP = 1e20, longPressInterval = null, isPressing = false;

function init() {
    // デバッグ用：全遺物を各5000個所持した状態を生成
    let debugInv = {};
    for(let i=0; i<100; i++) { debugInv[i] = 5000; }
    p = { lv: 100, exp: 0, inventory: debugInv, deathCount: 0 };
    
    document.getElementById("attackBtn").addEventListener("mousedown", startAtk);
    document.getElementById("attackBtn").addEventListener("mouseup", stopAtk);
    document.getElementById("attackBtn").addEventListener("touchstart", startAtk);
    document.getElementById("attackBtn").addEventListener("touchend", stopAtk);
    refresh();
}

function startAtk(e) { e.preventDefault(); isPressing = true; battle(); if(!longPressInterval) longPressInterval = setInterval(battle, 100); }
function stopAtk() { isPressing = false; clearInterval(longPressInterval); longPressInterval = null; }

function calcStats() {
    let relicAtk = 0;
    Object.keys(p.inventory).forEach(id => {
        const grade = id % 10;
        relicAtk += (grade + 1) * 100 * p.inventory[id];
    });
    
    // 魔導王の再臨(全権能2倍)の効果を想定した計算
    const mageMult = 2; 
    let s = { maxHP: p.lv * 100 + 10, baseAtk: 10 + (p.lv * 5) + relicAtk, multi: 1 };
    
    // スキル反映：飽くなき闘争(10倍 * 再臨2倍 = 20倍)
    if(isPressing) s.multi *= (10 * mageMult);
    // スキル反映：至高の御座
    s.baseAtk += (p.lv * 5000 * mageMult);
    // スキル反映：存在の否定(HP1000倍)
    s.maxHP *= (1000 * mageMult);

    s.finalAtk = s.baseAtk * (1 + p.deathCount * 0.001) * s.multi;
    return s;
}

function battle() {
    const s = calcStats();
    let dmg = s.finalAtk;
    
    // 虚構の崩壊(最大HP削り)
    dmg += (1e20 * 0.00000001);

    currentBossHP -= dmg;
    addLog(`魔神に ${Math.floor(dmg).toLocaleString()} ダメージ！`);
    
    // 死亡描写
    addLog(`<span style="color:red">即死攻撃を受けた！(再起)</span>`);
    p.deathCount++;
    refresh();
}

function getCount(sysIdx) {
    let c = 0; for(let i=0; i<10; i++) c += (p.inventory[sysIdx*10+i] || 0); return c;
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / 1e20 * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / 1e20 * 100).toFixed(6) + "%";
    document.getElementById("playerhp-text").innerText = `${s.maxHP} / ${s.maxHP}`;
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();
    
    if(document.activeTab === 'status') renderStatus(s);
    if(document.activeTab === 'power') renderPower();
    if(document.activeTab === 'relic') renderRelic();
}

function renderStatus(s) {
    document.getElementById("statusList").innerHTML = `
        <div class="status-item"><span>最大HP</span><span>${s.maxHP.toLocaleString()}</span></div>
        <div class="status-item"><span>最終ATK</span><span>${Math.floor(s.finalAtk).toLocaleString()}</span></div>
        <div class="status-item"><span>再起回数</span><span>${p.deathCount}</span></div>
    `;
}

function renderPower() {
    document.getElementById("powerList").innerHTML = POWER_NAMES.map((name, idx) => {
        const c = getCount(idx);
        return `<div class="card-cell"><b>${name}</b> (遺物:${c})<div class="skill-list">
            ${SKILL_MASTER[name].map((skName, i) => `<div class="skill-item ${c >= STEPS[i] ? 'skill-unlocked' : ''}">${skName}</div>`).join("")}
        </div></div>`;
    }).join("");
}

function renderRelic() {
    const ids = Object.keys(p.inventory).filter(id => p.inventory[id] > 0);
    document.getElementById("relicList").innerHTML = ids.map(id => {
        const grade = id % 10;
        const effect = (grade + 1) * 100 * p.inventory[id];
        return `<div class="card-cell">⭐︎${grade+1} ${POWER_NAMES[Math.floor(id/10)].split("の")[0]}の${RELIC_GRADES[grade]} ×${p.inventory[id]}<br><small style="color:var(--hp)">効果: ATK +${effect}</small></div>`;
    }).join("");
}

function showTab(id, btn) {
    document.activeTab = id;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    refresh();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 20) l.removeChild(l.lastChild);
}

init();
</script>
</body>
</html>

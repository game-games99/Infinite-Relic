<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root { --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6; --primary: #007bff; --text: #212529; --hp: #dc3545; --exp: #007bff; --player-hp: #28a745; --rare: #ffc107; }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; height: 100vh; display: flex; flex-direction: column; overflow: hidden; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: #6c757d; font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content-area { flex-grow: 1; overflow-y: auto; background: #fff; position: relative; }
    .tab { display: none; padding: 15px; box-sizing: border-box; height: 100%; }
    .tab.active { display: flex; flex-direction: column; }
    .btn-attack { width: 100%; padding: 25px; background: var(--primary); color: #fff; font-size: 1.4em; font-weight: bold; border: none; border-radius: 12px; cursor: pointer; touch-action: manipulation; flex-shrink: 0; margin-bottom: 15px; }
    #log { flex-grow: 1; font-size: 0.85em; background: #fafafa; padding: 10px; border: 1px solid var(--border); border-radius: 8px; overflow-y: auto; }
    .relic-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    .relic-card { background: #fff; border: 1px solid var(--border); padding: 8px; border-radius: 6px; font-size: 0.7em; }
    .relic-epic { border: 2px solid var(--rare); background: #fffdf5; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; margin: 4px 0 6px; }
    .fill { height: 100%; transition: width 0.1s ease; }
    .card-cell { background: #f8f9fa; border: 1px solid var(--border); padding: 10px; border-radius: 8px; margin-bottom: 10px; }
    .skill-item { font-size: 0.7em; padding: 6px; border-radius: 4px; border-left: 4px solid #007bff; background: #fff; margin-bottom: 4px; }
    .skill-desc { color: #666; font-size: 0.9em; display: block; margin-top: 2px; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-label"><span>魔神 HP (無限)</span><span id="bosshp-text">∞</span></div>
    <div class="bar"><div id="bosshp" class="fill" style="background:var(--hp); width:100%"></div></div>
    <div class="bar-label"><span>次Lvまで</span><span id="exp-text">0%</span></div>
    <div class="bar"><div id="exp-bar" class="fill" style="background:var(--exp); width:0%"></div></div>
    <div class="bar-label"><span>プレイヤー HP</span><span id="playerhp-text">100/100</span></div>
    <div class="bar"><div id="playerhp" class="fill" style="background:var(--player-hp); width:100%"></div></div>
    <div style="font-size:0.8em; font-weight:bold; display:flex; justify-content:space-between; margin-top:5px;">
        <span>Lv: <span id="p-lv">1</span></span>
        <span>ATK: <span id="p-atk">10</span></span>
        <span>再起: <span id="p-death">0</span></span>
    </div>
</div>

<div class="nav">
    <button id="nav-battle" onclick="showTab('battle')" class="active">討伐</button>
    <button id="nav-status" onclick="showTab('status')">能力</button>
    <button id="nav-power" onclick="showTab('power')">権能</button>
    <button id="nav-relic" onclick="showTab('relic')">遺物</button>
</div>

<div id="content-area">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">こうげき</button><div id="log"></div></div>
    <div id="status" class="tab"></div>
    <div id="power" class="tab"></div>
    <div id="relic" class="tab"></div>
</div>

<script>
// 権能とスキルの詳細定義
const POWER_DATA = [
    { name: "剣神の残火", base: "ATK上昇特化", skills: ["一の太刀","燕返し","心眼","無想","天断","神速","流星","真空","極・一文字","剣神降臨"] },
    { name: "不滅の守護者", base: "HP比例ATK上昇", skills: ["不屈","再生の楔","逆境","不死魂","守護誇","金剛体","鉄壁","報復棘","絶望抗","不滅域"] },
    { name: "魔導王の遺志", base: "スキル倍率強化", skills: ["魔力線","術展開","詠唱棄","多構築","深淵知","魔極致","元爆発","真理門","賢者石","魔導王再臨"] },
    { name: "覇王の残光", base: "遺物所持数で強化", skills: ["威圧","王進軍","凱旋鬨","統率才","覇王盾","黄金暁","天統べ","不抜城","絶対王政","至高御座"] },
    { name: "絶影の残影", base: "クリティカル特化", skills: ["急所穿","影走り","死刻印","虚像舞","暗殺誇","刹那閃","闇溶ける","絶影連","魂収穫","虚無終焉"] },
    { name: "修羅の咆哮", base: "再起回数で無限成長", skills: ["狂乱","血戦契","屠殺牙","闘神血","修羅道","飽くなき","憤怒波","鬼神連","命喰らう","冥府王"] },
    { name: "真理の残滓", base: "経験値・効率化", skills: ["等価交換","因果糸","世界記憶","理改変","根源理解","虚構崩壊","天秤","知識激流","運命断罪","神数式"] },
    { name: "神託の残響", base: "ドロップ率操作", skills: ["祈り","聖光","天加護","奇跡予","天啓調","聖域盾","神審判","福音響","至福時","主御手"] },
    { name: "虚無の深淵", base: "割合ダメージ演出", skills: ["忘却","影浸食","暗黒底","空虚夢","存在否定","無還元","深淵眼","終焉予","滅び歌","絶対零"] },
    { name: "機工の心臓", base: "固定ダメージ加算", skills: ["歯車回転","過負荷熱","精密演算","鋼鉄意志","自動修復","蒸気噴進","機工連鎖","次元歯車","神設計図","究極機構"] }
];

// 遺物100種の完全差別化生成
const RELIC_MASTER = [];
for(let p=0; p<10; p++) {
    for(let s=1; s<=10; s++) {
        let type = (p % 2 === 0) ? "ATK" : "HP";
        let val = 0, isPercent = (s >= 6);
        // 権能ごとの特性を遺物に反映
        if(p === 0) val = isPercent ? s * 40 : s * 250; // 剣神: 純粋ATK大
        else if(p === 2) val = isPercent ? s * 60 : s * 100; // 魔導: ％が高い
        else if(p === 5) val = isPercent ? s * 80 : s * 50;  // 修羅: リスク高倍率
        else val = isPercent ? s * 30 : s * 150; // その他

        RELIC_MASTER.push({
            id: (p * 10) + (s - 1),
            pIdx: p, star: s, type: type, val: val, isPercent: isPercent,
            name: POWER_DATA[p].name + (["の欠片","の結晶","の紋章","の眼","の核"][Math.floor((s-1)/2)] || "の真実")
        });
    }
}

let player = { lv: 1, exp: 0, inventory: Array(100).fill(0), deathCount: 0, baseAtk: 10, baseHP: 100 };
let maxDmg = 0, isPressing = false;

function save() { localStorage.setItem("IR_Save_V10", JSON.stringify(player)); }
function load() { const s = localStorage.getItem("IR_Save_V10"); if(s) Object.assign(player, JSON.parse(s)); }

function attack() {
    addLog(`<span style="color:var(--hp); font-weight:bold;">魔神の攻撃：即死！</span>`);
    player.deathCount++;
    addLog(`<span style="color:var(--player-hp)">再起の誓いにより力を継承した...</span>`);

    // 成長
    const growth = Math.floor(Math.random() * player.lv) + 5;
    player.baseAtk += growth; player.baseHP += growth * 10;

    // 計算
    let rAtkAdd = 0, rAtkMul = 1, skillMul = 1, expBonus = 1;
    let activeSkill = "";
    
    player.inventory.forEach((count, id) => {
        if(count > 0) {
            const r = RELIC_MASTER[id];
            if(r.type === "ATK") { if(r.isPercent) rAtkMul += (r.val / 100); else rAtkAdd += r.val * count; }
            
            // スキル倍率計算
            let powerMul = (r.star * 2); 
            if(r.pIdx === 0) powerMul *= 2; // 剣神
            if(r.pIdx === 5) powerMul *= (1 + player.deathCount * 0.05); // 修羅
            
            if(powerMul > skillMul) {
                skillMul = powerMul;
                activeSkill = POWER_DATA[r.pIdx].skills[r.star-1];
            }
            if(r.pIdx === 6) expBonus += (r.star * 0.1); // 真理
        }
    });

    const totalAtk = Math.floor((player.baseAtk + rAtkAdd) * rAtkMul * skillMul);
    const dmg = Math.floor(totalAtk * (0.9 + Math.random() * 0.2));
    if(dmg > maxDmg) maxDmg = dmg;

    if(activeSkill) addLog(`<span style="color:var(--primary); font-weight:bold;">【${activeSkill}】 ${skillMul.toFixed(1)}倍撃！</span>`);
    addLog(`魔神に ${dmg.toLocaleString()} ダメージ！`);

    player.exp += (dmg / (player.lv * 100)) * expBonus;
    while(player.exp >= 100) { player.lv++; player.exp -= 100; addLog(`<span style="color:orange; font-weight:bold;">Lv UP! Lv${player.lv}</span>`); }
    if(Math.random() < 0.1) dropRelic();
    save(); refreshUI();
}

function dropRelic() {
    const star = Math.random() < 0.08 ? Math.floor(Math.random()*5)+6 : Math.floor(Math.random()*9)+1;
    const candidates = RELIC_MASTER.filter(r => r.star === star);
    const r = candidates[Math.floor(Math.random() * candidates.length)];
    if(star >= 6 && player.inventory[r.id] > 0) return;
    player.inventory[r.id]++;
    addLog(`<span style="color:${star>=6?'var(--rare)':'#666'}; font-weight:bold;">遺物獲得：${r.name} (⭐︎${star})</span>`);
}

function refreshUI() {
    document.getElementById("exp-bar").style.width = Math.min(100, player.exp) + "%";
    document.getElementById("p-lv").innerText = player.lv;
    document.getElementById("p-atk").innerText = player.baseAtk.toLocaleString();
    document.getElementById("p-death").innerText = player.deathCount;
    document.getElementById("playerhp-text").innerText = `${(player.baseHP).toLocaleString()} / ${(player.baseHP).toLocaleString()}`;
}

function showTab(id) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.getElementById("nav-" + id).classList.add("active");
    if(id === 'relic') renderRelic();
    if(id === 'power') renderPower();
}

function renderRelic() {
    let h = `<div class="relic-grid">`;
    player.inventory.forEach((count, id) => {
        if(count > 0) {
            const r = RELIC_MASTER[id];
            h += `<div class="relic-card ${r.star>=6?'relic-epic':''}">
                <b>⭐︎${r.star} ${r.name}</b><br>
                ${r.type}: ${r.isPercent ? '+'+r.val+'%' : '+'+r.val.toLocaleString()}<br>
                所持: ${count}
            </div>`;
        }
    });
    document.getElementById("relic").innerHTML = h + `</div>`;
}

function renderPower() {
    let h = "";
    POWER_DATA.forEach((p, pi) => {
        h += `<div class="card-cell"><b>【権能】${p.name}</b><br><small>${p.base}</small><div style="margin-top:8px;">`;
        p.skills.forEach((s, si) => {
            const relicId = (pi * 10) + si;
            const isUnlocked = player.inventory[relicId] > 0;
            const currentMul = (si + 1) * 2 * (pi === 0 ? 2 : 1) * (pi === 5 ? (1 + player.deathCount * 0.05) : 1);
            h += `<div class="skill-item" style="opacity:${isUnlocked?1:0.4}">
                <b>⭐︎${si+1} ${s}</b>
                <span class="skill-desc">${isUnlocked ? '解放済み：ATK ' + currentMul.toFixed(1) + '倍' : '未解放（⭐︎' + (si+1) + '遺物が必要）'}</span>
            </div>`;
        });
        h += `</div></div>`;
    });
    document.getElementById("power").innerHTML = h;
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 30) l.removeChild(l.lastChild);
}

load();
const btn = document.getElementById("attackBtn");
btn.addEventListener("mousedown", () => isPressing = true);
window.addEventListener("mouseup", () => isPressing = false);
btn.addEventListener("touchstart", (e) => { e.preventDefault(); isPressing = true; }, {passive: false});
window.addEventListener("touchend", () => isPressing = false);
setInterval(() => { if(isPressing) attack(); }, 120);
refreshUI();
</script>
</body>
</html>
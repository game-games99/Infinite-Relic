<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Divine Slayer: Relic of the End</title>
<style>
    :root {
        --bg: #0a0a0c; --card: #15151a; --primary: #00f2ff; 
        --accent: #ff0055; --text: #e2e2e7; --sub: #71717a;
        --atk-color: #fca5a5; --dmg-color: #f97316; --skill-color: #a855f7;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Inter', system-ui, sans-serif; margin: 0; user-select: none; touch-action: manipulation; }
    
    #top { background: var(--card); padding: 20px; border-bottom: 1px solid #27272a; position: sticky; top: 0; z-index: 100; text-align: center; }
    #boss-name { font-size: 1.1em; font-weight: 800; color: var(--accent); letter-spacing: 0.3em; text-transform: uppercase; }
    .bar { height: 6px; background: #27272a; border-radius: 3px; overflow: hidden; margin: 10px 0; }
    .fill { height: 100%; transition: width 0.1s; }
    #bosshp { background: linear-gradient(90deg, #450a0a, #ff0055); width: 100%; }
    
    .main-stats { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px; }
    .stat-box { background: #00000044; padding: 10px; border-radius: 8px; border: 1px solid #27272a; }
    .stat-label { font-size: 0.6em; color: var(--sub); text-transform: uppercase; display: block; margin-bottom: 2px; }
    .stat-val { font-size: 1em; font-weight: 700; color: var(--primary); font-family: 'JetBrains Mono', monospace; }

    .nav { display: flex; background: #15151a; border-bottom: 1px solid #27272a; }
    .nav button { flex: 1; padding: 15px 5px; border: none; background: none; color: var(--sub); font-size: 0.7em; font-weight: 600; cursor: pointer; transition: 0.2s; }
    .nav button.active { color: var(--primary); background: #00f2ff0a; border-bottom: 2px solid var(--primary); }

    .tab { display: none; padding: 15px; height: calc(100vh - 300px); overflow-y: auto; }
    .tab.active { display: block; }

    .btn-attack { 
        width: 100%; padding: 35px; background: #000; color: var(--accent); 
        font-size: 1.2em; font-weight: 900; border: 1px solid var(--accent); border-radius: 4px; 
        cursor: pointer; box-shadow: inset 0 0 20px #ff005522; transition: 0.1s;
    }
    .btn-attack:active { background: var(--accent); color: #000; transform: translateY(2px); }
    #log { margin-top: 15px; height: 160px; overflow-y: auto; font-size: 0.7em; line-height: 1.8; color: #a1a1aa; display: flex; flex-direction: column-reverse; }

    .relic-card { background: #1c1c21; border: 1px solid #27272a; padding: 12px; border-radius: 6px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .relic-info { display: flex; flex-direction: column; }
    .relic-name { font-weight: 700; font-size: 0.9em; }
    .relic-effect { font-size: 0.7em; margin-top: 2px; }
    .relic-count { font-family: 'JetBrains Mono', monospace; color: var(--primary); font-weight: bold; }

    .skill-card { background: #1c1c21; border-left: 3px solid var(--primary); padding: 10px; margin-bottom: 6px; }
    .skill-name { font-weight: 700; font-size: 0.85em; display: flex; justify-content: space-between; }
    .skill-desc { font-size: 0.7em; color: var(--sub); margin-top: 4px; }
    
    .job-item { background: #1c1c21; padding: 12px; border-radius: 6px; margin-bottom: 10px; border: 1px solid #27272a; }
</style>
</head>
<body>

<div id="top">
    <div id="boss-name">È≠îÁ•û„Éª„Ç¢„Ç∂„Éà„Éº„Çπ</div>
    <div class="bar"><div id="bosshp" class="fill"></div></div>
    <div id="bosshp-text" style="font-size:0.6em; font-family:monospace; color:var(--sub);">CALCULATING...</div>
    
    <div class="main-stats">
        <div class="stat-box"><span class="stat-label">Hero Level</span><span id="p-lv" class="stat-val">1</span></div>
        <div class="stat-box"><span class="stat-label">Attack Power</span><span id="p-atk" class="stat-val">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">BATTLE</button>
    <button onclick="showTab('job', this)">JOB</button>
    <button onclick="showTab('skills', this)">SKILLS</button>
    <button onclick="showTab('equip', this)">RELICS</button>
</div>

<div id="battle" class="tab active">
    <button class="btn-attack" id="attackBtn">STRIKE</button>
    <div id="log"></div>
</div>

<div id="job" class="tab">
    <div id="jobList"></div>
</div>

<div id="skills" class="tab">
    <div id="ownedSkills"></div>
</div>

<div id="equip" class="tab">
    <div id="inventory"></div>
</div>

<script>
// --- ÂÆöÊï∞„Éª„Éá„Éº„Çø ---
const BOSS_MAX_HP = 1e24; // 1Âèô
const JOBS_DATA = {
    "Ââ£Â£´": ["ÁÉàÁÅ´‰∏ÄÈñÉ", "ËôöÁ©∫ÂçÅÊñáÂ≠ó", "ÁçÑÈñÄÂâ≤„Çä", "Â§©Ë£ÇÊñ¨", "Á•ûÊÆ∫„Åó„ÅÆÊ•µÊÑè"],
    "È≠îÂ∞éÂ∏´": ["„Ç≥„É°„ÉÉ„ÉàÂºæ", "Ê•µÂ§ú„ÅÆÊ∞∑Êßç", "ÁÑ¶Âúü„ÅÆÁàÜÁÑî", "Èõ∂ÂºèÈ≠îÁ†≤", "ÂÆáÂÆô„ÅÆÊ∑±Ê∑µ"],
    "Ê≠¶ÈóòÂÆ∂": ["Áû¨ÂàªÈÄ£ÊíÉ", "ÂÖ≠ÈÅìËº™ÂªªËÑö", "Á†¥Â≤©Ë°ùÊíÉ", "‰∏áÁâ©Á†ï„Åç", "ÁæÖÂàπ„ÅÆÈºìÂãï"],
    "ÁãÇÊà¶Â£´": ["Êö¥Ëôê„ÅÆÊñß", "Ë°Ä„ÅÆÁ•ùÁ•≠", "È≠Ç„ÅÆÂíÜÂìÆ", "ÊªÖÊÆ∫„ÅÆÊßã„Åà", "ÁµÇÁÑâ„ÅÆÁãÇÊ∞ó"],
    "Áã©‰∫∫": ["ÊµÅÊòü„ÅÆÁü¢", "ÂΩ±Á∏´„ÅÑ„ÅÆÂº¶", "Èõ∂Ë∑ùÈõ¢Â∞ÑÊíÉ", "Â§©Á©∫„ÇíÁ©ø„Å§ÂÖâ", "Á•ûÁΩ∞„ÅÆÁü¢Èõ®"],
    "ÂøçËÄÖ": ["Ë£èÈö†„ÅÆË°ì", "‰∏çÁü•ÁÅ´", "ÂπªÂΩ±ÂàÜË∫´", "ÈªíËìÆËèØ", "ÂæÆÂ°µ„ÅÆË£Å„Åç"],
    "‰æç": ["Êúà‰∏ãÁæé‰∫∫", "‰∏Ä„ÉéÂûã„ÉªÂá™", "Êï£„ÇäÊ§ø", "ÊÆãÂøÉ", "ÁßòÂâ£„ÉªÊòáÈæç"],
    "Á´úÈ®éÂ£´": ["„Éâ„É©„Ç∞„Éº„É≥„ÉÄ„Ç§„Éñ", "Á´úÂ∏ù„ÅÆÂíÜÂìÆ", "ÈÄÜÈ±ó„ÅÆ‰∏ÄÊíÉ", "È£õÂ§©", "ÈæçÁ•ûÈôçËá®"],
    "Èå¨ÈáëË°ìÂ∏´": ["Ë≥¢ËÄÖ„ÅÆÁßòËñ¨", "ÈáçÂäõÂ¥©Â£äÊ∂≤", "ÈáëÂâõÂ§âÂåñ", "‰∏áÁâ©ÁîüÊàê", "ÁúüÁêÜ„ÅÆÁû≥"],
    "Ê≠ªÈúä‰Ωø„ÅÑ": ["‰∫°ËÄÖ„ÅÆÂòÜ„Åç", "ÂπΩÂÜ•„ÅÆÈúß", "È≠Ç„ÅÆÁï•Â•™", "Ê≠ªÈúä„ÅÆËªçÂã¢", "Ê≠ª„ÅÆÂè£„Å•„Åë"],
    "ÊöóÊÆ∫ËÄÖ": ["Êñ≠Êú´È≠î", "ÈùôÂØÇ„ÅÆÂàÉ", "ÊÄ•ÊâÄÂ¥©„Åó", "ÂΩ±„ÅÆÊîØÈÖçËÄÖ", "ÁÑ°Èü≥„ÅÆÁµÇÁÑâ"],
    "Êã≥ÈóòÂ£´": ["„É©„Ç§„Ç∏„É≥„Ç∞", "„Éû„ÉÉ„ÉèÊã≥", "Ë°ùÊíÉÊ≥¢", "Ë¶áÁéã„ÅÆÊã≥", "ÊúÄÁµÇÊ±∫Êà¶"],
    "ËÅñÈ®éÂ£´": ["Á•ûËÅñ„Å™„ÇãÈò≤Â£Å", "Ë£Å„Åç„ÅÆÂÖâ", "Â§©Áïå„ÅÆÁ¶èÈü≥", "‰∏çÈÄÄËª¢„ÅÆÂøó", "ÊúÄÂæå„ÅÆÂØ©Âà§"],
    "ÊßçË°ìÂ£´": ["Á¥´Èõª‰∏ÄÈñÉ", "ÁôæÁÉàÁ™Å„Åç", "Ëû∫Êóã„ÅÆÁâô", "Âµê„ÇíÂëº„Å∂Êßç", "Â§©Á©∫„ÅÆÊîØÈÖçËÄÖ"],
    "Ë≥¢ËÄÖ": ["Âõ†Êûú„ÅÆÊ≠™„Åø", "Ëß£ÊûêÂÆå‰∫Ü", "Êòü„ÅÆÂ∞é„Åç", "ÊôÇÁ©∫È≠îÊ≥ï", "ÂÖ®Áü•ÂÖ®ËÉΩ"],
    "È¢®Ë°ìÂ∏´": ["ÁúüÁ©∫„ÅÆÈéå", "Áø°Áø†„ÅÆÂµê", "Â§©Áøî„Åë„ÇãÈ¢®", "Á•ûÈ¢®„ÅÆÂä†Ë≠∑", "ÁúüÁ©∫Âú∞ÁçÑ"],
    "Èå¨Â£´": ["Á∑¥Ê∞ó", "ÈõÜ‰∏≠", "ÂÜÖÂäü", "ÈôêÁïåÁ™ÅÁ†¥", "Á©∂Ê•µËß£Êîæ"],
    "Ë¶áÁéã": ["Áéã„ÅÆÂ®ÅÂúß", "‰∏áÁâ©„ÅÆÊúçÂæì", "Ê¨°ÂÖÉ„ÅÆÊîØÈÖç", "Ë¶áÈÅì„ÅÆÊ•µ„Åø", "Êñ∞‰∏ñÁïå„ÅÆÂâµÈÄ†"],
    "ÂÜíÈô∫ËÄÖ": ["„É©„ÉÉ„Ç≠„Éº„ÉÄ„Ç§„Çπ", "Ëµ∑Ê≠ªÂõûÁîü", "Áßò„ÇÅ„Çâ„Çå„ÅüÂäõ", "Â•áË∑°„ÅÆÈ¢®", "Ëã±ÈõÑ„ÅÆË®º"],
    "ÈáçÈ®éÂ£´": ["ÈâÑÂ£Å„ÅÆÂüéÂ°û", "Á†¥ÂüéÊßå", "Â§ßÂú∞„ÅÆÊÄí„Çä", "‰∏çÂÄí„ÅÆÈ≠Ç", "ÈáçÂäõÂ¥©Â£ä"]
};

// ÈÅ∫Áâ©„Éá„Éº„ÇøÔºà3Á®ÆÈ°ûÔºâ
const RELICS_DATA = [
    { id:1, type:"ATK", name:"È≠îÁ•û„ÅÆÂøÉËáì", desc:"Âü∫Á§éÊîªÊíÉÂäõ„Çí1%‰∏äÊòá„Åï„Åõ„Çã", color:"var(--atk-color)" },
    { id:2, type:"DMG", name:"Áï∞Áïå„ÅÆÁü≥Áâà", desc:"‰∏é„Åà„ÇãÊúÄÁµÇ„ÉÄ„É°„Éº„Ç∏„Çí2%‰∏äÊòá„Åï„Åõ„Çã", color:"var(--dmg-color)" },
    { id:3, type:"SKILL", name:"È†êË®ÄËÄÖ„ÅÆÁúº", desc:"„Çπ„Ç≠„É´„ÅÆËøΩÂä†ÂÄçÁéá„Çí5%‰∏äÊòá„Åï„Åõ„Çã", color:"var(--skill-color)" },
    { id:4, type:"ATK", name:"ÊòüÂ±ë„ÅÆÊÆãÊªì", desc:"ÂÆáÂÆô„ÅÆÂäõ„ÅßÊîªÊíÉÂäõ„Çí100Âä†ÁÆó„Åô„Çã", color:"var(--atk-color)" },
    { id:5, type:"DMG", name:"ÂàªÂç∞„ÅÆËÅñÊùØ", desc:"„ÉÄ„É°„Éº„Ç∏ÂäπÁéá„Çí5%‰∏äÊòá„Åï„Åõ„Çã", color:"var(--dmg-color)" }
];

let p, longPressIdx;
const SAVE_KEY = "DIVINE_REPLIC_FINAL";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : {
        lv:1, exp:0, job:"Ââ£Â£´", 
        inventory: {}, unlockedSkills: [], 
        jobLevels: {}, jobExp: {}, bossTotalDmg: 0
    };
    Object.keys(JOBS_DATA).forEach(j => {
        if(!p.jobLevels[j]) p.jobLevels[j] = 1;
        if(!p.jobExp[j]) p.jobExp[j] = 0;
    });
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); battle(); clearInterval(longPressIdx); longPressIdx = setInterval(battle, 100); };
    const stop = () => clearInterval(longPressIdx);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop);
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);
    refresh();
}

function calcStats() {
    // Âü∫Á§éÊîªÊíÉÂäõ
    let baseAtk = (10 + p.lv * 15);
    let totalDmgMult = 1.0;
    let skillEfficacyMult = 1.0;

    Object.keys(p.inventory).forEach(id => {
        const count = p.inventory[id];
        if(id == 1) baseAtk *= (1 + 0.01 * count);
        if(id == 2) totalDmgMult += (0.02 * count);
        if(id == 3) skillEfficacyMult += (0.05 * count);
        if(id == 4) baseAtk += (100 * count);
        if(id == 5) totalDmgMult += (0.05 * count);
    });

    p.totalAtk = Math.floor(baseAtk);
    p.totalDmgMult = totalDmgMult;
    p.skillEfficacyMult = skillEfficacyMult;
}

function battle() {
    calcStats();
    const variance = 0.7 + (Math.random() * 0.3);
    let currentDmg = p.totalAtk * variance;
    
    // „Çπ„Ç≠„É´Âà§ÂÆö
    let skillChain = 0;
    let skillPower = 0;
    p.unlockedSkills.forEach(s => {
        if(Math.random() < 0.04) { // 4%Áô∫Âãï
            skillChain++;
            skillPower += (0.5 * p.skillEfficacyMult); // ÈÅ∫Áâ©„Åß„Çπ„Ç≠„É´ÂäπÊûú„ÅåÂ¢óÂº∑
        }
    });

    let finalDmg = Math.floor(currentDmg * (1 + skillPower) * p.totalDmgMult);
    p.bossTotalDmg += finalDmg;

    // „É≠„Ç∞
    if(skillChain > 0) addLog(`<span style="color:var(--skill-color)">‚óÜ ${skillChain} SKILLS RESONATED!</span>`);
    addLog(`<span style="color:var(--text)">${finalDmg.toLocaleString()} DAMAGE</span>`);
    
    if(Math.random() < 0.15) addLog(`<span style="color:var(--accent)">√ó ANNIHILATED BY AZATHOTH.</span>`);

    // Â†±ÈÖ¨
    let gain = Math.floor(finalDmg * 0.2);
    p.exp += gain;
    p.jobExp[p.job] += gain;

    // ÈÅ∫Áâ©„Éâ„É≠„ÉÉ„Éó
    if(Math.random() < 0.08) {
        let r = RELICS_DATA[Math.floor(Math.random() * RELICS_DATA.length)];
        p.inventory[r.id] = (p.inventory[r.id] || 0) + 1;
        addLog(`<span style="color:var(--primary)">‚òÖ RELIC FOUND: ${r.name}</span>`);
    }

    checkLevelUp();
    refresh();
}

function checkLevelUp() {
    // Êï∞ÂçÅÊôÇÈñì„ÇÇ„Åü„Åõ„ÇãÊåáÊï∞Èñ¢Êï∞„ÉÜ„Éº„Éñ„É´ (Lv^3.5)
    const getNextExp = (lv) => Math.pow(lv, 3.5) * 600;
    while (p.exp >= getNextExp(p.lv)) {
        p.exp -= getNextExp(p.lv);
        p.lv++;
        addLog(`<span style="color:var(--primary)">‚â´ LEVEL UP: ${p.lv}</span>`);
    }
    
    let j = p.job;
    const getNextJExp = (lv) => Math.pow(lv, 3.2) * 800;
    while (p.jobExp[j] >= getNextJExp(p.jobLevels[j])) {
        p.jobExp[j] -= getNextJExp(p.jobLevels[j]);
        p.jobLevels[j]++;
        
        const lv = p.jobLevels[j];
        const thresholds = [10, 25, 50, 75, 100];
        if(thresholds.includes(lv)) {
            let sName = JOBS_DATA[j][thresholds.indexOf(lv)];
            if(!p.unlockedSkills.includes(sName)) {
                p.unlockedSkills.push(sName);
                addLog(`<span style="color:var(--skill-color)">üî• NEW SKILL: „Äê${sName}„Äë</span>`);
            }
        }
    }
}

function refresh() {
    calcStats();
    let hpPercent = Math.max(0, 100 - (p.bossTotalDmg / BOSS_MAX_HP * 100));
    document.getElementById("bosshp").style.width = hpPercent + "%";
    document.getElementById("bosshp-text").innerText = `HP: ${hpPercent.toFixed(10)}%`;
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("p-atk").innerText = p.totalAtk.toLocaleString();
    
    // JOB
    document.getElementById("jobList").innerHTML = Object.keys(JOBS_DATA).map(j => {
        const lv = p.jobLevels[j];
        return `<div class="job-item">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <b>${j} <small>Lv.${lv}</small></b>
                <button class="btn-small" onclick="p.job='${j}';refresh();" ${p.job===j?'disabled':''} style="background:${p.job===j?'#333':'var(--primary)'}; color:#000;">SWITCH</button>
            </div>
        </div>`;
    }).join("");

    // SKILLS
    document.getElementById("ownedSkills").innerHTML = p.unlockedSkills.length ? p.unlockedSkills.map(s => `
        <div class="skill-card">
            <div class="skill-name"><span>${s}</span><span style="color:var(--skill-color)">5.0% CHANCE</span></div>
            <div class="skill-desc">‰∏é„ÉÄ„É°„Éº„Ç∏„ÇíÊîªÊíÉÂäõ„ÅÆ0.5ÂÄç(ÈÅ∫Áâ©Ë£úÊ≠£Ââç)Âä†ÁÆó„Åó„ÄÅÈ≠îÁ•û„ÅÆÈò≤Âæ°Â±§„ÇíË≤´ÈÄö„Åô„Çã„ÄÇ</div>
        </div>
    `).join("") : "<p style='color:var(--sub); font-size:0.8em;'>No skills acquired yet.</p>";

    // RELICS
    document.getElementById("inventory").innerHTML = RELICS_DATA.map(r => {
        const count = p.inventory[r.id] || 0;
        return `
            <div class="relic-card">
                <div class="relic-info">
                    <span class="relic-name" style="color:${r.color}">${r.name}</span>
                    <span class="relic-effect">${r.desc}</span>
                </div>
                <div class="relic-count">√ó${count.toLocaleString()}</div>
            </div>
        `;
    }).join("");
    save();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div");
    d.innerHTML = m;
    l.prepend(d);
    if(l.childNodes.length > 50) l.removeChild(l.lastChild);
}
function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(p)); }
init();
</script>
</body>
</html>

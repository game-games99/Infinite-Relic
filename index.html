<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ã¾ã˜ã‚“ãƒãƒ³ã‚¿ãƒ¼ï¼ - å®é£¾ã‚ã¤ã‚ -</title>
<style>
    :root {
        --bg: #f0f9ff; --card: #ffffff; --primary: #ff7eb9; 
        --secondary: #60a5fa; --accent: #fbbf24; --text: #334155;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Hiragino Sans', sans-serif; margin: 0; user-select: none; touch-action: manipulation; }
    #top { background: var(--card); padding: 20px; border-bottom: 5px solid var(--primary); border-radius: 0 0 30px 30px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .status-panel { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; background: #f8fafc; padding: 15px; border-radius: 20px; margin: 10px 0; border: 2px solid #e2e8f0; }
    .stat-box { display: flex; flex-direction: column; align-items: center; }
    .stat-label { font-size: 0.7em; color: #94a3b8; font-weight: bold; }
    .stat-val { font-size: 1.1em; color: var(--secondary); font-weight: 900; }

    .bar { height: 20px; background: #e2e8f0; border-radius: 10px; margin: 10px 0; overflow: hidden; position: relative; }
    .fill { height: 100%; transition: width 0.1s; }
    #bosshp { background: linear-gradient(90deg, #ff7eb9, #ffb1d6); width: 100%; }
    #jobexp { background: var(--secondary); }

    .nav { display: flex; justify-content: space-around; padding: 10px; background: #fff; position: sticky; top: 0; z-index: 100; }
    .nav button { border: none; background: none; padding: 10px; color: #94a3b8; font-weight: bold; font-size: 0.9em; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); }

    .tab { display: none; padding: 20px; }
    .tab.active { display: block; }

    .btn-attack { 
        width: 100%; padding: 40px 20px; background: var(--primary); color: white; 
        font-size: 1.8em; font-weight: 900; border: none; border-radius: 25px; 
        box-shadow: 0 8px 0 #db2777; transition: 0.1s; cursor: pointer; margin-bottom: 10px;
    }
    .btn-attack:active { transform: translateY(4px); box-shadow: 0 4px 0 #db2777; }

    .item-list { background: white; padding: 15px; border-radius: 20px; border: 2px solid #f1f5f9; margin-bottom: 10px; }
    .acc-item { border-bottom: 1px solid #f1f5f9; padding: 8px 0; display: flex; justify-content: space-between; align-items: center; }
    .acc-name { font-weight: bold; color: #475569; font-size: 0.9em; }
    .acc-count { background: var(--accent); color: white; padding: 2px 8px; border-radius: 10px; font-size: 0.8em; }

    #log { height: 120px; overflow-y: auto; background: #fff; padding: 10px; font-size: 0.8em; border-radius: 15px; border: 2px solid #f1f5f9; display: flex; flex-direction: column-reverse; }
    .job-card { background: white; padding: 15px; border-radius: 20px; margin-bottom: 10px; border: 2px solid #f1f5f9; transition: 0.2s; }
    .skill-badge { font-size: 0.7em; padding: 2px 6px; border-radius: 5px; margin-right: 4px; background: #e2e8f0; color: #64748b; }
    .skill-unlocked { background: var(--primary) !important; color: white !important; }
</style>
</head>
<body>

<div id="top">
    <div style="font-weight: 900; color: var(--primary); font-size: 1.2em;">ğŸ‘¿ ã¾ã˜ã‚“ ğŸ‘¿</div>
    <div class="bar"><div id="bosshp" class="fill"></div></div>
    <div id="bosshp-text" style="font-size: 0.8em; font-weight: bold;">HP: 100%</div>

    <div class="status-panel">
        <div class="stat-box"><span class="stat-label">ã“ã†ã’ãã‚Šã‚‡ã</span><span id="p-atk" class="stat-val">0</span></div>
        <div class="stat-box"><span class="stat-label">ä¼šå¿ƒã‚Šã¤</span><span id="p-crit" class="stat-val">0%</span></div>
        <div class="stat-box"><span class="stat-label">ã‚¸ãƒ§ãƒ–</span><span id="p-job" class="stat-val">-</span></div>
        <div class="stat-box"><span class="stat-label">ãƒ¬ãƒ™ãƒ«</span><span id="p-lv" class="stat-val">1</span></div>
    </div>
    <div class="bar" style="height: 10px;"><div id="jobexp" class="fill"></div></div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">ãŸãŸã‹ã†</button>
    <button onclick="showTab('job', this)">ã‚¸ãƒ§ãƒ–</button>
    <button onclick="showTab('equip', this)">ã»ã†ã—ã‚‡ã</button>
    <button onclick="showTab('system', this)">ã›ãƒ¼ã¶</button>
</div>

<div id="battle" class="tab active">
    <button class="btn-attack" id="attackBtn">ã‚¢ã‚¿ãƒƒã‚¯ï¼</button>
    <div id="log"></div>
</div>

<div id="job" class="tab">
    <div id="jobList"></div>
</div>

<div id="equip" class="tab">
    <div style="font-size: 0.9em; font-weight: bold; margin-bottom: 10px;">âœ¨ ã‚ã¤ã‚ãŸå®é£¾ (æŒã£ã¦ã„ã‚‹ã ã‘ã§åŠ¹æœUP!)</div>
    <div id="inventory" class="item-list"></div>
</div>

<div id="system" class="tab">
    <p style="font-size: 0.8em;">ãƒ‡ãƒ¼ã‚¿å¼•ç¶™ãã‚³ãƒ¼ãƒ‰</p>
    <textarea id="saveInput" style="width:100%; padding:10px; border-radius:10px; border:2px solid #e2e8f0;" rows="5"></textarea>
    <button class="btn-attack" onclick="copySaveCode()" style="padding:10px; font-size:1em; margin-top:10px;">ã‚³ãƒ¼ãƒ‰ã‚’å‡ºã™</button>
    <button class="btn-attack" onclick="importSave()" style="padding:10px; font-size:1em; margin-top:10px; background:var(--secondary); box-shadow: 0 8px 0 #2563eb;">ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚€</button>
</div>

<script>
const BOSS_MAX_HP = 1e16;
const JOBS = {
    "å‰£å£«": { 10:"3é€£æ’ƒ", 25:"5é€£æ’ƒ", 50:"ä¼šå¿ƒUP", 75:"10é€£æ’ƒ", 100:"æ¥µãƒ»ä¸€é–ƒ(100å€)" },
    "é­”è¡“å¸«": { 10:"è¿½æ’ƒ", 25:"çˆ†ç™º", 50:"é­”åŠ›å¢—å¹…", 75:"è¶…çˆ†ç™º", 100:"ãƒ¡ãƒ†ã‚ª(500å€)" },
    "æ­¦é—˜å®¶": { 10:"é€£æ‰“", 25:"æ€¥æ‰€çª", 50:"ç¥é€Ÿ", 75:"æ€’æ¶›", 100:"é˜¿ä¿®ç¾…(1000å€)" }
};

const ACC_DATA = [
    { id:1, name:"ã¡ã‹ã‚‰ã®æŒ‡è¼ª", effect:"ATK+10" },
    { id:2, name:"å¹¸é‹ã®ãƒ”ã‚¢ã‚¹", effect:"CRT+0.1%" },
    { id:3, name:"æˆé•·ã®é¦–é£¾ã‚Š", effect:"EXP+5%" },
    { id:4, name:"é­”ç¥ã®ç³", effect:"ATK+100" },
    { id:5, name:"è™¹ã®ã—ãšã", effect:"å…¨ã‚¹ãƒ†+1%" }
];

let p, longPressIdx;
const SAVE_KEY = "MAJIN_HUNTER_POP";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : {
        lv:1, exp:0, job:"å‰£å£«", 
        inventory: {}, // { id: count }
        jobLevels: {"å‰£å£«":1, "é­”è¡“å¸«":1, "æ­¦é—˜å®¶":1},
        jobExp: {"å‰£å£«":0, "é­”è¡“å¸«":0, "æ­¦é—˜å®¶":0}
    };

    const btn = document.getElementById("attackBtn");
    // é•·æŠ¼ã—å‡¦ç†ã®ç¢ºå®Ÿãªå®Ÿè£…
    const start = (e) => { e.preventDefault(); battle(); clearInterval(longPressIdx); longPressIdx = setInterval(battle, 100); };
    const stop = () => clearInterval(longPressIdx);
    
    btn.addEventListener("mousedown", start);
    btn.addEventListener("mouseup", stop);
    btn.addEventListener("mouseleave", stop);
    btn.addEventListener("touchstart", start, {passive: false});
    btn.addEventListener("touchend", stop);

    refresh();
}

function calcStats() {
    let atk = 10 + (p.lv * 5);
    let crit = 5;
    let expBonus = 1.0;

    // å®é£¾åŠ¹æœã®é‡è¤‡
    Object.keys(p.inventory).forEach(id => {
        let count = p.inventory[id];
        if (id == 1) atk += 10 * count;
        if (id == 2) crit += 0.1 * count;
        if (id == 3) expBonus += 0.05 * count;
        if (id == 4) atk += 100 * count;
        if (id == 5) { atk *= (1 + 0.01 * count); }
    });

    p.totalAtk = Math.floor(atk);
    p.totalCrit = Math.min(95, crit);
    p.expMult = expBonus;
}

function battle() {
    calcStats();
    let dmg = p.totalAtk;
    let logMsg = "";

    // ã‚¹ã‚­ãƒ«åˆ¤å®š
    let jl = p.jobLevels[p.job];
    if (jl >= 100 && Math.random() < 0.05) { dmg *= 100; logMsg = "âœ¨ å¥¥ç¾©ç™ºå‹•!! "; }
    else if (jl >= 25 && Math.random() < 0.2) { dmg *= 5; logMsg = "âš”ï¸ 5é€£æ’ƒ! "; }

    if (Math.random() < p.totalCrit/100) { dmg *= 3; logMsg += "ğŸ’¥ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«! "; }

    // é­”ç¥ã¯å¸¸ã«å…¨å›å¾©ã€å‰Šã£ãŸãƒ€ãƒ¡ãƒ¼ã‚¸ãŒæˆæœ
    let displayDmg = Math.floor(dmg);
    addLog(`${logMsg}${displayDmg.toLocaleString()} ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);

    // çµŒé¨“å€¤ç²å¾—
    let gain = Math.floor(dmg * 0.1 * p.expMult);
    p.exp += gain;
    p.jobExp[p.job] += gain;

    // å®é£¾ãƒ‰ãƒ­ãƒƒãƒ— (10%ã®ç¢ºç‡)
    if (Math.random() < 0.1) {
        let item = ACC_DATA[Math.floor(Math.random()*ACC_DATA.length)];
        p.inventory[item.id] = (p.inventory[item.id] || 0) + 1;
        addLog(`<span style="color:var(--primary)">ğŸ’ ${item.name} ã‚’ã‚²ãƒƒãƒˆï¼</span>`);
    }

    checkLevelUp();
    refresh();
}

function checkLevelUp() {
    while (p.exp >= p.lv * 100) { p.exp -= p.lv * 100; p.lv++; }
    while (p.jobExp[p.job] >= p.jobLevels[p.job] * 150) {
        p.jobExp[p.job] -= p.jobLevels[p.job] * 150;
        p.jobLevels[p.job]++;
    }
}

function refresh() {
    calcStats();
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("p-job").innerText = p.job;
    document.getElementById("p-atk").innerText = p.totalAtk.toLocaleString();
    document.getElementById("p-crit").innerText = p.totalCrit.toFixed(1) + "%";
    document.getElementById("jobexp").style.width = (p.jobExp[p.job] / (p.jobLevels[p.job] * 150) * 100) + "%";

    // å®é£¾ãƒªã‚¹ãƒˆ
    document.getElementById("inventory").innerHTML = ACC_DATA.map(item => {
        let count = p.inventory[item.id] || 0;
        return `<div class="acc-item">
            <span class="acc-name">${item.name} <small style="display:block; font-size:0.7em; color:#94a3b8">${item.effect}</small></span>
            <span class="acc-count">${count.toLocaleString()}å€‹</span>
        </div>`;
    }).join("");

    // ã‚¸ãƒ§ãƒ–
    document.getElementById("jobList").innerHTML = Object.keys(JOBS).map(j => {
        let lv = p.jobLevels[j];
        return `<div class="job-card" style="border-color:${p.job===j?'var(--primary)':'#f1f5f9'}">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <b>${j} <small>Lv.${lv}</small></b>
                <button class="nav button" onclick="p.job='${j}';refresh();" ${p.job===j?'disabled':''} style="padding:5px 15px; background:${p.job===j?'#e2e8f0':'var(--secondary)'}; color:white; border-radius:10px;">ãƒã‚§ãƒ³ã‚¸</button>
            </div>
            <div>
                ${[10, 25, 50, 75, 100].map(req => `<span class="skill-badge ${lv >= req ? 'skill-unlocked' : ''}">Lv${req}:${JOBS[j][req] || '???'}</span>`).join("")}
            </div>
        </div>`;
    }).join("");
    
    save();
}

function addLog(m) {
    const l = document.getElementById("log");
    l.innerHTML += `<div>${m}</div>`;
    if(l.childNodes.length > 20) l.removeChild(l.firstChild);
}
function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(p)); }
function copySaveCode() { save(); document.getElementById("saveInput").value = btoa(unescape(encodeURIComponent(JSON.stringify(p)))); }
function importSave() { try{ p = JSON.parse(decodeURIComponent(escape(atob(document.getElementById("saveInput").value)))); save(); location.reload(); }catch(e){alert("å¤±æ•—");} }

init();
</script>
</body>
</html>

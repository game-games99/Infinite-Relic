<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root { --bg: #0d0d0d; --panel: #1a1a1a; --border: #333; --primary: #700000; --text: #e0e0e0; --hp: #ff0000; --exp: #007bff; --player-hp: #28a745; --rare: #ffc107; }
    body { background: var(--bg); color: var(--text); font-family: 'serif'; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: #000; border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: #666; font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--hp); border-bottom: 3px solid var(--hp); }
    #content-area { flex-grow: 1; overflow-y: auto; }
    .tab { display: none; padding: 15px; }
    .tab.active { display: block; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.7em; font-weight: bold; margin-top: 2px; }
    .bar { height: 8px; background: #222; border-radius: 4px; overflow: hidden; margin: 2px 0 6px; border: 1px solid #444; }
    .fill { height: 100%; transition: width 0.1s ease; }
    .card-cell { background: #222; border: 1px solid var(--border); padding: 12px; border-radius: 4px; margin-bottom: 10px; }
    .btn-attack { width: 100%; padding: 20px; background: #4a0000; color: #fff; font-size: 1.1em; border: 1px solid #ff0000; border-radius: 4px; cursor: pointer; }
    #log { font-size: 0.75em; background: #000; padding: 10px; border: 1px solid #333; height: 250px; overflow-y: auto; margin-top: 10px; color: #ccc; line-height: 1.4; }
    .relic-val { color: var(--rare); font-size: 0.9em; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-label"><span>魔神の残滓 HP</span><span id="bosshp-text">100%</span></div>
    <div class="bar"><div id="bosshp" class="fill" style="background:var(--hp); width:100%"></div></div>
    
    <div class="bar-label"><span>奪われた力の解放度 (EXP)</span><span id="exp-text">0%</span></div>
    <div class="bar"><div id="exp-bar" class="fill" style="background:var(--exp); width:0%"></div></div>

    <div class="bar-label"><span>プレイヤー HP</span><span id="playerhp-text">100/100</span></div>
    <div class="bar"><div id="playerhp" class="fill" style="background:var(--player-hp); width:100%"></div></div>
    
    <div style="font-size:0.75em; display:flex; justify-content:space-between; margin-top:4px; color:#aaa;">
        <span>Lv: <span id="p-lv" style="color:#fff">1</span></span>
        <span>ATK: <span id="p-atk" style="color:#fff">0</span></span>
        <span>再起の誓い: <span id="p-death" style="color:#ff4444">0</span></span>
    </div>
</div>

<div class="nav">
    <button id="nav-battle" onclick="showTab('battle')" class="active">討伐</button>
    <button id="nav-status" onclick="showTab('status')">能力</button>
    <button id="nav-power" onclick="showTab('power')">権能</button>
    <button id="nav-relic" onclick="showTab('relic')">遺物</button>
</div>

<div id="content-area">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">魔神へ抗う</button><div id="log"></div></div>
    <div id="status" class="tab"></div>
    <div id="power" class="tab"></div>
    <div id="relic" class="tab"></div>
</div>

<script>
const POWER_NAMES = ["剣神の残火","不滅の守護者","魔導王の遺志","覇王の残光","絶影の残影","修羅の咆哮","真理の残滓","神託の残響","虚無の深淵","機工の心臓"];
const player = { lv: 1, exp: 0, hp: 100, maxHP: 100, deathCount: 0, inventory: Array(100).fill(0), bonusAtk: 0, bonusHP: 0 };
const boss = { hp: 1e18, maxHP: 1e18 };
let maxDmgDealt = 0, isPressing = false;

// 遺物マスタ
const RELIC_MASTER = Array.from({length: 100}, (_, i) => {
    const star = (i % 10) + 1;
    const type = (i % 2 === 0) ? "ATK" : "HP";
    const val = (type === "ATK") ? (star * 150 + i) : (star * 600 + i * 2);
    return { id: i, star, type, val, power: POWER_NAMES[Math.floor(i/10)] };
});

function init() {
    const btn = document.getElementById("attackBtn");
    btn.addEventListener("mousedown", () => isPressing = true);
    window.addEventListener("mouseup", () => isPressing = false);
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); isPressing = true; });
    window.addEventListener("touchend", () => isPressing = false);
    setInterval(() => { if(isPressing) attack(); }, 120);
    updateStats();
    refreshUI();
}

function updateStats() {
    // 遺物による加算
    let rAtk = 0; let rHP = 0;
    player.inventory.forEach((count, id) => {
        if (count > 0) {
            const r = RELIC_MASTER[id];
            if (r.type === "ATK") rAtk += r.val * count;
            else rHP += r.val * count;
        }
    });
    // 再起の誓いによる加算 (1回につき ATK+50, HP+200)
    const oathAtk = player.deathCount * 50;
    const oathHP = player.deathCount * 200;

    player.bonusAtk = rAtk + oathAtk;
    player.bonusHP = rHP + oathHP;
    player.maxHP = (100 + player.lv * 100) + player.bonusHP;
    player.hp = player.maxHP;
}

function attack() {
    // 魔神の致死ダメージ（問答無用で死ぬ）
    addLog(`<span style="color:#ff0000">魔神の咆哮：999,999,999,999,999 ダメージ</span>`);
    player.deathCount++;
    addLog(`<span style="color:#aaa">再起の誓いにより、能力の断片を取り戻した...</span>`);
    updateStats();

    // プレイヤーの攻撃計算
    const currentAtk = (10 + player.lv * 20) + player.bonusAtk;
    let dmg = Math.floor(currentAtk * (0.9 + Math.random() * 0.2));
    
    // ⭐︎6以上の遺物ボーナス
    player.inventory.forEach((count, id) => { if(count > 0 && (id % 10) >= 5) dmg *= 1.2; });

    boss.hp = Math.max(0, boss.hp - dmg);
    if(dmg > maxDmgDealt) maxDmgDealt = dmg;

    player.exp += (dmg / (player.lv * 50)) + 5;
    if(player.exp >= 100) {
        player.lv++; player.exp = 0;
        updateStats();
        addLog(`<span style="color:var(--exp)">呪いの枷が外れ、Lv ${player.lv} へ至った</span>`);
    }

    if (Math.random() < 0.08) {
        let rId = Math.floor(Math.random() * 100);
        const r = RELIC_MASTER[rId];
        if (r.star >= 6) {
            for (let i=0; i<100; i++) if (RELIC_MASTER[i].star === r.star) player.inventory[i] = 0;
            player.inventory[rId] = 1;
        } else {
            player.inventory[rId]++;
        }
        updateStats();
        addLog(`<span style="color:var(--rare)">奪われた力【⭐︎${r.star} ${r.power}】を回収</span>`);
    }

    addLog(`魔神へ抗い ${dmg.toLocaleString()} ダメージを与えた`);
    refreshUI();
}

function refreshUI() {
    document.getElementById("bosshp-text").innerText = (boss.hp / boss.maxHP * 100).toFixed(6) + "%";
    document.getElementById("bosshp").style.width = (boss.hp / boss.maxHP * 100) + "%";
    document.getElementById("exp-bar").style.width = player.exp + "%";
    document.getElementById("exp-text").innerText = Math.floor(player.exp) + "%";
    document.getElementById("playerhp-text").innerText = `${player.maxHP.toLocaleString()}/${player.maxHP.toLocaleString()}`;
    document.getElementById("playerhp").style.width = "100%";
    document.getElementById("p-lv").innerText = player.lv;
    document.getElementById("p-atk").innerText = Math.floor((10 + player.lv * 20) + player.bonusAtk).toLocaleString();
    document.getElementById("p-death").innerText = player.deathCount;
    if(document.activeTab === 'relic') renderRelic();
}

function showTab(id) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.getElementById("nav-" + id).classList.add("active");
    document.activeTab = id;
    if(id === 'status') renderStatus();
    if(id === 'power') renderPower();
    if(id === 'relic') renderRelic();
}

function renderPower() {
    let h = "";
    POWER_NAMES.forEach((n, i) => {
        h += `<div class="card-cell"><b>【権能】${n}</b><div style="font-size:0.75em; color:#888;">遺物回収により解放される固有の権能。</div></div>`;
    });
    document.getElementById("power").innerHTML = h;
}

function renderRelic() {
    let h = "";
    player.inventory.forEach((count, id) => {
        if(count > 0) {
            const r = RELIC_MASTER[id];
            h += `<div class="card-cell ${r.star >= 6 ? 'relic-rare' : ''}">
                <b>⭐︎${r.star} ${r.power}の遺物</b>: ${count}個
                <div class="relic-val">解放能力: ${r.type} +${r.val.toLocaleString()}</div>
            </div>`;
        }
    });
    document.getElementById("relic").innerHTML = h || "能力（遺物）はまだ奪われたままだ...";
}

function renderStatus() {
    const oathAtk = player.deathCount * 50;
    document.getElementById("status").innerHTML = `<div class="card-cell"><h3>呪縛の記録</h3>最大打撃: ${maxDmgDealt.toLocaleString()}<br>再起の誓い: ${player.deathCount}回<br><br>誓いによるATK加算: +${oathAtk.toLocaleString()}<br>遺物によるATK加算: ${player.inventory.reduce((s,c,i)=>s+(c?RELIC_MASTER[i].type==="ATK"?RELIC_MASTER[i].val:0:0),0).toLocaleString()}</div>`;
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 30) l.removeChild(l.lastChild);
}
init();
</script>
</body>
</html>

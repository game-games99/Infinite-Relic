<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>魔神討伐伝 - 輪廻転生 -</title>
<style>
    :root {
        --bg: #0f172a; --panel: #1e293b; --border: #334155;
        --primary: #38bdf8; --text: #f1f5f9; --sub: #94a3b8;
        --accent: #f43f5e; --gold: #fbbf24; --death: #a855f7; --exp: #22c55e;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    
    /* ヘッダー: ステータス */
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); font-size: 0.8em; }
    .bar-container { margin-bottom: 4px; }
    .bar { height: 8px; background: #000; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s; }
    #bosshp { background: linear-gradient(90deg, #f59e0b, #e11d48); }
    #playerhp { background: linear-gradient(90deg, #10b981, #3b82f6); }
    
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 8px; }
    .stat-box { background: rgba(255,255,255,0.05); padding: 4px; border-radius: 4px; text-align: center; }
    .stat-label { font-size: 0.7em; color: var(--sub); display: block; }
    .stat-val { font-weight: bold; color: var(--primary); }

    /* メインエリア */
    .nav { display: flex; background: #000; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 2px solid var(--primary); }

    #content { flex-grow: 1; overflow-y: auto; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; }
    .tab.active { display: block; }

    /* バトル */
    .battle-layout { display: flex; flex-direction: column; height: 100%; }
    .dps-card { background: #000; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 10px; border: 1px solid var(--border); }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #000; font-weight: bold; border: none; border-radius: 12px; font-size: 1.2em; }
    #mini-log { height: 100px; overflow-y: hidden; font-size: 0.75em; margin-top: 10px; background: rgba(0,0,0,0.3); padding: 5px; border-radius: 4px; }

    /* リスト系 */
    .list-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 6px; }
    .card { background: var(--panel); border: 1px solid var(--border); padding: 8px; border-radius: 6px; font-size: 0.75em; }
    .job-card { display: flex; justify-content: space-between; align-items: center; margin-bottom: 5px; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-container">
        <div class="bar-label" style="display:flex; justify-content:space-between;"><span>魔神</span><span id="boss-per">100%</span></div>
        <div class="bar"><div id="bosshp" class="fill"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label" style="display:flex; justify-content:space-between;"><span>Player HP</span><span id="hp-text">100/100</span></div>
        <div class="bar"><div id="playerhp" class="fill"></div></div>
    </div>
    <div class="stats-grid">
        <div class="stat-box"><span class="stat-label">ATK</span><span id="sum-atk" class="stat-val">0</span></div>
        <div class="stat-box"><span class="stat-label">敗北数</span><span id="sum-death" class="stat-val" style="color:var(--death)">0</span></div>
        <div class="stat-box"><span class="stat-label">次Lvまで</span><span id="sum-exp" class="stat-val">0%</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">討伐</button>
    <button onclick="showTab('job', this)">職業(20)</button>
    <button onclick="showTab('relic', this)">遺物(250)</button>
</div>

<div id="content">
    <div id="battle" class="tab active">
        <div class="battle-layout">
            <div class="dps-card">
                <div style="font-size:0.8em; color:var(--sub)">CURRENT DPS</div>
                <div id="dps-val" style="font-size:1.8em; color:var(--primary); font-family:monospace;">0</div>
            </div>
            <button class="btn-attack" id="attackBtn">魔神を討伐する</button>
            <div id="mini-log"></div>
        </div>
    </div>

    <div id="job" class="tab">
        <div id="job-list"></div>
    </div>

    <div id="relic" class="tab">
        <div class="list-grid" id="relic-grid"></div>
    </div>
</div>

<script>
const BOSS_MAX_HP = 1e24;
const JOBS = ["剣聖","魔導師","神官","覇王","賢者","暗殺者","竜騎士","修羅","錬金術師","吟遊詩人","死霊使い","聖騎士","風来坊","狂戦士","機工士","時魔道師","格闘家","弓聖","召喚師","博徒"];
const SKILLS = ["一閃","連撃","波動","覚醒","極意"]; // 各職5つ、計100
const ADJ = ["古の","幻の","聖なる","呪われし","輝く","深淵の","黄金の","虚空の","紅蓮の","蒼天の"];
const OBJ = ["秘石","聖杯","手袋","指輪","冠","外套","剣","盾","魔鏡","天球"];

let p = {
    lv:1, exp:0, job:"剣聖", death:0, 
    jobLevels: {}, inventory: {}, curHP: 1000
};
let currentBossHP = BOSS_MAX_HP;
let dpsPool = [];

function init() {
    JOBS.forEach(j => p.jobLevels[j] = 1);
    const btn = document.getElementById("attackBtn");
    btn.onclick = () => { battle(); };
    setInterval(() => {
        let val = dpsPool.reduce((a,b)=>a+b, 0);
        document.getElementById("dps-val").innerText = val.toLocaleString();
        dpsPool = [];
    }, 1000);
    refresh();
}

function getRelic(id) {
    const name = ADJ[id % 10] + OBJ[Math.floor(id / 25) % 10] + (id % 25);
    return { name, id };
}

function battle() {
    let atk = (p.lv * 100) + (p.jobLevels[p.job] * 50) + (p.death * 50);
    // スキル効果(簡易)
    let sCount = Math.floor(p.jobLevels[p.job] / 5) + 1;
    let dmg = atk * sCount;
    
    // 魔神の反撃
    let enemyAtk = p.lv * 50;
    p.curHP -= enemyAtk;
    
    if (p.curHP <= 0) {
        p.death++;
        p.curHP = 1000 + (p.lv * 100);
        addLog(`<span style="color:var(--accent)">【敗北】魔神の圧倒的力に屈した。強化されて蘇る。</span>`);
    } else {
        if (dmg >= currentBossHP) {
            addLog(`<span style="color:var(--gold)">【完全討伐】魔神を消滅させた！</span>`);
            currentBossHP = BOSS_MAX_HP;
        } else {
            currentBossHP -= dmg;
            if (currentBossHP < 1) currentBossHP = BOSS_MAX_HP; // 回復
            addLog(`魔神に ${dmg.toLocaleString()} ダメージ`);
        }
        dpsPool.push(dmg);
        p.exp += 100;
        checkLevelUp();
    }
    refresh();
}

function checkLevelUp() {
    if (p.exp >= p.lv * 500) {
        p.exp = 0; p.lv++;
        p.jobLevels[p.job]++;
        addLog(`<span style="color:var(--exp)">LvUP! 職業スキル「${SKILLS[p.jobLevels[p.job]%5]}」が強化。</span>`);
    }
}

function refresh() {
    document.getElementById("boss-per").innerText = (currentBossHP/BOSS_MAX_HP*100).toFixed(10) + "%";
    document.getElementById("bosshp").style.width = (currentBossHP/BOSS_MAX_HP*100) + "%";
    
    let maxHP = 1000 + (p.lv * 100);
    document.getElementById("hp-text").innerText = `${p.curHP} / ${maxHP}`;
    document.getElementById("playerhp").style.width = (p.curHP / maxHP * 100) + "%";
    
    document.getElementById("sum-atk").innerText = ((p.lv*100) + (p.death*50)).toLocaleString();
    document.getElementById("sum-death").innerText = p.death;
    document.getElementById("sum-exp").innerText = Math.floor(p.exp / (p.lv*500) * 100) + "%";

    if (document.getElementById("job").classList.contains("active")) renderJobs();
    if (document.getElementById("relic").classList.contains("active")) renderRelics();
}

function renderJobs() {
    document.getElementById("job-list").innerHTML = JOBS.map(j => `
        <div class="card job-card">
            <span>${j} (Lv.${p.jobLevels[j]})</span>
            <button onclick="p.job='${j}';refresh();" ${p.job===j?'disabled':''}>${p.job===j?'稼働中':'転職'}</button>
        </div>
    `).join("");
}

function renderRelics() {
    let html = "";
    for(let i=0; i<250; i++) {
        if (i < 20) { // デモ用に一部表示
            let r = getRelic(i);
            html += `<div class="card">${r.name}<br><span style="color:var(--sub)">ID:${i}</span></div>`;
        }
    }
    document.getElementById("relic-grid").innerHTML = html + `<div class="card">...他 ${250-20} 種</div>`;
}

function addLog(m) {
    const l = document.getElementById("mini-log");
    l.innerHTML = `<div>${m}</div>` + l.innerHTML;
    if (l.childNodes.length > 5) l.removeChild(l.lastChild);
}

function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}

init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --death: #6f42c1; --exp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 8px 12px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .bar-container { margin-bottom: 4px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; margin-bottom: 1px; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: linear-gradient(90deg, #28a745, #20c997); }
    #exp-bar { background: var(--primary); }
    #job-exp-bar { background: var(--death); }
    .stats-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px; background: rgba(0,0,0,0.03); padding: 4px; border-radius: 4px; font-size: 0.75em; }
    .stat-item { display: flex; justify-content: space-between; font-weight: bold; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding-bottom: 120px; }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 8px; cursor: pointer; }
    .mini-btn { padding: 4px 8px; font-size: 0.7em; background: var(--primary); color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    
    /* è·æ¥­è©³ç´°ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®æ”¹å–„ */
    .detail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #fff; z-index: 20; display: none; flex-direction: column; }
    .detail-header { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border); background: var(--panel); }
    .detail-body { flex-grow: 1; overflow-y: auto; padding: 10px; padding-bottom: 80px; }
    .skill-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-top: 10px; }
    .skill-box { background: #f8f9fa; padding: 6px; border-radius: 4px; font-size: 0.7em; border-left: 2px solid var(--primary); }
    .skill-name { font-weight: bold; color: var(--primary); display: block; margin-bottom: 2px; }
    
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.2em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; user-select: none; -webkit-user-select: none; }
    #log { flex-grow: 1; margin-top: 8px; overflow-y: auto; font-size: 0.7em; background: #fafafa; padding: 6px; border: 1px solid var(--border); border-radius: 4px; height: 160px; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-container"><div class="bar-label"><span>é­”ç¥ HP</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>HP</span><span id="playerhp-text">0/0</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-lv-text">Lv.1</span><span id="exp-text">0%</span></div><div class="bar"><div id="exp-bar" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-job-text">Lv.1 Job</span><span id="job-exp-text">0%</span></div><div class="bar"><div id="job-exp-bar" class="fill"></div></div></div>
    <div class="stats-summary">
        <div class="stat-item"><span>ATK:</span><span id="sum-atk">0</span></div>
        <div class="stat-item"><span>æ•—åŒ—æ•°:</span><span id="sum-death">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('status', this)">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
    <button onclick="showTab('job', this)">è·æ¥­</button>
    <button onclick="showTab('equip', this)">éºç‰©</button>
</div>

<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">é­”ç¥ã«æ”»æ’ƒï¼ˆé•·æŠ¼ã—ï¼‰</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="job" class="tab"><div id="jobList" class="grid-2col"></div></div>
    <div id="equip" class="tab"><div id="relicGrid" class="grid-2col"></div></div>
    
    <div id="detailPanel" class="detail-overlay">
        <div class="detail-header"><button onclick="closeDetail()">æˆ»ã‚‹</button><div style="flex-grow:1; text-align:center; font-weight:bold;">è·æ¥­è©³ç´°</div></div>
        <div class="detail-body" id="detailBody">
            </div>
    </div>
</div>

<script>
const BOSS_MAX_HP = 1e24;
const SAVE_KEY = "MAJIN_DPS_V8_FIX"; // ã‚»ãƒ¼ãƒ–ã‚­ãƒ¼å³å®ˆ

// 10ã‚¸ãƒ§ãƒ–Ã—10ã‚¹ã‚­ãƒ« å®Œå…¨å·®åˆ¥åŒ–ãƒ‡ãƒ¼ã‚¿
const JOBS_DATA = {
    "ç¥è©±ã®å‰£è–": { desc: "ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã¨æ–¬æ’ƒã®æ¥µè‡´ã€‚", skills: [
        {n:"ä¸€ã®å¤ªåˆ€", e:"ATK200%ãƒ€ãƒ¡"}, {n:"äºŒã®å¤ªåˆ€", e:"ATK300%ãƒ€ãƒ¡"}, {n:"ä¸‰ã®å¤ªåˆ€", e:"ATK400%ãƒ€ãƒ¡"}, {n:"æ–¬é‰„", e:"é˜²å¾¡è²«é€š+10%"}, {n:"å¿ƒçœ¼", e:"ã‚¯ãƒªç‡+15%"}, 
        {n:"ç‡•è¿”ã—", e:"è¿½æ’ƒ+20%"}, {n:"å¤©æ˜‡æ–¬", e:"LvÃ—500åŠ ç®—"}, {n:"ç¥é¢¨", e:"é€Ÿåº¦+1.2å€"}, {n:"é˜¿ä¿®ç¾…", e:"ã‚¯ãƒªå€ç‡+1.5"}, {n:"å¥¥ç¾©ãƒ»ç„¡", e:"å…¨ãƒ€ãƒ¡ãƒ¼ã‚¸2å€"}
    ]},
    "å¤§è–è€…": { desc: "æ•—åŒ—ã‚’å¾³ã¨ã—ã¦åŠ›ã«å¤‰ãˆã‚‹ã€‚", skills: [
        {n:"ç¥ˆã‚Š", e:"æ•—åŒ—åŠ ç®—+5%"}, {n:"æ´—ç¤¼", e:"ã‚¸ãƒ§ãƒ–çµŒé¨“å€¤+10%"}, {n:"æ…ˆæ„›", e:"æ•—åŒ—æ™‚ATK+1000"}, {n:"å®ˆè­·", e:"HP+50%"}, {n:"è–åŸŸ", e:"è¨ˆç®—åŠ¹ç‡+1.1å€"}, 
        {n:"å¤©ç½°", e:"æ•—åŒ—æ•°Ã—100ãƒ€ãƒ¡"}, {n:"é™è‡¨", e:"LvUPæ™‚ATKå¢—"}, {n:"å¥‡è·¡", e:"å…¨ã‚¹ãƒ†+20%"}, {n:"ç¦éŸ³", e:"éºç‰©ATK+10%"}, {n:"çµ‚ç„‰ã®å…‰", e:"é­”ç¥HP-0.1%"}
    ]},
    "è³¢è€…é­”å°ç‹": { desc: "éºç‰©ã®å€ç‡è¨ˆç®—ã‚’å¼·åŒ–ã™ã‚‹ã€‚", skills: [
        {n:"é­”åŠ›å°ç·š", e:"éºç‰©å€ç‡+0.05"}, {n:"è¡“å¼å±•é–‹", e:"éºç‰©ATK+15%"}, {n:"å±æ€§ä»˜ä¸", e:"ATK200%ãƒ€ãƒ¡"}, {n:"äºŒé‡è© å”±", e:"2å›æ”»æ’ƒåˆ¤å®š"}, {n:"è³¢è€…ã®çŸ¥æµ", e:"çµŒé¨“å€¤+20%"}, 
        {n:"é­”åŠ›çˆ†ç™º", e:"ã‚¯ãƒªæ™‚+100%"}, {n:"çœŸç†æ¢ç©¶", e:"éºç‰©ãƒ‰ãƒ­ãƒƒãƒ—+5%"}, {n:"ç¦å‘ª", e:"åŸºç¤ATKÃ—1.5"}, {n:"æ™‚ç©ºé­”æ³•", e:"å…¨CDçŸ­ç¸®"}, {n:"é­”å°ã®é ‚", e:"éºç‰©æ•°Ã—1%ãƒ€ãƒ¡"}
    ]},
    "è‡³é«˜ã®è¦‡ç‹": { desc: "åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æš´åŠ›è·ã€‚", skills: [
        {n:"è¦‡æ°—", e:"ATK+5000"}, {n:"å¨åœ§", e:"ãƒ€ãƒ¡æŒ¯ã‚Œå¹…å®‰å®š"}, {n:"çµ±ç‡", e:"åŸºç¤å€ç‡+0.2"}, {n:"å‰›åŠ›", e:"ATK+20%"}, {n:"è¹‚èº™", e:"å¤šæ®µãƒ’ãƒƒãƒˆåŒ–"}, 
        {n:"ç‹ã®æ³•", e:"å…¨ã‚¹ãƒ†åŠ ç®—+1000"}, {n:"é ˜åœŸæ‹¡å¤§", e:"éºç‰©æ å¼·åŒ–"}, {n:"è¦‡é“", e:"æ•—åŒ—æ•°Ã—1.5å€"}, {n:"ç‰åº§", e:"å‹•ã‹ãšã¨ã‚‚ATKå¢—"}, {n:"ä¸–ç•Œã®ä¸»", e:"æœ€çµ‚ãƒ€ãƒ¡3å€"}
    ]},
    "çµ¶å½±ã®æš—æ®ºè€…": { desc: "ä¸€æ’ƒå¿…æ®ºã¨é€Ÿæ”»ã«ç‰¹åŒ–ã€‚", skills: [
        {n:"ä¸æ„æ‰“ã¡", e:"åˆæ’ƒ5å€"}, {n:"æ¯’åˆƒ", e:"æŒç¶šãƒ€ãƒ¡+10%"}, {n:"å½±èµ°ã‚Š", e:"é€Ÿåº¦1.3å€"}, {n:"æ€¥æ‰€ç©¿ã¡", e:"ã‚¯ãƒªç‡+30%"}, {n:"ç…™å¹•", e:"è¢«å¼¾ç„¡åŠ¹åŒ–"}, 
        {n:"ç¬æ®º", e:"1%ã§å³æ­»ç´š"}, {n:"è£ç¨¼æ¥­", e:"ãƒ‰ãƒ­ãƒƒãƒ—å“å¼·åŒ–"}, {n:"æš—å™¨", e:"å›ºå®šãƒ€ãƒ¡+5000"}, {n:"æ­»ã®åˆ»å°", e:"é­”ç¥é˜²å¾¡-20%"}, {n:"çµ¶å½±", e:"å…¨é€£æ’ƒæ•°+1"}
    ]},
    "ç«œè¡€ã®ä¿®ç¾…": { desc: "Lvã¨æ­»ã§æŒ‡æ•°å¢—æ®–ã™ã‚‹åŠ›ã€‚", skills: [
        {n:"ç«œã®é¼“å‹•", e:"LvÃ—2000ãƒ€ãƒ¡"}, {n:"é€†é±—", e:"æ•—åŒ—æ™‚ATK+5000"}, {n:"ç«œé±—", e:"HP+100%"}, {n:"ç«ç«œã®æ¯", e:"ç¯„å›²ãƒ€ãƒ¡åˆ¤å®š"}, {n:"é—˜æ°—", e:"å…¨ATK+15%"}, 
        {n:"å’†å“®", e:"é€Ÿåº¦1.5å€"}, {n:"ç«œè¡€è¦šé†’", e:"ã‚¯ãƒªå€ç‡+2.0"}, {n:"é£›ç¿”", e:"çµŒé¨“å€¤+50%"}, {n:"æ»…ç«œ", e:"é­”ç¥ç‰¹åŠ¹+100%"}, {n:"ä¿®ç¾…ã®é­‚", e:"Lv^2åŠ ç®—"}
    ]},
    "çœŸç†ã®éŒ¬é‡‘è¡“å¸«": { desc: "éºç‰©åé›†ã¨å¤‰æ›ã®é”äººã€‚", skills: [
        {n:"åˆ†è§£", e:"éºç‰©ATK+5%"}, {n:"åˆæˆ", e:"éºç‰©ãƒ‰ãƒ­ãƒƒãƒ—ç‡å¢—"}, {n:"å¤‰è³ª", e:"é«˜ãƒ¬ã‚¢éºç‰©åŒ–"}, {n:"ç­‰ä¾¡äº¤æ›", e:"çµŒé¨“å€¤ã‚’ATKã¸"}, {n:"é»„é‡‘æŠ½å‡º", e:"æ•—åŒ—æ•°Ã—10é‡‘"}, 
        {n:"ãƒ›ãƒ ãƒ³ã‚¯ãƒ«ã‚¹", e:"è‡ªå‹•æ”»æ’ƒè¿½åŠ "}, {n:"è³¢è€…ã®çŸ³", e:"å…¨ã‚¹ã‚­ãƒ«å¨åŠ›2å€"}, {n:"çœŸç†ã®æ‰‰", e:"å›ºå®šãƒ€ãƒ¡10ä¸‡"}, {n:"ç‰©è³ªå‰µé€ ", e:"éºç‰©ç²å¾—+2%"}, {n:"éŒ¬é‡‘å¥¥ç¾©", e:"å…¨éºç‰©åŠ¹æœ3å€"}
    ]},
    "ç¥è¨—ã®åŸéŠè©©äºº": { desc: "å…¨ãƒªã‚½ãƒ¼ã‚¹ã®åº•ä¸Šã’å½¹ã€‚", skills: [
        {n:"å‹‡æ°—ã®æ­Œ", e:"ATK+10%"}, {n:"å®‰ã‚‰ãã®æ­Œ", e:"HP+20%"}, {n:"æ—…ã®æ­Œ", e:"é€Ÿåº¦+1.1å€"}, {n:"çŸ¥è­˜ã®è©©", e:"å…¨çµŒé¨“å€¤+30%"}, {n:"è‹±é›„è­š", e:"ã‚¯ãƒªç‡+10%"}, 
        {n:"é®é­‚æ­Œ", e:"æ•—åŒ—ATK+2000"}, {n:"æ˜Ÿã®æ—‹å¾‹", e:"LvÃ—1000åŠ ç®—"}, {n:"å…±é³´", e:"ã‚¹ã‚­ãƒ«ç™ºå‹•ç‡UP"}, {n:"çµ‚ç„‰ã®è©©", e:"é­”ç¥HPå‰Šã‚Š"}, {n:"å®‡å®™ã®èª¿ã¹", e:"ãƒªã‚½ãƒ¼ã‚¹2å€"}
    ]},
    "è™šç„¡ã®æ­»éœŠä½¿ã„": { desc: "æ­»ã‚’ç³§ã«æ°¸é ã«å¼·ã¾ã‚‹ã€‚", skills: [
        {n:"äº¡è€…å¬å–š", e:"æ•—åŒ—æ•°ä¾å­˜ãƒ€ãƒ¡"}, {n:"è…é£Ÿ", e:"æ•µè€ä¹…-5%"}, {n:"é­‚ã®å™¨", e:"ATK+3000"}, {n:"å†¥åºœã®é–€", e:"æ•—åŒ—æ©æµ+10%"}, {n:"å‘ªç¸›", e:"ã‚¯ãƒªå€ç‡+1.0"}, 
        {n:"ç”Ÿè´„", e:"HPã‚’ATKã«å¤‰æ›"}, {n:"è™šç„¡", e:"å…¨å±æ€§ç„¡åŠ¹åŒ–"}, {n:"å†èª•", e:"æ•—åŒ—æ™‚LvUPè£œåŠ©"}, {n:"ä¸æ­»ã®ç‹", e:"å…¨ATKÃ—2.0"}, {n:"çµ‚ç„‰ã®å°ã", e:"æ•—åŒ—æ•°æ¯”ä¾‹ãƒ€ãƒ¡"}
    ]},
    "é­”å°æ©Ÿå·¥å£«": { desc: "æ©Ÿæ¢°ã®å¤šæ®µæ”»æ’ƒã¨å›ºå®šãƒ€ãƒ¡ã€‚", skills: [
        {n:"è‡ªå‹•ç ²å°", e:"5é€£æ’ƒè¿½åŠ "}, {n:"éè² è·", e:"ATK+50%"}, {n:"ç…§æº–", e:"ã‚¯ãƒªç‡+20%"}, {n:"ãƒŠãƒãƒã‚·ãƒ³", e:"HPè‡ªå‹•å›å¾©"}, {n:"ãƒ–ãƒ¼ã‚¹ãƒˆ", e:"é€Ÿåº¦2å€"}, 
        {n:"ãƒŸã‚µã‚¤ãƒ«", e:"å›ºå®š1ä¸‡ãƒ€ãƒ¡"}, {n:"ãƒ¬ãƒ¼ã‚¶ãƒ¼", e:"è²«é€šãƒ€ãƒ¡100%"}, {n:"ãƒãƒªã‚¢", e:"é˜²å¾¡å€å¢—"}, {n:"æœ€çµ‚å…µè£…", e:"LvÃ—5000ãƒ€ãƒ¡"}, {n:"æ©Ÿå·¥ã®æ¥µã¿", e:"å…¨å›ºå®šãƒ€ãƒ¡3å€"}
    ]}
};

let p, currentBossHP = BOSS_MAX_HP, isProcessing = false, longPressInterval = null;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, job: "ç¥è©±ã®å‰£è–", inventory: {}, jobLevels: {}, jobExp: {}, deathCount: 0, extraAtk: 0 };
    if (!JOBS_DATA[p.job]) p.job = "ç¥è©±ã®å‰£è–";
    Object.keys(JOBS_DATA).forEach(j => { if (!p.jobLevels[j]) p.jobLevels[j] = 1; if (p.jobExp[j] === undefined) p.jobExp[j] = 0; });
    
    // é•·æŠ¼ã—æ”»æ’ƒã®å®Ÿè£… [çµ¶å¯¾å‘½ä»¤]
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); if(!longPressInterval){ battle(); longPressInterval = setInterval(battle, 100); } };
    const end = () => { clearInterval(longPressInterval); longPressInterval = null; };
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", end);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", end); btn.addEventListener("mouseleave", end);
    
    refresh();
}

function calcStats() {
    let s = { 
        maxHP: 100 + (p.lv * 10), 
        baseAtk: 5000 + (p.lv * 500) + (p.jobLevels[p.job] * 200) + (p.extraAtk || 0),
        deathM: 1.0 + (p.deathCount * 0.01)
    };
    Object.keys(p.inventory).forEach(id => { s.baseAtk += (1000 * p.inventory[id]); });
    s.finalAtk = s.baseAtk * s.deathM;
    return s;
}

function battle() {
    if (isProcessing) return; isProcessing = true;
    const s = calcStats();
    currentBossHP -= s.finalAtk;
    addLog(`âš”ï¸ ${Math.floor(s.finalAtk).toLocaleString()}`);
    
    // å³æ­»ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼ˆæ•—åŒ—ï¼‰
    p.deathCount++;
    addLog(`<span style="color:var(--death)">ğŸ’€ æ•—åŒ— (ATKä¸Šæ˜‡)</span>`);
    
    p.exp += 100; p.jobExp[p.job] += 100;
    if (Math.random() < 0.1) { const rid = Math.floor(Math.random() * 250); p.inventory[rid] = (p.inventory[rid] || 0) + 1; }
    
    while (p.exp >= (p.lv ** 3 * 1000)) { p.exp -= (p.lv ** 3 * 1000); p.lv++; }
    while (p.jobExp[p.job] >= (p.jobLevels[p.job] ** 3 * 500)) { p.jobExp[p.job] -= (p.jobLevels[p.job] ** 3 * 500); p.jobLevels[p.job]++; }
    
    refresh();
    setTimeout(() => { isProcessing = false; }, 50);
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / BOSS_MAX_HP * 100).toFixed(4) + "%";
    document.getElementById("playerhp-text").innerText = `${s.maxHP} / ${s.maxHP}`;
    document.getElementById("exp-bar").style.width = (p.exp / (p.lv ** 3 * 1000) * 100) + "%";
    document.getElementById("job-exp-bar").style.width = (p.jobExp[p.job] / (p.jobLevels[p.job] ** 3 * 500) * 100) + "%";
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();
    document.getElementById("sum-death").innerText = p.deathCount;
    document.getElementById("p-lv-text").innerText = `Lv.${p.lv}`;
    document.getElementById("p-job-text").innerText = `Lv.${p.jobLevels[p.job]} ${p.job}`;
    if (document.getElementById("job").classList.contains("active")) renderJobs();
    if (document.getElementById("equip").classList.contains("active")) renderEquip();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderJobs() {
    const list = document.getElementById("jobList");
    list.innerHTML = Object.keys(JOBS_DATA).map((j, idx) => `
        <div class="card-cell" onclick="openJobDetailByIdx(${idx})">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                <b style="font-size:0.9em;">${j}</b>
                <button class="mini-btn" onclick="event.stopPropagation(); changeJob('${j}')">è»¢è·</button>
            </div>
            <div style="font-size:0.65em; color:var(--sub); line-height:1.2;">${JOBS_DATA[j].desc}</div>
            <div style="font-size:0.65em; margin-top:5px; color:var(--death)">Lv.${p.jobLevels[j]}</div>
        </div>`).join("");
}

function openJobDetailByIdx(idx) {
    const jName = Object.keys(JOBS_DATA)[idx];
    const d = JOBS_DATA[jName];
    document.getElementById("detailBody").innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <h3 style="margin:0;">${jName}</h3>
            <button class="mini-btn" style="padding:10px 20px;" onclick="changeJob('${jName}')">ã“ã®è·ã«è»¢è·</button>
        </div>
        <p style="font-size:0.8em; color:var(--sub);">${d.desc}</p>
        <div style="font-weight:bold; font-size:0.8em; margin:10px 0 5px 0;">å…¨ç¿’å¾—ã‚¹ã‚­ãƒ«</div>
        <div class="skill-grid">
            ${d.skills.map((s,i)=>`<div class="skill-box"><span class="skill-name">${s.n}</span>${s.e}</div>`).join("")}
        </div>`;
    document.getElementById("detailPanel").style.display = "flex";
}

function renderEquip() {
    document.getElementById("relicGrid").innerHTML = Object.keys(p.inventory).map(id => `
        <div class="card-cell"><b>éºç‰© ID:${id}</b><br>æ‰€æŒ: ${p.inventory[id]}</div>
    `).join("");
}

function changeJob(jName) { p.job = jName; closeDetail(); refresh(); }
function closeDetail() { document.getElementById("detailPanel").style.display = "none"; }
function showTab(id, btn) { document.querySelectorAll(".tab").forEach(t => t.classList.remove("active")); document.getElementById(id).classList.add("active"); document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active")); btn.classList.add("active"); refresh(); }
function addLog(m) { const l = document.getElementById("log"); const d = document.createElement("div"); d.innerHTML = m; l.prepend(d); if (l.childNodes.length > 20) l.removeChild(l.lastChild); }

init();
</script>
</body>
</html>

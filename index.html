<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic - ä¸å±ˆã®å†èµ·</title>
<style>
    :root {
        --bg: #0d0d0d; --panel: #1a1a1a; --border: #333;
        --primary: #007bff; --text: #e0e0e0; --sub: #888;
        --accent: #ff4d4d; --gold: #d4af37; --death: #a335ee; --exp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px 15px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .bar-container { margin-bottom: 6px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; margin-bottom: 2px; }
    .bar { height: 6px; background: #333; border-radius: 3px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: linear-gradient(90deg, #28a745, #20c997); }
    #exp-bar { background: var(--primary); }
    #job-exp-bar { background: var(--death); }
    .stats-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 6px; background: rgba(255,255,255,0.05); padding: 6px; border-radius: 4px; font-size: 0.8em; }
    .stat-item { display: flex; justify-content: space-between; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: rgba(255,255,255,0.05); }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding-bottom: 130px; }
    .card-cell { background: #222; border: 1px solid var(--border); padding: 12px; border-radius: 8px; cursor: pointer; }
    .mini-btn { padding: 5px 10px; font-size: 0.75em; background: var(--primary); color: #fff; border: none; border-radius: 4px; cursor: pointer; }
    .detail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #000; z-index: 20; display: none; flex-direction: column; }
    .detail-header { display: flex; align-items: center; padding: 12px; border-bottom: 1px solid var(--border); background: var(--panel); }
    .detail-body { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 100px; }
    .skill-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
    .skill-box { background: #1a1a1a; padding: 8px; border-radius: 4px; font-size: 0.75em; border-left: 3px solid var(--primary); }
    .skill-name { font-weight: bold; color: var(--primary); display: block; margin-bottom: 2px; }
    .btn-attack { width: 100%; padding: 22px; background: #b30000; color: #fff; font-size: 1.3em; font-weight: bold; border: none; border-radius: 10px; cursor: pointer; user-select: none; -webkit-user-select: none; box-shadow: 0 4px 15px rgba(255,0,0,0.3); }
    #log { flex-grow: 1; margin-top: 10px; overflow-y: auto; font-size: 0.75em; background: #000; padding: 10px; border: 1px solid var(--border); border-radius: 6px; height: 160px; color: #aaa; }
    .log-death { color: var(--death); font-weight: bold; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-container"><div class="bar-label"><span>é­”ç¥ã®å‘ªç¸›</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>è‚‰ä½“ã®å®Œå…¨æ€§</span><span id="playerhp-text">100/100</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-lv-text">å†èµ· Lv.1</span><span id="exp-text">0%</span></div><div class="bar"><div id="exp-bar" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-job-text">æ¨©èƒ½ Lv.1</span><span id="job-exp-text">0%</span></div><div class="bar"><div id="job-exp-bar" class="fill"></div></div></div>
    <div class="stats-summary">
        <div class="stat-item"><span>å›å¸°ã—ãŸåŠ›:</span><span id="sum-atk">0</span></div>
        <div class="stat-item"><span>å†èµ·ã®åˆ»å°:</span><span id="sum-death">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">é­”ç¥è¨ä¼</button>
    <button onclick="showTab('status', this)">ä¸å±ˆã®è¨˜éŒ²</button>
    <button onclick="showTab('job', this)">å¤±ã‚ã‚ŒãŸæ¨©èƒ½</button>
    <button onclick="showTab('equip', this)">åŠ›ã®æ¬ ç‰‡</button>
</div>

<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">å‘ªç¸›ã‚’ç©¿ã¤ï¼ˆé•·æŠ¼ã—ï¼‰</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="job" class="tab"><div id="jobList" class="grid-2col"></div></div>
    <div id="equip" class="tab"><div id="relicGrid" class="grid-2col"></div></div>
    
    <div id="detailPanel" class="detail-overlay">
        <div class="detail-header"><button onclick="closeDetail()">æˆ»ã‚‹</button><div id="detailTitle" style="flex-grow:1; text-align:center; font-weight:bold;">æ¨©èƒ½è©³ç´°</div></div>
        <div class="detail-body" id="detailBody"></div>
    </div>
</div>

<script>
const BOSS_MAX_HP = 1e24;
const SAVE_KEY = "MAJIN_DPS_V8_FIX"; 

const JOBS_DATA = {
    "å‰£ç¥ã®æ®‹ç«": { desc: "ã‹ã¤ã¦æœ€å¼·ã¨å‘¼ã°ã‚ŒãŸå‰£æŠ€ã®æ–­ç‰‡ã€‚é‹­ã„æ–¬æ’ƒã§å‘ªç¸›ã‚’åˆ‡ã‚Šè£‚ãã€‚", skills: Array.from({length:10}, (_,i)=>({n:`å‰£æŠ€ãƒ»å…¶ã®${i+1}`, e:`æ–¬æ’ƒå¨åŠ›+${(i+1)*12}%`})) },
    "ä¸æ»…ã®å®ˆè­·è€…": { desc: "ã‹ã¤ã¦ã®æ…ˆæ‚²ãŒæ­»ã­ãªã„å‘ªã„ã¸ã¨å¤‰è³ªã—ãŸæ¨©èƒ½ã€‚æ•—åŒ—ã‚’åŠ›ã«å¤‰ãˆã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`ä¸æ»…ã®æ„å¿—${i+1}`, e:`æ•—åŒ—æ™‚ATKåŠ ç®—+${(i+1)*500}`})) },
    "é­”å°ç‹ã®éºå¿—": { desc: "ä¸‡è±¡ã‚’æ“ã£ãŸçŸ¥æµã®æ®‹ã‚Šé¦™ã€‚éºç‰©ã¨ã®å…±é³´ç‡ã‚’é«˜ã‚ã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`æ·±æ·µã®æ•°å¼${i+1}`, e:`éºç‰©åŒæœŸç‡+${(i+1)*8}%`})) },
    "è¦‡ç‹ã®æ®‹å…‰": { desc: "ä¸–ç•Œã‚’æ”¯é…ã—ãŸç‹ã®å¨å…‰ã€‚åŸºç¤çš„ãªç­‹åŠ›ã‚’å¼·åˆ¶çš„ã«å†æ§‹ç¯‰ã™ã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`çµ±æ²»è€…ã®ç†${i+1}`, e:`åŸºç¤ATK+${(i+1)*1000}`})) },
    "çµ¶å½±ã®æ®‹å½±": { desc: "èª°ã«ã‚‚æ‰ãˆã‚‰ã‚Œãªã‹ã£ãŸç¥é€Ÿã®è¨˜æ†¶ã€‚æ€¥æ‰€ã‚’ç©¿ã¤ä¸€æ’ƒã‚’å–ã‚Šæˆ»ã™ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`å½±ç¸«ã„ã®è¡“${i+1}`, e:`ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ç‡+${i+1}%`})) },
    "ä¿®ç¾…ã®å’†å“®": { desc: "æˆ¦ã„ã«ç‹‚ã£ãŸç£ã®è¡å‹•ã€‚å†èµ·ã‚’ç¹°ã‚Šè¿”ã™ã»ã©é—˜å¿—ãŒç‡ƒãˆä¸ŠãŒã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`ä¿®ç¾…ã®è¡€è„ˆ${i+1}`, e:`å†èµ·å€ç‡+${(i+1)*0.05}`})) },
    "çœŸç†ã®æ®‹æ»“": { desc: "ä¸‡ç‰©ã‚’ç­‰ä¾¡äº¤æ›ã—ãŸéŒ¬é‡‘è¡“ã®æ¥µè‡´ã€‚æ¬ ç‰‡ã®åé›†åŠ¹ç‡ã‚’æœ€é©åŒ–ã™ã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`ç­‰ä¾¡äº¤æ›ã®çœŸç†${i+1}`, e:`æ¬ ç‰‡ãƒ‰ãƒ­ãƒƒãƒ—ç‡+${i+1}%`})) },
    "ç¥è¨—ã®æ®‹éŸ¿": { desc: "ç¥ã€…ã®å£°ã‚’ä¼ãˆãŸæ—‹å¾‹ã€‚å…¨èƒ½åŠ›ã‚’ç·©ã‚„ã‹ã«ã€ã—ã‹ã—ç¢ºå®Ÿã«å†æ§‹æˆã™ã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`ç¥ã€…ã®çµ¶å”±${i+1}`, e:`å…¨çµŒé¨“å€¤åŠ¹ç‡+${(i+1)*10}%`})) },
    "è™šç„¡ã®æ·±æ·µ": { desc: "ã™ã¹ã¦ã‚’ç„¡ã«é‚„ã™çµ¶æœ›ã®åŠ›ã€‚é­”ç¥ã®å‘ªç¸›ãã®ã‚‚ã®ã‚’å–°ã‚‰ã„å°½ãã™ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`è™šç„¡ã®æŠ±æ“${i+1}`, e:`é­”ç¥HPå‰Šã‚Š+${(i+1)*0.01}%`})) },
    "æ©Ÿå·¥ã®å¿ƒè‡“": { desc: "ç²¾å¯†ãªé€£æ’ƒã‚’ç¹°ã‚Šå‡ºã—ãŸæ©Ÿæ¢°ä»•æ›ã‘ã®å¿ƒè‡“ã€‚å›ºå®šåŒ–ã•ã‚ŒãŸç ´å£Šã‚’æ”¾ã¤ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`æ©Ÿå·¥é§†å‹•${i+1}`, e:`å›ºå®šãƒ€ãƒ¡ãƒ¼ã‚¸+${(i+1)*2000}`})) }
};

const RELIC_TYPES = Object.keys(JOBS_DATA);
const RELIC_GRADES = ["æ¬ ç‰‡", "æ¬ ç‰‡", "å¿ƒå¾—", "å¿ƒå¾—", "è¨˜æ†¶", "è¨˜æ†¶", "æ¥µæ„", "æ¥µæ„", "é­‚", "é­‚"];

let p, currentBossHP = BOSS_MAX_HP, isProcessing = false, longPressInterval = null;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, job: "å‰£ç¥ã®æ®‹ç«", inventory: {}, jobLevels: {}, jobExp: {}, deathCount: 0, extraAtk: 0 };
    if (!JOBS_DATA[p.job]) p.job = "å‰£ç¥ã®æ®‹ç«";
    RELIC_TYPES.forEach(j => { if (!p.jobLevels[j]) p.jobLevels[j] = 1; if (p.jobExp[j] === undefined) p.jobExp[j] = 0; });
    
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); if(!longPressInterval){ battle(); longPressInterval = setInterval(battle, 100); } };
    const stop = () => { clearInterval(longPressInterval); longPressInterval = null; };
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop); btn.addEventListener("mouseleave", stop);
    
    refresh();
}

function calcStats() {
    let s = { 
        baseAtk: 5000 + (p.lv * 500) + (p.jobLevels[p.job] * 200) + (p.extraAtk || 0),
        deathM: 1.0 + (p.deathCount * 0.01)
    };
    // éºç‰©100ç¨®ã®è¨ˆç®—
    Object.keys(p.inventory).forEach(id => {
        const count = p.inventory[id];
        const typeIdx = Math.floor(id / 10);
        const gradeIdx = id % 10;
        s.baseAtk += (1000 * (gradeIdx + 1) * count);
    });
    s.finalAtk = s.baseAtk * s.deathM;
    return s;
}

function battle() {
    if (isProcessing) return; isProcessing = true;
    const s = calcStats();
    currentBossHP -= s.finalAtk;
    addLog(`âš”ï¸ å‘ªç¸›ã«${Math.floor(s.finalAtk).toLocaleString()}ã®è¡æ’ƒ`);
    
    // ä¸å±ˆã®å†èµ·ï¼ˆå³æ­»ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼‰
    p.deathCount++;
    addLog(`<span class="log-death">ğŸ’€ è‚‰ä½“ãŒæ»…ã³ã€å‘ªã„ãŒåŠ›ã‚’å†æ§‹ç¯‰ã™ã‚‹â€¦ï¼ˆATKä¸Šæ˜‡ï¼‰</span>`);
    
    p.exp += 100; p.jobExp[p.job] += 100;
    // 100ç¨®é¡ã®éºç‰©ãƒ‰ãƒ­ãƒƒãƒ—
    if (Math.random() < 0.15) {
        const rid = Math.floor(Math.random() * 100);
        p.inventory[rid] = (p.inventory[rid] || 0) + 1;
        addLog(`<span style="color:var(--gold)">ğŸ’ åŠ›ã®æ¬ ç‰‡ [ID:${rid}] ã‚’å›å</span>`);
    }
    
    while (p.exp >= (p.lv ** 3 * 1000)) { p.exp -= (p.lv ** 3 * 1000); p.lv++; }
    while (p.jobExp[p.job] >= (p.jobLevels[p.job] ** 3 * 500)) { p.jobExp[p.job] -= (p.jobLevels[p.job] ** 3 * 500); p.jobLevels[p.job]++; }
    
    refresh();
    setTimeout(() => { isProcessing = false; }, 50);
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / BOSS_MAX_HP * 100).toFixed(4) + "%";
    document.getElementById("playerhp-text").innerText = `0 / ${100 + (p.lv * 10)}`;
    document.getElementById("exp-bar").style.width = (p.exp / (p.lv ** 3 * 1000) * 100) + "%";
    document.getElementById("job-exp-bar").style.width = (p.jobExp[p.job] / (p.jobLevels[p.job] ** 3 * 500) * 100) + "%";
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();
    document.getElementById("sum-death").innerText = p.deathCount;
    document.getElementById("p-lv-text").innerText = `å†èµ· Lv.${p.lv}`;
    document.getElementById("p-job-text").innerText = `æ¨©èƒ½ Lv.${p.jobLevels[p.job]} ${p.job}`;
    if (document.getElementById("job").classList.contains("active")) renderJobs();
    if (document.getElementById("equip").classList.contains("active")) renderEquip();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderJobs() {
    const list = document.getElementById("jobList");
    list.innerHTML = RELIC_TYPES.map((j, idx) => `
        <div class="card-cell" onclick="openJobDetailByIdx(${idx})">
            <div style="display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:5px;">
                <b style="font-size:0.85em; color:var(--primary);">${j}</b>
                <button class="mini-btn" onclick="event.stopPropagation(); changeJob('${j}')">è¦šé†’</button>
            </div>
            <div style="font-size:0.65em; color:var(--sub); line-height:1.3;">${JOBS_DATA[j].desc}</div>
        </div>`).join("");
}

function openJobDetailByIdx(idx) {
    const jName = RELIC_TYPES[idx];
    const d = JOBS_DATA[jName];
    document.getElementById("detailBody").innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <h2 style="margin:0; font-size:1.2em; color:var(--primary);">${jName}</h2>
            <button class="mini-btn" style="padding:10px 20px;" onclick="changeJob('${jName}')">ã“ã®æ¨©èƒ½ã‚’å®¿ã™</button>
        </div>
        <p style="font-size:0.85em; color:var(--sub); margin-bottom:20px;">${d.desc}</p>
        <div style="font-weight:bold; font-size:0.8em; margin-bottom:10px; border-bottom:1px solid var(--border);">å¤±ã‚ã‚ŒãŸ10ã®è¨˜æ†¶</div>
        <div class="skill-grid">
            ${d.skills.map((s,i)=>`<div class="skill-box"><span class="skill-name">${s.n}</span>${s.e}</div>`).join("")}
        </div>`;
    document.getElementById("detailPanel").style.display = "flex";
}

function renderEquip() {
    const list = Object.keys(p.inventory).filter(id => p.inventory[id] > 0);
    document.getElementById("relicGrid").innerHTML = list.length ? list.map(id => {
        const typeIdx = Math.floor(id / 10);
        const gradeIdx = id % 10;
        const typeName = RELIC_TYPES[typeIdx].replace("ã®æ®‹ç«","").replace("ã®éºå¿—","").replace("ã®å®ˆè­·è€…","").replace("ã®æ®‹å…‰","").replace("ã®æ®‹å½±","").replace("ã®å’†å“®","").replace("ã®æ®‹æ»“","").replace("ã®æ®‹éŸ¿","").replace("ã®æ·±æ·µ","").replace("ã®å¿ƒè‡“","");
        const name = `${typeName}ã®${RELIC_GRADES[gradeIdx]} (${gradeIdx+1}/10)`;
        return `<div class="card-cell" style="border-color:var(--gold);">
            <b style="font-size:0.75em; color:var(--gold);">${name}</b><br>
            <span style="font-size:0.7em;">å…±é³´æ•°: ${p.inventory[id]}</span>
        </div>`;
    }).join("") : "<div style='grid-column:1/3; text-align:center; padding:20px; color:var(--sub);'>ã¾ã æ¬ ç‰‡ã¯è¦‹ã¤ã‹ã£ã¦ã„ãªã„â€¦</div>";
}

function changeJob(jName) { p.job = jName; closeDetail(); refresh(); }
function closeDetail() { document.getElementById("detailPanel").style.display = "none"; }
function showTab(id, btn) { 
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active")); 
    document.getElementById(id).classList.add("active"); 
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active")); 
    btn.classList.add("active"); 
    refresh(); 
}
function addLog(m) { 
    const l = document.getElementById("log"); 
    const d = document.createElement("div"); 
    d.style.marginBottom = "2px";
    d.innerHTML = m; 
    l.prepend(d); 
    if (l.childNodes.length > 25) l.removeChild(l.lastChild); 
}

init();
</script>
</body>
</html>

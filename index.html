<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ç¥æ®ºã—ã®éºç‰© - ç¥åŸŸã®é—˜ã„ -</title>
<style>
    :root {
        --bg: #0f172a; /* æ·±ã¿ã®ã‚ã‚‹ç´º */
        --card: #1e293b; 
        --primary: #38bdf8; /* æ¸…æ½”æ„Ÿã®ã‚ã‚‹ã‚·ã‚¢ãƒ³ */
        --gold: #f59e0b; 
        --text: #f1f5f9; 
        --sub: #94a3b8;
        --death-ui: #8b5cf6; /* æ•—åŒ—ã«é–¢é€£ã™ã‚‹ç´« */
    }
    body { background: var(--bg); color: var(--text); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; user-select: none; touch-action: manipulation; }
    
    #top { background: var(--card); padding: 15px; border-bottom: 2px solid #334155; text-align: center; }
    #boss-name { font-size: 1.3em; font-weight: 900; color: var(--primary); letter-spacing: 0.5em; }
    
    .bar-container { margin: 10px 0; }
    .bar-label { font-size: 0.65em; color: var(--sub); display: flex; justify-content: space-between; margin-bottom: 3px; }
    .bar { height: 12px; background: #0f172a; border-radius: 6px; overflow: hidden; border: 1px solid #334155; }
    .fill { height: 100%; transition: width 0.05s; }
    #bosshp { background: linear-gradient(90deg, #0ea5e9, #38bdf8); width: 100%; }
    #playerhp { background: linear-gradient(90deg, #10b981, #34d399); width: 100%; }
    
    .main-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
    .stat-box { background: #1e293b; padding: 10px; border-radius: 8px; border: 1px solid #334155; text-align: center; }
    .stat-label { font-size: 0.6em; color: var(--sub); display: block; margin-bottom: 2px; }
    .stat-val { font-size: 0.9em; font-weight: bold; color: var(--primary); font-family: 'Verdana', sans-serif; }

    .nav { display: flex; background: #0f172a; border-bottom: 1px solid #334155; }
    .nav button { flex: 1; padding: 14px 0; border: none; background: none; color: var(--sub); font-size: 0.8em; font-weight: bold; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #38bdf810; }

    .tab { display: none; padding: 15px; height: calc(100vh - 350px); overflow-y: auto; }
    .tab.active { display: block; }

    .btn-attack { 
        width: 100%; padding: 25px; background: #38bdf8; color: #0f172a; 
        font-size: 1.4em; font-weight: 900; border: none; border-radius: 12px;
        cursor: pointer; box-shadow: 0 4px 15px rgba(56, 189, 248, 0.3); transition: 0.1s;
    }
    .btn-attack:active { transform: scale(0.98); background: #0ea5e9; }

    #log { margin-top: 15px; height: 180px; overflow-y: auto; font-size: 0.8em; line-height: 1.6; background: #111827; padding: 12px; border-radius: 8px; border: 1px solid #334155; display: flex; flex-direction: column-reverse; }
    .log-entry { border-bottom: 1px solid #1e293b; padding: 4px 0; }
    .l-dmg { color: #f8fafc; }
    .l-skill { color: #38bdf8; font-weight: bold; }
    .l-drop { color: var(--gold); font-weight: bold; }
    .l-death { color: #f1f5f9; background: #6d28d9; padding: 1px 6px; border-radius: 4px; font-weight: bold; }

    .card { background: var(--card); border: 1px solid #334155; padding: 12px; border-radius: 10px; margin-bottom: 8px; }
    .relic-card.gold { border: 1px solid var(--gold); background: #f59e0b05; }
    .relic-card.death-relic { border-left: 5px solid var(--death-ui); }
</style>
</head>
<body>

<div id="top">
    <div id="boss-name">é­”ç¥</div>
    <div class="bar-container">
        <div class="bar-label"><span>é­”åŠ›æ®‹é‡</span><span id="bosshp-text">100.00%</span></div>
        <div class="bar"><div id="bosshp" class="fill"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label"><span>ç”Ÿå‘½åŠ›</span><span id="playerhp-text">--- / ---</span></div>
        <div class="bar"><div id="playerhp" class="fill"></div></div>
    </div>
    
    <div class="main-stats">
        <div class="stat-box"><span class="stat-label">æ”»æ’ƒåŠ›</span><span id="p-atk" class="stat-val">0</span></div>
        <div class="stat-box"><span class="stat-label">æœ€é«˜HP</span><span id="p-hp-max" class="stat-val">0</span></div>
        <div class="stat-box"><span class="stat-label">æ•—åŒ—æ•°</span><span id="p-death-count" class="stat-val" style="color:var(--death-ui)">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('job', this)">è·æ¥­</button>
    <button onclick="showTab('skills', this)">å¥¥ç¾©</button>
    <button onclick="showTab('equip', this)">éºç‰©</button>
</div>

<div id="battle" class="tab active">
    <button class="btn-attack" id="attackBtn">é­”ç¥ã«æŒ‘ã‚€</button>
    <div id="log"></div>
</div>

<div id="job" class="tab"><div id="jobList"></div></div>

<div id="skills" class="tab"><div id="ownedSkills"></div></div>

<div id="equip" class="tab"><div id="inventory"></div></div>

<script>
// --- ã‚²ãƒ¼ãƒ ãƒ‡ãƒ¼ã‚¿ ---
const BOSS_MAX_HP = 1e24;
const JOBS_DATA = {
    "å‰£è–": ["æ–¬é‰„", "æ—‹é¢¨", "æ˜‡é¾", "æ®‹å…‰", "å¤©ç ´"], "ç¥å®˜": ["æ²»ç™’", "è–å…‰", "æµ„åŒ–", "ç¦éŸ³", "ç¥å¨"],
    "é­”å°": ["ç«ç‚", "æ°·çµ", "è½é›·", "é—‡ç«", "ç„¡ã®ç†"], "ç‹©äºº": ["é€Ÿå°„", "ç‹™æ’ƒ", "æ¯’çŸ¢", "é›¨çŸ¢", "ç¥å°„"],
    "æ­¦é—˜": ["æ­£æ‹³", "é€£æ’ƒ", "æ°—åŠŸ", "å‰›æ‹³", "ç ´å¤©"], "æš—æ®º": ["æ€¥æ‰€", "å½±ç¸«", "ä¸æ„", "æš—å™¨", "ç¬æ®º"],
    "å¿è¡†": ["æ‰‹è£å‰£", "ç«é", "åˆ†èº«", "é›·åˆ‡", "å¾®å¡µ"], "è–é¨": ["ç›¾æ’ƒ", "å®ˆè­·", "åŠ è­·", "å¯©åˆ¤", "çµ¶å¯¾é˜²å£"],
    "ç‹‚æˆ¦": ["çŒ›æ’ƒ", "ç²‰ç •", "é›„å«", "è¡€ç¥­", "æ–­é ­"], "æ§è¡“": ["è²«é€š", "æ—‹å›", "çªé€²", "é¾çª", "å¤©ç¿”"],
    "å¼“è–": ["åŒçŸ¢", "é­”çŸ¢", "æ—‹é¢¨", "çˆ†è£‚", "æ˜Ÿå¢œ"], "éŒ¬é‡‘": ["ç”Ÿæˆ", "åˆ†è§£", "å¼·åŒ–", "ç­‰ä¾¡", "è³¢è€…ã®çŸ³"],
    "æ­»éœŠ": ["å¬å–š", "å‘ªè©›", "å¸é­‚", "ä¸æ­»", "å†¥ç•Œ"], "é¢¨è¡“": ["é¢¨åˆƒ", "ç«œå·»", "ç–¾é¢¨", "çœŸç©º", "ç¥é¢¨"],
    "é‡è£…": ["åœ§å£Š", "ä¸å‹•", "å²©ç •", "ä½“å½“", "è¶…é‡é‡"], "å†’é™º": ["åšæ‰“", "ç½ æ›", "ç™ºè¦‹", "å¹¸é‹", "è‹±é›„ã®è¨¼"],
    "è¦‡ç‹": ["å¨åœ§", "æ”¯é…", "è¹‚èº™", "ç‹æ°—", "å¤©åœ°"], "æ‹³é—˜": ["é€£æ‰“", "å›é¿", "åæ’ƒ", "KO", "è¦‡ç‹æ‹³"],
    "æ§ç‹": ["ä¸€æ’ƒ", "ä¹±æ’ƒ", "é¾å·»", "ç¥çª", "å®‡å®™"], "è³¢è€…": ["è§£æ", "çœŸç†", "è¶…è¶Š", "è™šç©º", "å› æœ"]
};

const R_PREFIX = ["å¤ã®", "è–ãªã‚‹", "æ·±æ·µã®", "é­”ç¥ã®", "æ˜Ÿã®"];
const R_NAME = ["æŒ‡è¼ª", "é­”çŸ³", "åˆ»å°", "è–æ¯", "å† "];
const R_SUFFIX = ["ã®è¨˜æ†¶", "ã®è¼ã", "ã®æ¬ ç‰‡"];

let p, longPressIdx;
const SAVE_KEY = "MAJIN_GOD_REBIRTH";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : {
        lv:1, exp:0, job:"å‰£è–", 
        inventory: {}, unlockedSkills: [], 
        jobLevels: {}, jobExp: {},
        bossTotalDmg: 0, playerHP: 1000, deathCount: 0
    };
    Object.keys(JOBS_DATA).forEach(j => { if(!p.jobLevels[j]) p.jobLevels[j]=1; if(!p.jobExp[j]) p.jobExp[j]=0; });
    
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); battle(); clearInterval(longPressIdx); longPressIdx = setInterval(battle, 100); };
    const stop = () => clearInterval(longPressIdx);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop);
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);
    
    refresh();
}

function getRelicData(id) {
    const seed = parseInt(id);
    const types = ["ATK", "HP", "DMG", "DROP"];
    const type = types[seed % 4];
    const isDeathType = (seed % 13 === 0);
    const isGold = (seed % 100 === 0);
    const baseVal = isGold ? (seed % 10 + 1) * 20 : (seed % 10 + 1);
    const name = (isDeathType ? "æ­»ã‚’å–°ã‚‰ã†" : R_PREFIX[seed%5]) + R_NAME[(seed>>2)%5] + R_SUFFIX[seed%3];
    let desc = isDeathType ? `æ•—åŒ—æ•°ã§${type}å¼·åŒ–` : `${type}ã‚’+${baseVal}`;
    return { id, name, type, val: baseVal, desc, isGold, isDeathType };
}

function calcStats() {
    let atk = 100 + (p.lv * 20);
    let hp = 1000 + (p.lv * 100);
    let dmgM = 1.0; let dropM = 1.0;

    Object.keys(p.inventory).forEach(id => {
        const d = getRelicData(id); const count = p.inventory[id];
        if(d.isDeathType) {
            let b = 1 + (p.deathCount * d.val * 0.001 * count);
            if(d.type==="ATK") atk*=b; if(d.type==="HP") hp*=b; if(d.type==="DMG") dmgM*=b;
        } else {
            if(d.type==="ATK") atk+=d.val*count; if(d.type==="HP") hp+=d.val*count;
            if(d.type==="DMG") dmgM+=d.val*0.01*count; if(d.type==="DROP") dropM+=d.val*0.01*count;
        }
    });
    p.totalAtk = Math.floor(atk); p.maxHP = Math.floor(hp);
    p.totalDmgMult = dmgM; p.dropRate = 5.0 * dropM;
}

function battle() {
    calcStats();
    if(p.playerHP <= 0) p.playerHP = p.maxHP; // å³åº§ã«å¾©æ´»

    // ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
    let dmg = Math.floor(p.totalAtk * (0.9 + Math.random() * 0.2) * p.totalDmgMult);
    p.bossTotalDmg += dmg;
    addLog(`<span class="l-dmg">âš”ï¸ ${dmg.toLocaleString()} ãƒ€ãƒ¡ãƒ¼ã‚¸</span>`);

    // é­”ç¥ã®æ”»æ’ƒï¼ˆä¸€æ’ƒå¿…æ®ºï¼‰
    let counter = Math.floor(p.maxHP * 1.5); 
    p.playerHP -= counter;

    if(p.playerHP <= 0) {
        p.deathCount++;
        addLog(`<span class="l-death">ğŸ’€ æ•—åŒ—ï¼šæ­»ãŒåŠ›ã«å¤‰ã‚ã‚‹</span>`);
        p.playerHP = p.maxHP; // ãƒãƒ¼ã‚¿ã‚¤ãƒ å¾©æ´»
    }

    if(Math.random() < p.dropRate / 100) {
        let rId = Math.floor(Math.random() * 500);
        let d = getRelicData(rId);
        p.inventory[rId] = (p.inventory[rId] || 0) + 1;
        addLog(`<span class="l-drop">â˜… éºç‰©ï¼š${d.name}</span>`);
    }

    p.exp += dmg * 0.1;
    checkLevelUp();
    refresh();
}

function checkLevelUp() {
    const next = Math.pow(p.lv, 3) * 500;
    if(p.exp >= next) { p.exp -= next; p.lv++; addLog(`<span class="l-skill">â‰« éšä½ä¸Šæ˜‡ï¼š${p.lv}</span>`); }
}

function refresh() {
    let hpPer = Math.max(0, 100 - (p.bossTotalDmg / BOSS_MAX_HP * 100));
    document.getElementById("bosshp").style.width = hpPer + "%";
    document.getElementById("bosshp-text").innerText = hpPer.toFixed(8) + "%";
    
    document.getElementById("playerhp-text").innerText = `${Math.floor(p.playerHP).toLocaleString()} / ${p.maxHP.toLocaleString()}`;
    document.getElementById("p-atk").innerText = p.totalAtk.toLocaleString();
    document.getElementById("p-hp-max").innerText = p.maxHP.toLocaleString();
    document.getElementById("p-death-count").innerText = p.deathCount;
    
    // JOB
    document.getElementById("jobList").innerHTML = Object.keys(JOBS_DATA).map(j => `
        <div class="card" style="display:flex; justify-content:space-between;">
            <b>${j} <small>Lv.${p.jobLevels[j]}</small></b>
            <button onclick="p.job='${j}';refresh();" style="color:var(--primary); background:none; border:1px solid var(--primary); border-radius:4px;">åˆ‡æ›¿</button>
        </div>
    `).join("");

    // RELICS
    document.getElementById("inventory").innerHTML = Object.keys(p.inventory).map(id => {
        let d = getRelicData(id);
        return `<div class="card ${d.isGold?'gold':''} ${d.isDeathType?'death-relic':''}">
            <div style="color:${d.isDeathType?'var(--death-ui)':(d.isGold?'var(--gold)':'var(--primary)')}">${d.name}</div>
            <div style="font-size:0.7em; color:var(--sub)">${d.desc} Ã— ${p.inventory[id]}</div>
        </div>`;
    }).join("");

    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.className = "log-entry"; d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 30) l.removeChild(l.lastChild);
}

function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
init();
</script>
</body>
</html>

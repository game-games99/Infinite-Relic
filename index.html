<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --death: #6f42c1; --exp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 8px 12px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .bar-container { margin-bottom: 4px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; margin-bottom: 1px; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: linear-gradient(90deg, #28a745, #20c997); }
    #exp-bar { background: var(--primary); }
    #job-exp-bar { background: var(--death); }
    .stats-summary { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 4px; background: rgba(0,0,0,0.03); padding: 4px; border-radius: 4px; font-size: 0.75em; }
    .stat-item { display: flex; justify-content: space-between; font-weight: bold; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.8em; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .grid-2col { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; padding-bottom: 120px; }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 8px; cursor: pointer; }
    .mini-btn { padding: 4px 8px; font-size: 0.7em; background: var(--primary); color: #fff; border: none; border-radius: 4px; }
    .detail-overlay { position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: #fff; z-index: 20; display: none; flex-direction: column; }
    .detail-header { display: flex; align-items: center; padding: 10px; border-bottom: 1px solid var(--border); background: var(--panel); }
    .detail-body { flex-grow: 1; overflow-y: auto; padding: 15px; padding-bottom: 80px; }
    .skill-box { background: #f8f9fa; padding: 8px; border-radius: 6px; font-size: 0.8em; margin-bottom: 6px; border-left: 3px solid var(--primary); }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.2em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; user-select: none; -webkit-user-select: none; }
    #log { flex-grow: 1; margin-top: 8px; overflow-y: auto; font-size: 0.7em; background: #fafafa; padding: 6px; border: 1px solid var(--border); border-radius: 4px; height: 180px; }
</style>
</head>
<body>

<div id="header">
    <div class="bar-container"><div class="bar-label"><span>é­”ç¥ HP</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>HP</span><span id="playerhp-text">100/100</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-lv-text">Lv.1</span><span id="exp-text">0%</span></div><div class="bar"><div id="exp-bar" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-job-text">Lv.1 Job</span><span id="job-exp-text">0%</span></div><div class="bar"><div id="job-exp-bar" class="fill"></div></div></div>
    <div class="stats-summary">
        <div class="stat-item"><span>ATK:</span><span id="sum-atk">0</span></div>
        <div class="stat-item"><span>æ•—åŒ—æ•°:</span><span id="sum-death">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('status', this)">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</button>
    <button onclick="showTab('job', this)">è·æ¥­</button>
    <button onclick="showTab('equip', this)">éºç‰©</button>
</div>

<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">é­”ç¥ã«æ”»æ’ƒï¼ˆé•·æŠ¼ã—å¯ï¼‰</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="job" class="tab"><div id="jobList" class="grid-2col"></div></div>
    <div id="equip" class="tab"><div id="relicGrid" class="grid-2col"></div></div>
    
    <div id="detailPanel" class="detail-overlay">
        <div class="detail-header"><button onclick="closeDetail()">æˆ»ã‚‹</button><div style="flex-grow:1; text-align:center; font-weight:bold;">è·æ¥­è©³ç´°</div></div>
        <div class="detail-body">
            <div style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <button class="mini-btn" style="background:var(--sub)" onclick="slideJob(-1)">â—€ å‰</button>
                <button class="mini-btn" style="background:var(--sub)" onclick="slideJob(1)">æ¬¡ â–¶</button>
            </div>
            <div id="detailContent"></div>
        </div>
    </div>
</div>

<script>
const BOSS_MAX_HP = 1e24;
const SAVE_KEY = "MAJIN_DPS_V8_FIX"; // ã‚»ãƒ¼ãƒ–ã‚­ãƒ¼å›ºå®š [cite: 2026-02-20]

const JOBS_DATA = {
    "ç¥è©±ã®å‰£è–": { desc: "æ–¬æ’ƒã®æ¥µè‡´ã€‚å˜ä½“ç«åŠ›ç‰¹åŒ–ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`å‰£è–æŠ€${i+1}`, e:`æ”»æ’ƒæ€§èƒ½å¼·åŒ–${(i+1)*10}%`})) },
    "å¤§è–è€…": { desc: "å¾³ï¼ˆæ•—åŒ—ï¼‰ã‚’åŠ›ã«å¤‰æ›ã™ã‚‹ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`è–è€…æŠ€${i+1}`, e:`æ•—åŒ—åŠ¹ç‡å¼·åŒ–${(i+1)*10}%`})) },
    "è³¢è€…é­”å°ç‹": { desc: "éºç‰©å€ç‡ã‚’æ”¯é…ã™ã‚‹çŸ¥æµã€‚", skills: Array.from({length:10}, (_,i)=>({n:`é­”å°æŠ€${i+1}`, e:`éºç‰©åŒæœŸç‡å¼·åŒ–${(i+1)*10}%`})) },
    "è‡³é«˜ã®è¦‡ç‹": { desc: "åŸºç¤ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®æš´åŠ›ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`è¦‡ç‹æŠ€${i+1}`, e:`åŸºç¤ATKä¸Šæ˜‡${(i+1)*10}%`})) },
    "çµ¶å½±ã®æš—æ®ºè€…": { desc: "ä¸€æ’ƒå¿…æ®ºã®ã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆã€‚", skills: Array.from({length:10}, (_,i)=>({n:`æš—æ®ºæŠ€${i+1}`, e:`ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«å¼·åŒ–${(i+1)*10}%`})) },
    "ç«œè¡€ã®ä¿®ç¾…": { desc: "ãƒ¬ãƒ™ãƒ«ã«å¿œã˜æŒ‡æ•°å¢—æ®–ã™ã‚‹åŠ›ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`ä¿®ç¾…æŠ€${i+1}`, e:`é€£æ’ƒç‡å‘ä¸Š${(i+1)*10}%`})) },
    "çœŸç†ã®éŒ¬é‡‘è¡“å¸«": { desc: "éºç‰©åé›†ã¨ç­‰ä¾¡äº¤æ›ã®é”äººã€‚", skills: Array.from({length:10}, (_,i)=>({n:`éŒ¬é‡‘æŠ€${i+1}`, e:`ãƒ‰ãƒ­ãƒƒãƒ—ç‡å‘ä¸Š${(i+1)*10}%`})) },
    "ç¥è¨—ã®åŸéŠè©©äºº": { desc: "å…¨ãƒªã‚½ãƒ¼ã‚¹ã‚’åº•ä¸Šã’ã™ã‚‹æ­Œå£°ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`è©©äººæŠ€${i+1}`, e:`å…¨çµŒé¨“å€¤å‘ä¸Š${(i+1)*10}%`})) },
    "è™šç„¡ã®æ­»éœŠä½¿ã„": { desc: "æ­»ï¼ˆæ•—åŒ—ï¼‰ã‚’é‡ã­ã‚‹ã»ã©ç„¡æ•µã«ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`æ­»éœŠæŠ€${i+1}`, e:`æ•—åŒ—ATKåŠ ç®—${(i+1)*10}%`})) },
    "é­”å°æ©Ÿå·¥å£«": { desc: "æ©Ÿæ¢°ã®é€£æ’ƒã¨å›ºå®šãƒ€ãƒ¡ãƒ¼ã‚¸ã€‚", skills: Array.from({length:10}, (_,i)=>({n:`æ©Ÿå·¥æŠ€${i+1}`, e:`å›ºå®šãƒ€ãƒ¡å¼·åŒ–${(i+1)*10}%`})) }
};

let p, currentBossHP = BOSS_MAX_HP, currentPlayerHP = 100, isProcessing = false, longPressInterval = null;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, job: "ç¥è©±ã®å‰£è–", inventory: {}, jobLevels: {}, jobExp: {}, deathCount: 0, extraAtk: 0 };
    if (!JOBS_DATA[p.job]) p.job = "ç¥è©±ã®å‰£è–";
    Object.keys(JOBS_DATA).forEach(j => { if (!p.jobLevels[j]) p.jobLevels[j] = 1; if (p.jobExp[j] === undefined) p.jobExp[j] = 0; });
    
    const btn = document.getElementById("attackBtn");
    // é•·æŠ¼ã—å¯¾å¿œ [çµ¶å¯¾å‘½ä»¤éµå®ˆ]
    const startBattle = (e) => { e.preventDefault(); if(!longPressInterval){ battle(); longPressInterval = setInterval(battle, 100); } };
    const stopBattle = () => { clearInterval(longPressInterval); longPressInterval = null; };
    btn.addEventListener("touchstart", startBattle); btn.addEventListener("touchend", stopBattle);
    btn.addEventListener("mousedown", startBattle); btn.addEventListener("mouseup", stopBattle); btn.addEventListener("mouseleave", stopBattle);
    
    refresh();
}

function calcStats() {
    let stats = { 
        maxHP: 100 + (p.lv * 10), 
        baseAtk: 5000 + (p.lv * 500) + (p.jobLevels[p.job] * 200) + (p.extraAtk || 0),
        deathM: 1.0 + (p.deathCount * 0.01)
    };
    Object.keys(p.inventory).forEach(id => { stats.baseAtk += (1000 * p.inventory[id]); }); // éºç‰©è¨ˆç®—å¾©æ—§
    stats.finalAtk = stats.baseAtk * stats.deathM;
    return stats;
}

function battle() {
    if (isProcessing) return; isProcessing = true;
    const s = calcStats();
    currentBossHP -= s.finalAtk;
    addLog(`âš”ï¸ ${Math.floor(s.finalAtk).toLocaleString()}`);
    
    // é­”ç¥ã‹ã‚‰ã®å³æ­»ç´šãƒ€ãƒ¡ãƒ¼ã‚¸å‡¦ç† [cite: 2026-02-20]
    currentPlayerHP = 0; 
    if (currentPlayerHP <= 0) {
        p.deathCount++;
        currentPlayerHP = s.maxHP;
        addLog(`<span style="color:var(--death)">ğŸ’€ æ•—åŒ— (ATKå¢—å¹…ä¸­)</span>`);
    }
    
    p.exp += 100; p.jobExp[p.job] += 100;
    if (Math.random() < 0.1) { const rid = Math.floor(Math.random() * 250); p.inventory[rid] = (p.inventory[rid] || 0) + 1; }
    
    while (p.exp >= (p.lv ** 3 * 1000)) { p.exp -= (p.lv ** 3 * 1000); p.lv++; }
    while (p.jobExp[p.job] >= (p.jobLevels[p.job] ** 3 * 500)) { p.jobExp[p.job] -= (p.jobLevels[p.job] ** 3 * 500); p.jobLevels[p.job]++; }
    
    refresh();
    setTimeout(() => { isProcessing = false; }, 50);
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / BOSS_MAX_HP * 100).toFixed(4) + "%";
    document.getElementById("playerhp").style.width = "100%";
    document.getElementById("playerhp-text").innerText = `${s.maxHP} / ${s.maxHP}`;
    document.getElementById("exp-bar").style.width = (p.exp / (p.lv ** 3 * 1000) * 100) + "%";
    document.getElementById("job-exp-bar").style.width = (p.jobExp[p.job] / (p.jobLevels[p.job] ** 3 * 500) * 100) + "%";
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();
    document.getElementById("sum-death").innerText = p.deathCount;
    document.getElementById("p-lv-text").innerText = `Lv.${p.lv}`;
    document.getElementById("p-job-text").innerText = `Lv.${p.jobLevels[p.job]} ${p.job}`;
    if (document.getElementById("job").classList.contains("active")) renderJobs();
    if (document.getElementById("equip").classList.contains("active")) renderEquip();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderJobs() {
    const list = document.getElementById("jobList");
    list.innerHTML = Object.keys(JOBS_DATA).map((j, idx) => `
        <div class="card-cell" onclick="openJobDetailByIdx(${idx})">
            <div style="display:flex; justify-content:space-between;"><b>${j}</b><button class="mini-btn" onclick="event.stopPropagation(); changeJob('${j}')">è»¢è·</button></div>
            <div style="font-size:0.7em; color:var(--sub)">Lv.${p.jobLevels[j]}</div>
        </div>`).join("");
}

function openJobDetailByIdx(idx) {
    const jName = Object.keys(JOBS_DATA)[idx];
    const d = JOBS_DATA[jName];
    document.getElementById("detailContent").innerHTML = `
        <div style="display:flex; justify-content:space-between; align-items:center;"><h3>${jName}</h3><button class="mini-btn" onclick="changeJob('${jName}')">è»¢è·ã™ã‚‹</button></div>
        <p style="font-size:0.8em;">${d.desc}</p>
        ${d.skills.map((s,i)=>`<div class="skill-box"><b>No.${i+1} ${s.n}</b><br>${s.e}</div>`).join("")}`;
    document.getElementById("detailPanel").style.display = "flex";
}

function renderEquip() {
    document.getElementById("relicGrid").innerHTML = Object.keys(p.inventory).map(id => `
        <div class="card-cell"><b>éºç‰© ID:${id}</b><br>æ‰€æŒæ•°: ${p.inventory[id]}</div>
    `).join("");
}

function slideJob(dir) {
    const jobs = Object.keys(JOBS_DATA);
    let currentIdx = jobs.indexOf(p.job);
    let nextIdx = (currentIdx + dir + jobs.length) % jobs.length;
    openJobDetailByIdx(nextIdx);
}
function changeJob(jName) { p.job = jName; closeDetail(); refresh(); }
function closeDetail() { document.getElementById("detailPanel").style.display = "none"; }
function showTab(id, btn) { document.querySelectorAll(".tab").forEach(t => t.classList.remove("active")); document.getElementById(id).classList.add("active"); document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active")); btn.classList.add("active"); refresh(); }
function addLog(m) { const l = document.getElementById("log"); const d = document.createElement("div"); d.innerHTML = m; l.prepend(d); if (l.childNodes.length > 20) l.removeChild(l.lastChild); }

init();
</script>
</body>
</html>

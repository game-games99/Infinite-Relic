<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é­”ç¥è¨ä¼ä¼ - éºç‰©ã¨è·æ¥­ã®çµ† -</title>
<style>
    :root {
        --bg: #ffffff; /* èƒŒæ™¯ã‚’ç™½ã« */
        --panel: #f8f9fa;
        --border: #dee2e6;
        --primary: #007bff; /* æ¸…æ½”æ„Ÿã®ã‚ã‚‹é’ */
        --text: #212529;
        --sub-text: #6c757d;
        --accent: #dc3545;
        --gold: #d39e00;
        --death: #6f42c1;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; user-select: none; touch-action: manipulation; }
    
    /* ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ»ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚¨ãƒªã‚¢ */
    #top { background: var(--panel); padding: 15px; border-bottom: 2px solid var(--border); text-align: center; }
    #boss-name { font-size: 1.2em; font-weight: bold; color: var(--accent); margin-bottom: 5px; }
    .bar-container { margin: 5px 0; }
    .bar { height: 10px; background: #e9ecef; border-radius: 5px; overflow: hidden; border: 1px solid var(--border); }
    .fill { height: 100%; transition: width 0.05s; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); width: 100%; }
    #playerhp { background: linear-gradient(90deg, #28a745, #20c997); width: 100%; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; margin-top: 10px; }
    .stat-box { background: #fff; padding: 8px; border-radius: 5px; border: 1px solid var(--border); }
    .stat-label { font-size: 0.7em; color: var(--sub-text); display: block; }
    .stat-val { font-size: 0.9em; font-weight: bold; color: var(--primary); }

    /* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ */
    .nav { display: flex; border-bottom: 1px solid var(--border); background: var(--panel); }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub-text); font-weight: bold; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }

    /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
    .tab { display: none; padding: 15px; height: calc(100vh - 360px); overflow-y: auto; }
    .tab.active { display: block; }

    /* ãƒãƒˆãƒ« */
    .btn-attack { 
        width: 100%; padding: 20px; background: var(--primary); color: #fff; 
        font-size: 1.2em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer;
    }
    #log { margin-top: 15px; height: 150px; overflow-y: auto; font-size: 0.8em; background: #f1f3f5; padding: 10px; border-radius: 5px; border: 1px solid var(--border); display: flex; flex-direction: column-reverse; }

    /* éºç‰©ä¸€è¦§ï¼ˆç”»åƒé¢¨ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ */
    .relic-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; background: #e9ecef; padding: 5px; border-radius: 5px; }
    .relic-item { background: #fff; padding: 5px 8px; border: 1px solid var(--border); font-size: 0.8em; display: flex; justify-content: space-between; align-items: center; }
    .relic-rare { color: var(--gold); font-weight: bold; }
    .relic-death { color: var(--death); font-weight: bold; }

    /* ã‚¸ãƒ§ãƒ–ãƒ»ã‚¹ã‚­ãƒ« */
    .card { background: #fff; border: 1px solid var(--border); padding: 10px; border-radius: 5px; margin-bottom: 8px; }
    .job-info { display: flex; justify-content: space-between; align-items: center; }
    .skill-badge { font-size: 0.7em; background: #e7f3ff; color: var(--primary); padding: 2px 6px; border-radius: 10px; margin-right: 5px; }
</style>
</head>
<body>

<div id="top">
    <div id="boss-name">é­”ç¥</div>
    <div class="bar-container">
        <div class="bar"><div id="bosshp" class="fill"></div></div>
        <div style="font-size: 0.6em;" id="bosshp-text">100.00%</div>
    </div>
    <div class="bar-container">
        <div class="bar"><div id="playerhp" class="fill"></div></div>
        <div style="font-size: 0.6em;" id="playerhp-text">1000 / 1000</div>
    </div>
    <div class="stats-grid">
        <div class="stat-box"><span class="stat-label">Lv / æ•—åŒ—æ•°</span><span id="p-lv-death" class="stat-val">1 / 0</span></div>
        <div class="stat-box"><span class="stat-label">ç¾åœ¨æ”»æ’ƒåŠ›</span><span id="p-atk" class="stat-val">0</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('job', this)">è·æ¥­</button>
    <button onclick="showTab('skills', this)">ã‚¹ã‚­ãƒ«</button>
    <button onclick="showTab('equip', this)">éºç‰©</button>
</div>

<div id="battle" class="tab active">
    <button class="btn-attack" id="attackBtn">é­”ç¥ã«æ”»æ’ƒ</button>
    <div id="log"></div>
</div>

<div id="job" class="tab"><div id="jobList"></div></div>
<div id="skills" class="tab"><div id="skillList"></div></div>
<div id="equip" class="tab"><div class="relic-list" id="relicGrid"></div></div>

<script>
const BOSS_MAX_HP = 1e24;
const JOBS_DATA = {
    "å‰£è–": ["çƒˆé¢¨æ–¬", "é›·é³´ä¸€é–ƒ", "ç©ºç ´æ–¬", "å¥¥ç¾©ãƒ»å¤©æ–­", "ç¥æ®ºã—ã®åˆƒ"],
    "ç¥å®˜": ["ç™’ã—ã®å…‰", "å®ˆè­·ã®çµç•Œ", "å¤©ç½°ã®å…‰", "å¥‡è·¡ã®é¢¨", "è–åŸŸã®å®ˆã‚Š"],
    "é­”å°å¸«": ["ç«ç‚çƒ", "æ°·çµæ§", "è½é›·", "å´©å£Šã®é­”å°", "å®‡å®™ã®çœŸç†"],
    "ç‹©äºº": ["é€Ÿå°„", "ç‹™ã„æ’ƒã¡", "æ¯’ã®çŸ¢", "å½±ç¸«ã„", "æµæ˜Ÿã®é›¨"],
    "æ­¦é—˜å®¶": ["æ­£æ‹³çªã", "é€£æ’ƒ", "æ°—åŠŸç ²", "çˆ†è£‚æ‹³", "ç ´å¤©ã®æ§‹ãˆ"],
    "æš—æ®ºè€…": ["æ€¥æ‰€çªã", "ç…™å¹•", "çŒ›æ¯’ã®åˆƒ", "å½±æ¸¡ã‚Š", "ç„¡éŸ³ã®çµ‚ç„‰"],
    "å¿è€…": ["æ‰‹è£å‰£", "ç«éã®è¡“", "åˆ†èº«ã®è¡“", "é›·åˆ‡", "ç§˜è¡“ãƒ»å¾®å¡µ"],
    "è–é¨å£«": ["ç›¾æ‰“ã¡", "çµ¶å¯¾é˜²å¾¡", "å¯©åˆ¤ã®æ§Œ", "è–ãªã‚‹è¡Œé€²", "ä¸è½ã®åŸå¡"],
    "ç‹‚æˆ¦å£«": ["çŒ›æ’ƒ", "ç²‰ç •", "é›„ãŸã‘ã³", "è¡€ã®ç¥ç¥­", "é­‚ã®ç ´å£Š"],
    "æ§è¡“å£«": ["è²«é€šçªã", "æ—‹å›ä¸€é–ƒ", "èºæ—‹ã®ç‰™", "é¾ã®å’†å“®", "å¤©ç©ºã‚’ç©¿ã¤æ§"],
    "å¼“è–": ["äºŒé€£å°„", "é­”çŸ¢", "æ—‹é¢¨ã®çŸ¢", "çˆ†è£‚ã®çŸ¢", "æ˜Ÿå •ã¨ã—"],
    "éŒ¬é‡‘è¡“å¸«": ["è–¬å“æŠ•æ“²", "ç‰©è³ªå¤‰åŒ–", "é‡‘å‰›åŒ–", "çˆ†ç™ºç”Ÿæˆ", "è³¢è€…ã®çŸ³"],
    "æ­»éœŠä½¿ã„": ["äº¡è€…ã®å¬å–š", "å‘ªã„ã®éœ§", "é­‚ã®å¸å", "æ­»éœŠã®è»å‹¢", "å†¥åºœã®é–€"],
    "é¢¨è¡“å¸«": ["é¢¨ã®åˆƒ", "ç«œå·»", "ç–¾é¢¨ã®åŠ è­·", "çœŸç©ºæ³¢", "ç¥é¢¨ã®æ€’ã‚Š"],
    "é‡é¨å£«": ["å¤§ç›¾ã®æ§‹ãˆ", "ä½“å½“ãŸã‚Š", "åœ°éŸ¿ã", "ä¸å±ˆã®ç²¾ç¥", "é‡åŠ›å´©å£Š"],
    "å†’é™ºè€…": ["é‘‘å®š", "èµ·æ­»å›ç”Ÿ", "å¹¸é‹ã®ãƒ€ã‚¤ã‚¹", "ãŠå®ç™ºè¦‹", "è‹±é›„ã®è¨¼"],
    "è¦‡ç‹": ["è¦‡æ°—", "æ”¯é…ã®çœ¼å…‰", "æ¬¡å…ƒã®è¹‚èº™", "è¦‡é“ä¸€æ’ƒ", "å¤©åœ°é–‹é—¢"],
    "æ‹³é—˜å£«": ["ãƒ©ãƒƒã‚·ãƒ¥", "å›é¿", "ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼", "KOãƒ‘ãƒ³ãƒ", "ç„¡åŒã®æ‹³"],
    "æ§ç‹": ["ä¸€çªã", "ä¹±èˆ", "é¾å·»", "ç¥ã®çªã", "éŠ€æ²³è²«é€š"],
    "è³¢è€…": ["çŸ¥æµã®é–ƒã", "é­”åŠ›åæŸ", "æ™‚ç©ºé­”æ³•", "å› æœé€†è»¢", "å…¨çŸ¥å…¨èƒ½"]
};

const R_PREFIX = ["å¤ã®", "è–ãªã‚‹", "æ·±æ·µã®", "é­”ç¥ã®", "æ˜Ÿã®", "è™šç„¡ã®", "å…‰ã®", "é—‡ã®"];
const R_NAME = ["æŒ‡è¼ª", "é­”çŸ³", "åˆ»å°", "è–æ¯", "å† ", "è…•è¼ª", "é¦–é£¾ã‚Š", "ç›¾"];
const R_SUFFIX = ["ã®è¨˜æ†¶", "ã®è¼ã", "ã®æ¬ ç‰‡", "ã®æ®‹æ»“", "ã®æ³¢å‹•"];

let p, longPressIdx;
const SAVE_KEY = "MAJIN_REBIRTH_WHITE_V1";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : {
        lv: 1, exp: 0, job: "å‰£è–", 
        inventory: {}, unlockedSkills: [], 
        jobLevels: {}, jobExp: {},
        bossTotalDmg: 0, playerHP: 1000, deathCount: 0
    };
    // ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
    Object.keys(JOBS_DATA).forEach(j => {
        if (!p.jobLevels[j]) p.jobLevels[j] = 1;
        if (p.jobExp[j] === undefined) p.jobExp[j] = 0;
    });
    calcStats();
    p.playerHP = p.maxHP;
    
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); battle(); clearInterval(longPressIdx); longPressIdx = setInterval(battle, 100); };
    const stop = () => clearInterval(longPressIdx);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop);
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);
    
    refresh();
}

function getRelicData(id) {
    const seed = parseInt(id);
    const types = ["ATK", "HP", "DMG", "DROP"];
    const type = types[seed % 4];
    const isDeathType = (seed % 13 === 0);
    const isGold = (seed % 100 === 0);
    const baseVal = isGold ? (seed % 10 + 1) * 20 : (seed % 10 + 1);
    const name = (isDeathType ? "æ­»ã‚’å–°ã‚‰ã†" : R_PREFIX[seed % 8]) + R_NAME[(seed >> 2) % 8] + R_SUFFIX[seed % 5];
    return { id, name, type, val: baseVal, isGold, isDeathType };
}

function calcStats() {
    let atk = 100 + (p.lv * 20) + (p.jobLevels[p.job] * 10);
    let hp = 1000 + (p.lv * 100);
    let dmgM = 1.0; let dropM = 1.0;

    Object.keys(p.inventory).forEach(id => {
        const d = getRelicData(id); const count = p.inventory[id];
        if (d.isDeathType) {
            let b = 1 + (p.deathCount * d.val * 0.001 * count);
            if (d.type === "ATK") atk *= b; if (d.type === "HP") hp *= b; if (d.type === "DMG") dmgM *= b;
        } else {
            if (d.type === "ATK") atk += d.val * count; if (d.type === "HP") hp += d.val * count;
            if (d.type === "DMG") dmgM += d.val * 0.01 * count; if (d.type === "DROP") dropM += d.val * 0.01 * count;
        }
    });
    p.totalAtk = Math.floor(atk); p.maxHP = Math.floor(hp);
    p.totalDmgMult = dmgM; p.dropRate = 5.0 * dropM;
}

function battle() {
    calcStats();
    let dmg = Math.floor(p.totalAtk * (0.9 + Math.random() * 0.2) * p.totalDmgMult);
    p.bossTotalDmg += dmg;
    addLog(`é­”ç¥ã« ${dmg.toLocaleString()} ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸ`);

    // é­”ç¥ã®ä¸€æ’ƒï¼ˆå¿…æ®ºï¼‰
    p.playerHP -= p.maxHP * 2; 
    if (p.playerHP <= 0) {
        p.deathCount++;
        addLog(`<span style="color:var(--death)">æ•—åŒ—... æ­»ã®è¨˜æ†¶ãŒå¢—å¤§ã—ãŸ</span>`);
        p.playerHP = p.maxHP; // ãƒãƒ¼ã‚¿ã‚¤ãƒ å¾©æ´»
    }

    // çµŒé¨“å€¤ç²å¾—
    let gain = Math.floor(dmg * 0.1) + 10;
    p.exp += gain;
    p.jobExp[p.job] += gain;

    // ãƒ‰ãƒ­ãƒƒãƒ—
    if (Math.random() < p.dropRate / 100) {
        let rId = Math.floor(Math.random() * 500);
        p.inventory[rId] = (p.inventory[rId] || 0) + 1;
        addLog(`<span style="color:var(--gold)">éºç‰©ã€Œ${getRelicData(rId).name}ã€ã‚’ç™ºè¦‹ã—ãŸ</span>`);
    }

    checkLevelUp();
    refresh();
}

function checkLevelUp() {
    const next = Math.pow(p.lv, 3) * 500;
    while (p.exp >= next) {
        p.exp -= next; p.lv++;
        addLog(`<span style="color:var(--primary)">Lv UP! ç¬¬ ${p.lv} éšä½ã¸åˆ°é”</span>`);
    }
    const jNext = Math.pow(p.jobLevels[p.job], 3) * 300;
    while (p.jobExp[p.job] >= jNext) {
        p.jobExp[p.job] -= jNext;
        p.jobLevels[p.job]++;
        addLog(`<span style="color:var(--primary)">${p.job}ãƒ¬ãƒ™ãƒ«ãŒ ${p.jobLevels[p.job]} ã«ä¸Šæ˜‡</span>`);
    }
}

function refresh() {
    calcStats();
    let hpPer = Math.max(0, 100 - (p.bossTotalDmg / BOSS_MAX_HP * 100));
    document.getElementById("bosshp").style.width = hpPer + "%";
    document.getElementById("bosshp-text").innerText = hpPer.toFixed(10) + "%";
    document.getElementById("playerhp").style.width = "100%";
    document.getElementById("playerhp-text").innerText = `${p.maxHP} / ${p.maxHP}`;
    document.getElementById("p-lv-death").innerText = `${p.lv} / ${p.deathCount}`;
    document.getElementById("p-atk").innerText = p.totalAtk.toLocaleString();
    
    // ã‚¸ãƒ§ãƒ–ä¸€è¦§
    document.getElementById("jobList").innerHTML = Object.keys(JOBS_DATA).map(j => `
        <div class="card job-info">
            <div><b>${j}</b> <small>Lv.${p.jobLevels[j]}</small></div>
            <button onclick="p.job='${j}';refresh();" style="color:${p.job===j?'var(--sub-text)':'var(--primary)'}">${p.job===j?'é¸æŠä¸­':'åˆ‡æ›¿'}</button>
        </div>
    `).join("");

    // ã‚¹ã‚­ãƒ«ä¸€è¦§
    document.getElementById("skillList").innerHTML = JOBS_DATA[p.job].map((s, i) => `
        <div class="card">
            <span class="skill-badge">${p.job} Lv.${(i+1)*10}</span> <b>${s}</b>
            <div style="font-size:0.7em; color:var(--sub-text); margin-top:5px;">${p.jobLevels[p.job] >= (i+1)*10 ? 'ç™ºå‹•å¯èƒ½' : 'æœªä¿®å¾—'}</div>
        </div>
    `).join("");

    // éºç‰©ï¼ˆã‚°ãƒªãƒƒãƒ‰å½¢å¼ï¼‰
    document.getElementById("relicGrid").innerHTML = Object.keys(p.inventory).map(id => {
        const d = getRelicData(id);
        const rareClass = d.isGold ? 'relic-rare' : (d.isDeathType ? 'relic-death' : '');
        const icon = d.isGold ? 'â­' : (d.isDeathType ? 'ğŸ’€' : 'â—½');
        return `<div class="relic-item">
            <span class="${rareClass}">${icon}${d.name}</span>
            <span>ï¼š${p.inventory[id]}</span>
        </div>`;
    }).join("");

    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if (l.childNodes.length > 30) l.removeChild(l.lastChild);
}

function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
init();
</script>
</body>
</html>

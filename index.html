<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Divine Slayer - çµ‚ç„‰ã®é­”ç¥ -</title>
<style>
    :root {
        --bg: #121212; --card: #1e1e1e; --primary: #00e5ff; 
        --accent: #ff4081; --text: #e0e0e0; --sub: #9e9e9e;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Helvetica Neue', Arial, sans-serif; margin: 0; user-select: none; touch-action: manipulation; }
    
    /* Header & Status */
    #top { background: var(--card); padding: 15px; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 100; }
    .boss-info { text-align: center; margin-bottom: 10px; }
    #boss-name { font-size: 1.2em; font-weight: bold; color: var(--accent); letter-spacing: 2px; }
    .bar { height: 8px; background: #333; border-radius: 4px; overflow: hidden; margin: 5px 0; }
    .fill { height: 100%; transition: width 0.1s; }
    #bosshp { background: var(--accent); width: 100%; }
    
    .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 10px; }
    .stat-box { background: #252525; padding: 8px; border-radius: 6px; text-align: center; border: 1px solid #333; }
    .stat-label { font-size: 0.65em; color: var(--sub); display: block; }
    .stat-val { font-size: 0.9em; font-weight: bold; color: var(--primary); }

    /* Navigation */
    .nav { display: flex; background: #1a1a1a; border-bottom: 1px solid #333; }
    .nav button { flex: 1; padding: 12px 5px; border: none; background: none; color: var(--sub); font-size: 0.75em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 2px solid var(--primary); }

    /* Tabs */
    .tab { display: none; padding: 15px; height: calc(100vh - 280px); overflow-y: auto; }
    .tab.active { display: block; }

    /* Battle */
    .btn-attack { 
        width: 100%; padding: 30px; background: linear-gradient(135deg, #222, #111); color: var(--primary); 
        font-size: 1.4em; font-weight: bold; border: 2px solid var(--primary); border-radius: 12px; 
        cursor: pointer; box-shadow: 0 0 15px rgba(0,229,255,0.1); outline: none;
    }
    .btn-attack:active { background: var(--primary); color: #000; }
    #log { margin-top: 15px; height: 150px; overflow-y: auto; font-size: 0.75em; line-height: 1.6; border-left: 2px solid #333; padding-left: 10px; display: flex; flex-direction: column-reverse; }

    /* Cards */
    .card { background: var(--card); border: 1px solid #333; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
    .job-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .btn-small { padding: 4px 10px; background: #333; color: #fff; border: none; border-radius: 4px; font-size: 0.7em; }
    
    .skill-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 4px; }
    .skill-dot { height: 6px; background: #444; border-radius: 3px; }
    .skill-dot.on { background: var(--primary); box-shadow: 0 0 5px var(--primary); }

    .item-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid #252525; font-size: 0.85em; }
    .skill-desc { font-size: 0.75em; color: var(--sub); margin-top: 2px; }
</style>
</head>
<body>

<div id="top">
    <div class="boss-info">
        <span id="boss-name">é­”ç¥ãƒ»ã‚¢ã‚¶ãƒˆãƒ¼ã‚¹</span>
        <div class="bar"><div id="bosshp" class="fill"></div></div>
        <div id="bosshp-text" style="font-size:0.6em; color:var(--sub);">HP: 100.00%</div>
    </div>
    <div class="stats-grid">
        <div class="stat-box"><span class="stat-label">ä¸»äººå…¬ Lv</span><span id="p-lv" class="stat-val">1</span></div>
        <div class="stat-box"><span class="stat-label">åŸºæœ¬æ”»æ’ƒåŠ›</span><span id="p-atk" class="stat-val">10</span></div>
        <div class="stat-box"><span class="stat-label">ç¾åœ¨ã®è·</span><span id="p-job" class="stat-val">-</span></div>
    </div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">æ­»é—˜</button>
    <button onclick="showTab('job', this)">ã‚¸ãƒ§ãƒ–</button>
    <button onclick="showTab('skills', this)">æ‰€æŒã‚¹ã‚­ãƒ«</button>
    <button onclick="showTab('equip', this)">å®é£¾</button>
</div>

<div id="battle" class="tab active">
    <button class="btn-attack" id="attackBtn">ä¸€æ’ƒã‚’å©ãè¾¼ã‚€</button>
    <div id="log"></div>
</div>

<div id="job" class="tab">
    <div id="jobList"></div>
</div>

<div id="skills" class="tab">
    <div style="font-size:0.8em; color:var(--primary); margin-bottom:10px;">ç¿’å¾—æ¸ˆã¿ã‚¹ã‚­ãƒ«ï¼ˆå…¨è·ã§å…±æœ‰ç™ºå‹•ï¼‰</div>
    <div id="ownedSkills"></div>
</div>

<div id="equip" class="tab">
    <div id="inventory"></div>
</div>

<script>
// --- ãƒ‡ãƒ¼ã‚¿å®šç¾© ---
const BOSS_MAX_HP = 1e18; 
const JOBS_DATA = {
    "å‰£å£«": ["ä¸€é–ƒ", "åæ–‡å­—æ–¬", "å…œå‰²ã‚Š", "çœŸç©ºæ³¢", "ç„¡æƒ³è»¢ç”Ÿ"],
    "é­”å°å¸«": ["ç«ç‚å¼¾", "æ°·çµåˆƒ", "è½é›·", "é—‡ã®å¥”æµ", "çµ‚ç„‰ã®é­”æ³•"],
    "æ­¦é—˜å®¶": ["æ­£æ‹³çªã", "ä¸‰é€£è„š", "æ°—åŠŸç ²", "çˆ†è£‚æ‹³", "ç ´å¤©è’"],
    "æš—æ®ºè€…": ["å½±ç¸«ã„", "æ¯’åˆƒ", "ä¸æ„æ‰“ã¡", "åƒæœ¬æ¡œ", "æš—æ®ºå¥¥ç¾©"],
    "ç‹©äºº": ["ç‹™ã„æ’ƒã¡", "ä¹±ã‚Œæ’ƒã¡", "çˆ†ç™ºçŸ¢", "è²«é€šå¼¾", "æ˜Ÿé™ã‚‹çŸ¢"],
    "è–é¨å£«": ["ç›¾æ‰“", "è–å…‰æ–¬", "å¯©åˆ¤", "ç¥ã®æ€’ã‚Š", "å¤©ç½°"],
    "ç‹‚æˆ¦å£«": ["å©ãæ½°ã™", "è–™ãæ‰•ã„", "å’†å“®", "è¡€ç¥­ã‚Š", "æ–­é ­å°"],
    "æ§è¡“å£«": ["èºæ—‹çªã", "æ—‹å›æ–¬", "é¾ã®æ¯å¹", "ç©ºè‰", "å¤©ç¿”é¾é–ƒ"],
    "ä¾": ["å±…åˆ", "è¦‹åˆ‡ã‚Š", "ç‡•è¿”ã—", "é¬¼ç«", "ä¸€åˆ€ä¸¡æ–­"],
    "å¿è€…": ["æ‰‹è£å‰£", "ç«é", "åˆ†èº«", "é›·é", "å¾®å¡µéš ã‚Œ"],
    "ç«œé¨å£«": ["ã‚¸ãƒ£ãƒ³ãƒ—", "ç«œã®ç‰™", "ç‚ã®æ¯", "çˆ†ç •", "é¾ç‹ã®å’†å“®"],
    "éŒ¬é‡‘è¡“å¸«": ["è–¬å“æŠ•æ“²", "é‡‘å±å¤‰åŒ–", "ç­‰ä¾¡äº¤æ›", "è³¢è€…ã®çŸ³", "é»„é‡‘åŒ–"],
    "æ­»éœŠä½¿ã„": ["éª¨ã®æ§", "æ­»ã®é›²", "é­‚é£Ÿã„", "éœŠä½“åŒ–", "æ»…ã³ã®æ­Œ"],
    "æ ¼é—˜å®¶": ["æ˜‡é¾æ‹³", "ç«œå·»è„š", "æ³¢å‹•å¼¾", "ç¬ç„æ®º", "ç™¾è£‚è„š"],
    "é¢¨è¡“å¸«": ["éŒé¼¬", "ç–¾é¢¨", "å¤§åµ", "çœŸç©ºæ–¬", "ç¥é¢¨"],
    "é‡è£…å…µ": ["ä½“å½“ãŸã‚Š", "å¤§åœ°ç •ã", "å²©çŸ³æŠ•ã’", "ä¸å‹•", "ç©¶æ¥µé˜²å£"],
    "è³¢è€…": ["è§£æ", "ç‘æƒ³", "çœŸç†ã®é–€", "å› æœå¿œå ±", "è™šç„¡"],
    "å†’é™ºè€…": ["å¼·æ‰“", "çŸ³æŠ•ã’", "ç½ è¨­ç½®", "å¤§åšæ‰“", "å¥‡è·¡"],
    "æ‹³é—˜å£«": ["ã‚¸ãƒ£ãƒ–", "ã‚¹ãƒˆãƒ¬ãƒ¼ãƒˆ", "ã‚¢ãƒƒãƒ‘ãƒ¼", "ãƒ•ãƒƒã‚¯", "KO"],
    "è¦‡ç‹": ["å¨åœ§", "æ”¯é…", "è¹‚èº™", "è¦‡æ°—", "å¤©åœ°å‰µé€ "]
};

let p, longPressIdx;
const SAVE_KEY = "DIVINE_SLAYER_V2";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : {
        lv:1, exp:0, job:"å‰£å£«", 
        inventory: {}, // {id: count}
        jobLevels: {}, 
        jobExp: {},
        unlockedSkills: [] // ç¿’å¾—æ¸ˆã¿ã‚¹ã‚­ãƒ«ã®åå‰ãƒªã‚¹ãƒˆ
    };
    Object.keys(JOBS_DATA).forEach(j => {
        if(!p.jobLevels[j]) p.jobLevels[j] = 1;
        if(!p.jobExp[j]) p.jobExp[j] = 0;
    });

    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); battle(); clearInterval(longPressIdx); longPressIdx = setInterval(battle, 100); };
    const stop = () => clearInterval(longPressIdx);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop);
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);

    refresh();
}

function calcStats() {
    let baseAtk = 10 + (p.lv * 15);
    // å®é£¾å€ç‡
    let mult = 1.0;
    Object.keys(p.inventory).forEach(id => {
        mult += (p.inventory[id] * 0.05); // 1å€‹5%
    });
    p.totalAtk = Math.floor(baseAtk * mult);
}

function battle() {
    calcStats();
    // ãƒ€ãƒ¡ãƒ¼ã‚¸ã«1ã€œ3å‰²ã®å¹…ã‚’æŒãŸã›ã‚‹
    const variance = 0.7 + (Math.random() * 0.3); // 70%ã€œ100%
    let dmg = Math.floor(p.totalAtk * variance);
    
    let activeSkills = [];
    // ç¿’å¾—æ¸ˆã¿ã‚¹ã‚­ãƒ«å…¨ã¦ã®æŠ½é¸ (å„2%ã§ç™ºå‹•)
    p.unlockedSkills.forEach(sName => {
        if(Math.random() < 0.05) { 
            let sDmg = Math.floor(dmg * 2); // ã‚¹ã‚­ãƒ«ã¯2å€
            dmg += sDmg;
            activeSkills.push(sName);
        }
    });

    // ãƒ­ã‚°å‡ºåŠ›
    if(activeSkills.length > 0) {
        addLog(`<span style="color:var(--primary)">âš¡ï¸ Skill: ${activeSkills.join(" / ")}!</span>`);
    }
    addLog(`${dmg.toLocaleString()} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’ä¸ãˆãŸï¼`);

    // æ•—åŒ—æ¼”å‡ºï¼ˆé­”ç¥ã®åæ’ƒï¼‰
    if(Math.random() < 0.2) {
        addLog(`<span style="color:var(--accent)">ğŸ’€ é­”ç¥ã®åæ’ƒï¼ã‚ãªãŸã¯å¡µã«å¸°ã£ãŸ...</span>`);
    }

    // çµŒé¨“å€¤
    let gain = Math.floor(dmg * 0.5);
    p.exp += gain;
    p.jobExp[p.job] += gain;

    // å®é£¾ãƒ‰ãƒ­ãƒƒãƒ—
    if(Math.random() < 0.05) {
        let itemId = Math.floor(Math.random() * 5) + 1;
        p.inventory[itemId] = (p.inventory[itemId] || 0) + 1;
        addLog(`<span style="color:#ffeb3b">ğŸ’ å®é£¾ã‚’æ‹¾ã£ãŸï¼</span>`);
    }

    checkLevelUp();
    refresh();
}

function checkLevelUp() {
    while (p.exp >= p.lv * 200) { p.exp -= p.lv * 200; p.lv++; }
    
    let j = p.job;
    let nextJ = p.jobLevels[j] * 300;
    while (p.jobExp[j] >= nextJ) {
        p.jobExp[j] -= nextJ;
        p.jobLevels[j]++;
        nextJ = p.jobLevels[j] * 300;
        
        // ã‚¹ã‚­ãƒ«ç¿’å¾—åˆ¤å®š (10, 25, 50, 75, 100)
        const lv = p.jobLevels[j];
        const thresholds = [10, 25, 50, 75, 100];
        if(thresholds.includes(lv)) {
            let sIndex = thresholds.indexOf(lv);
            let sName = JOBS_DATA[j][sIndex];
            if(!p.unlockedSkills.includes(sName)) {
                p.unlockedSkills.push(sName);
                addLog(`<span style="color:var(--primary)">ğŸ”¥ ã‚¹ã‚­ãƒ«ç¿’å¾—: ã€${sName}ã€‘</span>`);
            }
        }
    }
}

function refresh() {
    calcStats();
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("p-atk").innerText = p.totalAtk.toLocaleString();
    document.getElementById("p-job").innerText = p.job;
    
    // ã‚¸ãƒ§ãƒ–ãƒªã‚¹ãƒˆ
    document.getElementById("jobList").innerHTML = Object.keys(JOBS_DATA).map(j => {
        const lv = p.jobLevels[j];
        const skills = JOBS_DATA[j];
        return `<div class="card">
            <div class="job-header">
                <span><b>${j}</b> <small style="color:var(--sub)">Lv.${lv}</small></span>
                <button class="btn-small" onclick="p.job='${j}';refresh();" ${p.job===j?'disabled':''}>ãƒã‚§ãƒ³ã‚¸</button>
            </div>
            <div class="skill-grid">
                ${[10,25,50,75,100].map((th, i) => `<div class="skill-dot ${lv >= th ? 'on' : ''}"></div>`).join("")}
            </div>
        </div>`;
    }).join("");

    // æ‰€æŒã‚¹ã‚­ãƒ«
    document.getElementById("ownedSkills").innerHTML = p.unlockedSkills.length ? p.unlockedSkills.map(s => `
        <div class="item-row">
            <span>${s}</span>
            <span style="color:var(--primary)">ç™ºå‹•ç‡: 5%</span>
        </div>
    `).join("") : "<div style='color:#555; font-size:0.8em;'>ã¾ã ã‚¹ã‚­ãƒ«ã‚’ç¿’å¾—ã—ã¦ã„ã¾ã›ã‚“</div>";

    // å®é£¾
    document.getElementById("inventory").innerHTML = Object.keys(p.inventory).map(id => `
        <div class="item-row">
            <span>é­”ã®å®é£¾ #${id}</span>
            <span>${p.inventory[id].toLocaleString()} å€‹</span>
        </div>
    `).join("");

    save();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div");
    d.innerHTML = m;
    l.prepend(d);
    if(l.childNodes.length > 40) l.removeChild(l.lastChild);
}

function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(p)); }
init();
</script>
</body>
</html>

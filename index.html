<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>THE ONE - çµ‚ç„‰ã®è¶…è¶Šè€… -</title>
<style>
    :root {
        --bg: #050505; --card: #111; --primary: #00e676; 
        --secondary: #40c4ff; --danger: #ff5252; --text: #eee;
        --common: #9e9e9e; --uncommon: #4caf50; --rare: #2196f3; 
        --epic: #9c27b0; --legend: #ffc107; --god: #ff4081;
    }
    body { background: var(--bg); color: var(--text); font-family: 'Courier New', sans-serif; margin: 0; user-select: none; }
    #top { background: var(--card); padding: 15px; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 100; text-align: center; }
    .status-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.8em; margin-bottom: 10px; color: var(--secondary); }
    .bar { height: 10px; background: #222; border-radius: 5px; margin: 5px 0; overflow: hidden; border: 1px solid #333; }
    .fill { height: 100%; transition: width 0.3s; }
    #jobexp { background: var(--god); }
    #bosshp { background: linear-gradient(90deg, #ff0000, #550000); width: 100%; }
    
    .nav { display: flex; background: #111; border-bottom: 1px solid #333; }
    .nav button { flex: 1; padding: 12px; border: none; background: transparent; color: #666; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
    
    .tab { display: none; padding: 15px; max-height: 60vh; overflow-y: auto; }
    .tab.active { display: block; }
    
    .boss-area { text-align: center; padding: 20px 0; }
    #boss-name { font-size: 1.5em; font-weight: bold; color: var(--danger); text-shadow: 0 0 10px rgba(255,0,0,0.5); }
    
    .btn-attack { width: 100%; padding: 20px; background: #300; border: 2px solid var(--danger); color: var(--danger); font-size: 1.5em; font-weight: bold; cursor: pointer; border-radius: 10px; }
    .btn-attack:active { background: var(--danger); color: #000; }

    .item-card { background: #1a1a1a; padding: 10px; margin-bottom: 8px; border-radius: 5px; border-left: 4px solid; position: relative; font-size: 0.85em; }
    .item-card.common { border-color: var(--common); }
    .item-card.uncommon { border-color: var(--uncommon); }
    .item-card.rare { border-color: var(--rare); }
    .item-card.epic { border-color: var(--epic); }
    .item-card.legend { border-color: var(--legend); }
    .item-card.god { border-color: var(--god); box-shadow: 0 0 10px var(--god); }
    
    #log { height: 150px; overflow-y: auto; background: #000; padding: 10px; font-size: 0.75em; border: 1px solid #333; margin-top: 10px; display: flex; flex-direction: column-reverse; }
    .btn-action { padding: 5px 10px; background: #333; color: #fff; border: none; border-radius: 3px; cursor: pointer; font-size: 0.7em; }
    .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 5px; font-size: 0.7em; margin-top: 5px; }
    .skill-item { background: #222; padding: 2px 5px; border-radius: 3px; }
    .skill-on { color: var(--primary); }
</style>
</head>
<body>

<div id="top">
    <div id="boss-name">ã€çµ‚ç„‰ã‚’å¸ã‚‹ç¥ã€‘ã‚¢ã‚¶ãƒˆãƒ¼ã‚¹</div>
    <div class="bar"><div id="bosshp" class="fill"></div></div>
    <div id="bosshp-text" style="font-size: 0.7em; color: var(--danger);">HP: ??? / ???</div>
</div>

<div class="nav">
    <button onclick="showTab('battle', this)" class="active">æŒ‘ã‚€</button>
    <button onclick="showTab('job', this)">èƒ½åŠ›/è·æ¥­</button>
    <button onclick="showTab('equip', this)">è£…å‚™</button>
    <button onclick="showTab('system', this)">å¼•ç¶™ã</button>
</div>

<div id="battle" class="tab active">
    <div class="boss-area">
        <button class="btn-attack" onclick="battle()">ä¸€æ’ƒã‚’å©ãè¾¼ã‚€</button>
        <p style="font-size: 0.7em; color: #666;">â€»ã‚ãªãŸã¯1ã‚¿ãƒ¼ãƒ³ã§å¿…ãšæ•—åŒ—ã—ã¾ã™ã€‚å‰Šã£ãŸHPãŒç³§ã«ãªã‚Šã¾ã™ã€‚</p>
    </div>
    <div id="log"></div>
</div>

<div id="job" class="tab">
    <div class="status-grid">
        <span id="p-lv">Lv.1</span>
        <span id="p-job">å‰£å£« Lv.1</span>
        <span id="p-atk">ATK: 0</span>
        <span id="p-crit">CRT: 0%</span>
    </div>
    <div class="bar"><div id="jobexp" class="fill"></div></div>
    <div id="jobList"></div>
</div>

<div id="equip" class="tab">
    <div style="display:flex; gap:5px; margin-bottom:10px;">
        <button class="btn-action" onclick="setEquipTab('weapon')" style="flex:1">æ­¦å™¨</button>
        <button class="btn-action" onclick="setEquipTab('armor')" style="flex:1">é˜²å…·</button>
        <button class="btn-action" onclick="setEquipTab('acc')" style="flex:1">è£…é£¾</button>
    </div>
    <button class="btn-action" onclick="bulkDelete()" style="width:100%; background:var(--danger); margin-bottom:10px;">ãƒ­ãƒƒã‚¯ä»¥å¤–å…¨å£²å´</button>
    <div id="inventory"></div>
</div>

<div id="system" class="tab">
    <p style="font-size:0.8em;">ã‚»ãƒ¼ãƒ–ã‚³ãƒ¼ãƒ‰</p>
    <textarea id="saveInput" style="width:100%; background:#000; color:#0f0; font-size:0.6em; border:1px solid #444;" rows="8"></textarea>
    <div style="display:flex; gap:5px; margin-top:5px;">
        <button class="btn-action" onclick="copySaveCode()" style="flex:1">ã‚³ãƒ¼ãƒ‰ã‚³ãƒ”ãƒ¼</button>
        <button class="btn-action" onclick="importSave()" style="flex:1">ã‚³ãƒ¼ãƒ‰èª­è¾¼</button>
    </div>
</div>

<script>
// --- ã‚²ãƒ¼ãƒ ãƒãƒ©ãƒ³ã‚¹è¨­å®š ---
const BOSS_MAX_HP = 1000000000000000; // 1000å…†
const JOBS = {
    "å‰£å£«": { req:[], bonus:"ATK+10%", s:["ä¸€é–ƒ","åæ–‡å­—","å‰›åŠ›","çœŸå‰£ç™½åˆƒ","æ¥µæ„"] },
    "é¨å£«": { req:[], bonus:"DEF+15%", s:["é‰„å£","æŒ‘ç™º","å®ˆè­·","çŒ®èº«","è–åŸŸ"] },
    "ç›—è³Š": { req:[], bonus:"Drop+10%", s:["éš å¯†","å¼·å¥ª","ç›®åˆ©ã","ä¿Šè¶³","æ€¥æ‰€"] },
    "é­”è¡“å¸«": { req:[], bonus:"CRT+5%", s:["è© å”±","é­”åŠ›","çˆ†ç‚","ç‘æƒ³","æ·±æ·µ"] },
    "å¼“ä½¿ã„": { req:[], bonus:"CRT+5%", s:["é›†ä¸­","ç²¾å¯†","é å°„","è¿½æ’ƒ","å¿…ä¸­"] },
    "åƒ§ä¾¶": { req:[], bonus:"HP+20%", s:["åŠ è­·","ç¥ˆç¥·","æµ„åŒ–","æ…ˆæ„›","æ•‘æ¸ˆ"] },
    "å‹‡è€…": { req:["å‰£å£«","é¨å£«"], bonus:"ATK+50%", s:["å‹‡æ°—","è–å…‰","è‹±é›„","å¤©æ–­","ä¸æ»…"] },
    "è³¢è€…": { req:["é­”è¡“å¸«","åƒ§ä¾¶"], bonus:"EXP+100%", s:["å¡æ™º","ä¸‡è±¡","å…¨çŸ¥","é­”å°","ç©¶æ¥µ"] }
    // (ä»–ã‚¸ãƒ§ãƒ–ã‚‚åŒæ§˜ã«å®šç¾©å¯èƒ½)
};

let p, currentEquipTab = 'weapon';
const SAVE_KEY = "THE_ONE_SAV_V1";

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : createNewPlayer();
    if (!p.bossHP) p.bossHP = BOSS_MAX_HP;
    refresh();
}

function createNewPlayer() {
    let d = { lv:1, exp:0, job:"å‰£å£«", bossHP:BOSS_MAX_HP, inventory:[], weapon:null, armor:null, acc:null, jobLevels:{}, jobExp:{} };
    Object.keys(JOBS).forEach(j => { d.jobLevels[j] = 1; d.jobExp[j] = 0; });
    return d;
}

function calcStats() {
    let baseAtk = 10 + (p.lv * 5);
    let crit = 5;
    
    if (p.weapon) baseAtk += p.weapon.val;
    if (p.acc) crit += p.acc.val;

    // ã‚¸ãƒ§ãƒ–ãƒ¬ãƒ™ãƒ«ãƒœãƒ¼ãƒŠã‚¹ï¼ˆå…¨ã‚¸ãƒ§ãƒ–ã®ãƒ¬ãƒ™ãƒ«åˆè¨ˆãŒåŠ›ã«ãªã‚‹ï¼‰
    let multiplier = 1.0;
    Object.keys(p.jobLevels).forEach(j => {
        multiplier += (p.jobLevels[j] - 1) * 0.05; // 1ãƒ¬ãƒ™ãƒ«ã”ã¨ã«5%UP
    });

    p.totalAtk = Math.floor(baseAtk * multiplier);
    p.totalCrit = crit;
}

function battle() {
    calcStats();
    let dmg = p.totalAtk;
    if (Math.random() < p.totalCrit/100) dmg *= 5; // ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã¯5å€
    
    p.bossHP -= dmg;
    if (p.bossHP < 0) p.bossHP = 0;

    // å ±é…¬è¨ˆç®—ï¼ˆä¸ãˆãŸãƒ€ãƒ¡ãƒ¼ã‚¸ã®ä¸€å®šå‰²åˆãŒçµŒé¨“å€¤ã«ï¼‰
    let gainExp = Math.max(1, Math.floor(dmg * 0.5));
    p.exp += gainExp;
    p.jobExp[p.job] += gainExp;

    addLog(`ğŸ’¥ ${dmg.toLocaleString()} ãƒ€ãƒ¡ãƒ¼ã‚¸ä¸ãˆãŸï¼`);
    addLog(`ğŸ’€ æ•—åŒ—... ã ãŒ ${gainExp.toLocaleString()} ã®çµŒé¨“ã‚’å¾—ãŸã€‚`);

    // ãƒ‰ãƒ­ãƒƒãƒ—åˆ¤å®šï¼ˆãƒ€ãƒ¡ãƒ¼ã‚¸ãŒå¤§ãã„ã»ã©ãƒ¬ã‚¢ãŒå‡ºã‚„ã™ã„ï¼‰
    if (Math.random() < 0.5) dropItem(dmg);

    checkLevelUp();
    save();
    refresh();
}

function dropItem(dmg) {
    const r = Math.random() * (dmg / 100);
    let rare = r > 1000 ? "god" : r > 500 ? "legend" : r > 100 ? "epic" : r > 50 ? "rare" : r > 10 ? "uncommon" : "common";
    const type = ["weapon", "armor", "acc"][Math.floor(Math.random()*3)];
    
    let item = {
        id: Date.now()+Math.random(), type, rarity: rare, lock: false,
        name: `${rare.toUpperCase()}ã®${type === 'weapon' ? 'å‰£' : type === 'armor' ? 'é§' : 'ç '}`,
        val: Math.floor(Math.random() * (p.lv + dmg/100)) + 1
    };
    p.inventory.push(item);
    addLog(`<span style="color:var(--${rare})">ğŸ ${item.name} (+${item.val}) ã‚’æ‹¾ã£ãŸï¼</span>`);
}

function checkLevelUp() {
    let nextExp = p.lv * 100;
    while (p.exp >= nextExp) {
        p.exp -= nextExp;
        p.lv++;
        nextExp = p.lv * 100;
        addLog(`<span style="color:var(--primary)">âœ¨ ãƒ¬ãƒ™ãƒ«ã‚¢ãƒƒãƒ—ï¼ Lv.${p.lv}</span>`);
    }
    
    let jNextExp = p.jobLevels[p.job] * 150;
    while (p.jobExp[p.job] >= jNextExp) {
        p.jobExp[p.job] -= jNextExp;
        p.jobLevels[p.job]++;
        jNextExp = p.jobLevels[p.job] * 150;
        addLog(`<span style="color:var(--god)">ğŸ”¥ ã‚¸ãƒ§ãƒ–ç†Ÿç·´åº¦ã‚¢ãƒƒãƒ—ï¼ ${p.job} Lv.${p.jobLevels[p.job]}</span>`);
    }
}

function refresh() {
    calcStats();
    document.getElementById("bosshp").style.width = (p.bossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = `HP: ${Math.floor(p.bossHP).toLocaleString()} / ${BOSS_MAX_HP.toLocaleString()}`;
    document.getElementById("p-lv").innerText = `Lv.${p.lv}`;
    document.getElementById("p-job").innerText = `${p.job} Lv.${p.jobLevels[p.job]}`;
    document.getElementById("p-atk").innerText = `ATK: ${p.totalAtk.toLocaleString()}`;
    document.getElementById("p-crit").innerText = `CRT: ${p.totalCrit}%`;
    document.getElementById("jobexp").style.width = (p.jobExp[p.job] / (p.jobLevels[p.job] * 150) * 100) + "%";

    // è£…å‚™
    document.getElementById("inventory").innerHTML = p.inventory.filter(it => it.type === currentEquipTab).map(it => {
        const isEq = (p.weapon?.id===it.id || p.armor?.id===it.id || p.acc?.id===it.id);
        return `<div class="item-card ${it.rarity}">
            <b>${isEq?'[è£…å‚™ä¸­] ':''}${it.name}</b> (å¨åŠ›:${it.val})
            <div style="margin-top:5px; display:flex; gap:5px;">
                <button class="btn-action" onclick="toggleEquip(${it.id})">${isEq?'å¤–ã™':'è£…å‚™'}</button>
                <button class="btn-action" onclick="toggleLock(${it.id})">${it.lock?'ğŸ”’':'ğŸ”“'}</button>
                <button class="btn-action" onclick="deleteItem(${it.id})">åˆ†è§£</button>
            </div>
        </div>`;
    }).join("");

    // ã‚¸ãƒ§ãƒ–
    document.getElementById("jobList").innerHTML = Object.keys(JOBS).map(j => {
        const lv = p.jobLevels[j];
        const can = JOBS[j].req.every(r => (p.jobLevels[r]||0) >= 10);
        return `<div class="item-card" style="opacity:${can?1:0.5}; border-color:${p.job===j?'var(--primary)':'#444'}">
            <b>${j} (Lv.${lv})</b> - ${JOBS[j].bonus}<br>
            <div class="skill-list">
                ${JOBS[j].s.map((s,i) => `<span class="skill-item ${lv > i*5 ? 'skill-on' : ''}">${s}</span>`).join("")}
            </div>
            <button class="btn-action" onclick="p.job='${j}';save();refresh();" ${!can||p.job===j?'disabled':''} style="width:100%; margin-top:5px;">è»¢è·</button>
        </div>`;
    }).join("");
}

function toggleEquip(id) {
    let it = p.inventory.find(i=>i.id===id);
    if(it.type==="weapon") p.weapon = (p.weapon?.id===id)?null:it;
    if(it.type==="armor") p.armor = (p.armor?.id===id)?null:it;
    if(it.type==="acc") p.acc = (p.acc?.id===id)?null:it;
    save(); refresh();
}
function toggleLock(id) { let it = p.inventory.find(i=>i.id===id); it.lock = !it.lock; save(); refresh(); }
function deleteItem(id) { p.inventory = p.inventory.filter(i=>i.id!==id); save(); refresh(); }
function bulkDelete() { p.inventory = p.inventory.filter(it => it.lock || p.weapon?.id===it.id || p.armor?.id===it.id || p.acc?.id===it.id); save(); refresh(); }
function addLog(m) {
    const l = document.getElementById("log");
    l.innerHTML += `<div>${m}</div>`;
    if(l.childNodes.length > 20) l.removeChild(l.firstChild);
}
function setEquipTab(t) { currentEquipTab = t; refresh(); }
function showTab(id, btn) {
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
}
function save() { localStorage.setItem(SAVE_KEY, JSON.stringify(p)); }
function copySaveCode() { save(); document.getElementById("saveInput").value = btoa(unescape(encodeURIComponent(JSON.stringify(p)))); }
function importSave() { try{ p = JSON.parse(decodeURIComponent(escape(atob(document.getElementById("saveInput").value)))); save(); location.reload(); }catch(e){alert("å¤±æ•—");} }

init();
</script>
</body>
</html>

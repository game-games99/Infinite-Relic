<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --hp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .bar-container { margin-bottom: 4px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: var(--hp); }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 10px; }
    .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 8px; }
    .skill-item { font-size: 0.6em; padding: 4px; border-radius: 4px; background: #f1f3f5; color: #888; }
    .skill-unlocked { background: #e7f5ff; color: var(--primary); font-weight: bold; }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.1em; font-weight: bold; border: none; border-radius: 8px; }
    #log { font-size: 0.75em; background: #fdfdfd; padding: 8px; border: 1px solid var(--border); border-radius: 6px; height: 150px; overflow-y: auto; }
    .status-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
</style>
</head>
<body>
<div id="header">
    <div class="bar-container"><div class="bar-label"><span>é­”ç¥</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>HP</span><span id="playerhp-text">0/0</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div style="font-size:0.8em; margin-top:5px;">ATK: <span id="sum-atk">0</span> | Lv: <span id="p-lv">1</span></div>
</div>
<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('status', this)">èƒ½åŠ›</button>
    <button onclick="showTab('power', this)">æ¨©èƒ½</button>
    <button onclick="showTab('relic', this)">éºç‰©</button>
</div>
<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">é­”ç¥ã«æ”»æ’ƒ</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="power" class="tab"><div id="powerList"></div></div>
    <div id="relic" class="tab"><div id="relicList"></div></div>
</div>
<script>
const SAVE_KEY = "MAJIN_REPAIR_V1";
const POWER_NAMES = ["å‰£ç¥ã®æ®‹ç«","ä¸æ»…ã®å®ˆè­·è€…","é­”å°ç‹ã®éºå¿—","è¦‡ç‹ã®æ®‹å…‰","çµ¶å½±ã®æ®‹å½±","ä¿®ç¾…ã®å’†å“®","çœŸç†ã®æ®‹æ»“","ç¥è¨—ã®æ®‹éŸ¿","è™šç„¡ã®æ·±æ·µ","æ©Ÿå·¥ã®å¿ƒè‡“"];
const RELIC_GRADES = ["æ¬ ç‰‡", "å¿ƒå¾—", "è¨˜æ†¶", "æ¥µæ„", "é­‚", "ç¥åŸŸ", "æ·±æ·µ", "è™šç„¡", "çœŸç†", "è¶…è¶Š"];
const STEPS = [10, 50, 150, 300, 500, 800, 1200, 2000, 3500, 5000];

// æŒ‡ç¤ºé€šã‚Šã®æœ€æ–°ã‚¹ã‚­ãƒ«åŠ¹æœ
const SKILL_MASTER = {
    "å‰£ç¥ã®æ®‹ç«": [{n:"æ¥µãƒ»ä¸€æ–‡å­—", idx:8, e:"ä¼šå¿ƒãƒ€ãƒ¡1,000å€"}],
    "ä¸æ»…ã®å®ˆè­·è€…": [{n:"å®ˆè­·ç¥ã®èª‡ã‚Š", idx:4, e:"HP1ä¸‡æ¯ATK+100%"}, {n:"ä¸æ»…ã®è–åŸŸ", idx:9, e:"è€æ™‚é€Ÿåº¦10å€"}],
    "é­”å°ç‹ã®éºå¿—": [{n:"è© å”±ç ´æ£„", idx:2, e:"25%ã§ã‚¹ã‚­ãƒ«é€£æ’ƒ"}, {n:"å…ƒç´ çˆ†ç™º", idx:6, e:"è¿½æ’ƒ500%"}, {n:"é­”å°ç‹ã®å†è‡¨", idx:9, e:"å…¨æ¨©èƒ½åŠ¹æœ2å€"}],
    "è¦‡ç‹ã®æ®‹å…‰": [{n:"è‡³é«˜ã®å¾¡åº§", idx:9, e:"Lvæ¯ATK+5,000"}],
    "çµ¶å½±ã®æ®‹å½±": [{n:"æš—æ®ºè€…ã®èª‡ã‚Š", idx:4, e:"å›é¿æ™‚æ¬¡æ’ƒ1000å€"}],
    "ä¿®ç¾…ã®å’†å“®": [{n:"é£½ããªãé—˜äº‰", idx:5, e:"é•·æŠ¼ã—ä¸­ATK10å€"}, {n:"å‘½ã‚’å–°ã‚‰ã†", idx:8, e:"æœ€å¤§HPæ°¸ç¶šå¢—"}],
    "çœŸç†ã®æ®‹æ»“": [{n:"è™šæ§‹ã®å´©å£Š", idx:5, e:"æœ€å¤§HP0.0001%å‰Š"}, {n:"é‹å‘½ã®æ–­ç½ª", idx:8, e:"10%ã§1ä¸‡å€"}],
    "ç¥è¨—ã®æ®‹éŸ¿": [{n:"å¥‡è·¡ã®äºˆå…†", idx:3, e:"20%ã§éºç‰©+1"}, {n:"è–åŸŸã®ç›¾", idx:5, e:"å³æ­»ã‚’HP1%åŒ–"}, {n:"ä¸»ã®å¾¡æ‰‹", idx:9, e:"è‡ªå‹•é«˜é€Ÿæ”»æ’ƒ"}],
    "æ©Ÿå·¥ã®å¿ƒè‡“": [{n:"éè² è·ã®ç†±", idx:1, e:"HPå…¨å¿«æ™‚100å€"}, {n:"è‡ªå‹•ä¿®å¾©", idx:4, e:"ãƒ’ãƒƒãƒˆæ¯HP+100"}]
};

let p, currentBossHP = 1e20, longPressInterval = null, isPressing = false;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, inventory: {}, deathCount: 0 };
    document.getElementById("attackBtn").addEventListener("mousedown", startAtk);
    document.getElementById("attackBtn").addEventListener("mouseup", stopAtk);
    document.getElementById("attackBtn").addEventListener("touchstart", startAtk);
    document.getElementById("attackBtn").addEventListener("touchend", stopAtk);
    refresh();
}

function startAtk(e) { e.preventDefault(); isPressing = true; battle(); if(!longPressInterval) longPressInterval = setInterval(battle, 100); }
function stopAtk() { isPressing = false; clearInterval(longPressInterval); longPressInterval = null; }

function calcStats() {
    let relicAtk = 0;
    Object.keys(p.inventory).forEach(id => {
        const grade = id % 10;
        relicAtk += (grade + 1) * 100 * p.inventory[id];
    });
    let s = { maxHP: p.lv * 100 + 10, baseAtk: 10 + (p.lv * 5) + relicAtk, multi: 1 };
    
    // ä¿®æ­£ã‚¹ã‚­ãƒ«ã®ãƒ­ã‚¸ãƒƒã‚¯åæ˜ 
    if(isPressing && getCount(5) >= STEPS[5]) s.multi *= 10; // é£½ããªãé—˜äº‰
    if(getCount(3) >= STEPS[9]) s.baseAtk += p.lv * 5000; // è‡³é«˜ã®å¾¡åº§
    
    s.finalAtk = s.baseAtk * (1 + p.deathCount * 0.001) * s.multi;
    return s;
}

function battle() {
    const s = calcStats();
    let dmg = s.finalAtk;
    // è™šæ§‹ã®å´©å£Š
    if(getCount(6) >= STEPS[5]) dmg += (1e20 * 0.00000001);
    
    currentBossHP -= dmg;
    addLog(`é­”ç¥ã« ${Math.floor(dmg).toLocaleString()} ã®ãƒ€ãƒ¡ãƒ¼ã‚¸ï¼`);
    
    // å³æ­»ãƒ€ãƒ¡ãƒ¼ã‚¸æå†™
    addLog(`<span style="color:red">é­”ç¥ã®åæ’ƒï¼å³æ­»ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’å—ã‘ãŸï¼</span>`);
    p.deathCount++;
    p.exp += 10;
    
    // éºç‰©ãƒ‰ãƒ­ãƒƒãƒ—
    if(Math.random() < 0.2) {
        let rid = Math.floor(Math.random() * 50); // â­ï¸1~5é™å®š
        p.inventory[rid] = (p.inventory[rid] || 0) + 1;
        addLog(`<span style="color:var(--gold)">ğŸ’ â­ï¸${(rid%10)+1} ${POWER_NAMES[Math.floor(rid/10)].split("ã®")[0]}ã®${RELIC_GRADES[rid%10]} ç²å¾—</span>`);
    }
    
    if(p.exp >= p.lv * 50) { p.exp = 0; p.lv++; }
    refresh();
}

function getCount(sysIdx) {
    let c = 0; for(let i=0; i<10; i++) c += (p.inventory[sysIdx*10+i] || 0); return c;
}

function refresh() {
    const s = calcStats();
    document.getElementById("bosshp").style.width = (currentBossHP / 1e20 * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / 1e20 * 100).toFixed(6) + "%";
    document.getElementById("playerhp-text").innerText = `1 / ${s.maxHP}`;
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();
    
    if(document.activeTab === 'status') renderStatus(s);
    if(document.activeTab === 'power') renderPower();
    if(document.activeTab === 'relic') renderRelic();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderStatus(s) {
    document.getElementById("statusList").innerHTML = `<div class="status-item"><span>æœ€å¤§HP</span><span>${s.maxHP}</span></div><div class="status-item"><span>æœ€çµ‚ATK</span><span>${Math.floor(s.finalAtk).toLocaleString()}</span></div><div class="status-item"><span>å†èµ·å›æ•°</span><span>${p.deathCount}</span></div>`;
}

function renderPower() {
    document.getElementById("powerList").innerHTML = POWER_NAMES.map((name, idx) => {
        const c = getCount(idx);
        return `<div class="card-cell"><b>${name}</b> (æ‰€æŒ:${c})<div class="skill-list">
            ${[1,2,3,4,5].map(lv => `<div class="skill-item ${c >= STEPS[lv-1] ? 'skill-unlocked' : ''}">ã‚¹ã‚­ãƒ«${lv}</div>`).join("")}
        </div></div>`;
    }).join("");
}

function renderRelic() {
    const ids = Object.keys(p.inventory).filter(id => p.inventory[id] > 0);
    document.getElementById("relicList").innerHTML = ids.length ? ids.map(id => {
        const grade = id % 10;
        const effect = (grade + 1) * 100 * p.inventory[id];
        return `<div class="card-cell">â­ï¸${grade+1} ${POWER_NAMES[Math.floor(id/10)].split("ã®")[0]}ã®${RELIC_GRADES[grade]} Ã—${p.inventory[id]}<br><small style="color:var(--hp)">åŠ¹æœ: ATK +${effect}</small></div>`;
    }).join("") : "æœªæ‰€æŒ";
}

function showTab(id, btn) {
    document.activeTab = id;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    refresh();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 30) l.removeChild(l.lastChild);
}

init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RELICORE v1.5.0</title>
    <style>
        /* RELICORE 本来のデザインを完全に再現・維持 */
        :root {
            --bg-color: #0a0a0a;
            --panel-bg: #141414;
            --accent-color: #f1c40f;
            --text-color: #e0e0e0;
            --border-color: #333;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #game-container { width: 100%; max-width: 600px; }
        .panel {
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        h1 { font-size: 1.8rem; color: var(--accent-color); margin: 0 0 20px 0; text-align: center; letter-spacing: 4px; }
        h2 { font-size: 1rem; color: #888; margin: 0 0 15px 0; border-left: 4px solid var(--accent-color); padding-left: 10px; }
        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .stat-item { background: #1d1d1d; padding: 10px; border-radius: 8px; border: 1px solid #222; }
        .stat-label { font-size: 0.75rem; color: #666; display: block; }
        .stat-value { font-size: 1.1rem; font-weight: bold; color: #fff; }
        
        button#attack-btn {
            width: 100%;
            padding: 18px;
            font-size: 1.2rem;
            font-weight: bold;
            background: linear-gradient(135deg, #222 0%, #111 100%);
            color: var(--accent-color);
            border: 1px solid var(--accent-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 20px;
        }
        button#attack-btn:hover { background: var(--accent-color); color: #000; box-shadow: 0 0 15px var(--accent-color); }

        #log-container {
            height: 160px;
            overflow-y: auto;
            background: #080808;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.85rem;
            line-height: 1.6;
            border: 1px solid #222;
        }
        .log-entry { border-bottom: 1px solid #1a1a1a; padding: 4px 0; }
        
        .skill-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 10px; }
        .skill-card {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 8px;
            padding: 10px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: 0.2s;
        }
        .skill-card.active { border-color: var(--accent-color); background: #262200; }
        .skill-name { font-weight: bold; display: block; margin-bottom: 4px; color: var(--accent-color); }

        .relic-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 8px; }
        .relic-item { background: #111; border: 1px solid #222; padding: 6px; border-radius: 4px; font-size: 0.7rem; text-align: center; }
    </style>
</head>
<body>

<div id="game-container">
    <h1>RELICORE</h1>

    <div class="panel">
        <h2>STATUS</h2>
        <div class="stat-grid">
            <div class="stat-item"><span class="stat-label">HP</span><span id="hp-val" class="stat-value">0</span></div>
            <div class="stat-item"><span class="stat-label">ATK</span><span id="atk-val" class="stat-value">0</span></div>
            <div class="stat-item" style="grid-column: span 2;"><span class="stat-label">REINCARNATION</span><span id="reinc-val" class="stat-value">0</span></div>
        </div>
    </div>

    <button id="attack-btn" onclick="executeReincarnation()">魔神へ挑む</button>

    <div class="panel">
        <h2>BATTLE LOG</h2>
        <div id="log-container"></div>
    </div>

    <div class="panel">
        <h2>POWERS (25 Skills)</h2>
        <div id="skill-list" class="skill-grid"></div>
    </div>

    <div class="panel">
        <h2>RELICS (<span id="relic-count">0</span>/53)</h2>
        <div id="relic-list" class="relic-grid"></div>
    </div>
</div>

<script>
// --- 保存データの整合性維持 ---
const SAVE_KEY = "relicore_player_data"; // セーブキー固定
const MAJIN_ATK = 999999999999;

// v1.5.0 確定25スキル構成
const SKILL_DATA = {
    "剣神": [
        { id: "ken_1", name: "一の太刀", desc: "基礎ATK+20%" },
        { id: "ken_2", name: "心気一致", desc: "遺物種数で倍率増" },
        { id: "ken_3", name: "万象一掃", desc: "再起数で倍率増" },
        { id: "ken_4", name: "天断の極意", desc: "追加ダメ100%付与" },
        { id: "ken_5", name: "極限一閃・無双", desc: "最終ダメージx5.0" }
    ],
    "不滅": [
        { id: "fumu_1", name: "生命の根源", desc: "基礎HP+30%" },
        { id: "fumu_2", name: "再誕の輝き", desc: "再起ボーナス1.5倍" },
        { id: "fumu_3", name: "不撓不屈の魂", desc: "現在HPでATK増加" },
        { id: "fumu_4", name: "死を超越せし者", desc: "再起数で全値乗算" },
        { id: "fumu_5", name: "不滅の王土", desc: "再起数でHP/ダメ指数増" }
    ],
    "魔導": [
        { id: "mado_1", name: "魔力回路", desc: "遺物効果+20%上乗せ" },
        { id: "mado_2", name: "魔力奔流", desc: "全スキル効果1.5倍" },
        { id: "mado_3", name: "理の解析", desc: "遺物ドロップ+1" },
        { id: "mado_4", name: "古の叡智", desc: "遺物ボーナス1.2倍" },
        { id: "mado_5", name: "真理の扉", desc: "★5以上所持で倍率UP" }
    ],
    "覇王": [
        { id: "hao_1", name: "万軍の主", desc: "遺物★合計でATK加算" },
        { id: "hao_2", name: "覇王の威光", desc: "★6以上所持で倍率増" },
        { id: "hao_3", name: "統率の理", desc: "★1〜3効果 10倍" },
        { id: "hao_4", name: "覇道の足跡", desc: "種類数x0.2を倍率加算" },
        { id: "hao_5", name: "終焉の号令", desc: "全遺物効果1.5倍" }
    ],
    "虚無": [
        { id: "kyomu_1", name: "忘却の彼方", desc: "基礎ATK+50%底上げ" },
        { id: "kyomu_2", name: "深淵の理", desc: "★合計100毎に倍率+1" },
        { id: "kyomu_3", name: "残滓の追撃", desc: "常に2回攻撃" },
        { id: "kyomu_4", name: "無に帰す一撃", desc: "倍率に(再起数/100)加算" },
        { id: "kyomu_5", name: "虚無の深淵", desc: "最後に倍率x3.0を乗算" }
    ]
};

// 遺物マスターデータ
const RELIC_MASTER = [];
for(let i=1; i<=53; i++) {
    RELIC_MASTER.push({
        id: `r_${i}`,
        name: `遺物 #${i}`,
        star: i <= 10 ? 1 : i <= 20 ? 2 : i <= 30 ? 3 : i <= 40 ? 4 : i <= 45 ? 5 : i <= 48 ? 6 : i <= 50 ? 7 : i <= 51 ? 8 : i <= 52 ? 9 : 10
    });
}

let player = {
    hp: 100,
    atk: 10,
    reincarnation: 0,
    relics: {},
    skills: {}
};

// --- 初期化・セーブ ---
function init() {
    const data = localStorage.getItem(SAVE_KEY);
    if (data) player = { ...player, ...JSON.parse(data) };
    renderSkills();
    updateUI();
}

function save() {
    localStorage.setItem(SAVE_KEY, JSON.stringify(player));
}

// --- UI描画 ---
function updateUI() {
    const stats = calculateStats();
    document.getElementById('hp-val').innerText = Math.floor(stats.maxHp).toLocaleString();
    document.getElementById('atk-val').innerText = Math.floor(stats.finalAtk).toLocaleString();
    document.getElementById('reinc-val').innerText = player.reincarnation.toLocaleString();
    
    const rList = document.getElementById('relic-list');
    rList.innerHTML = '';
    let count = 0;
    for (let id in player.relics) {
        if (player.relics[id] > 0) {
            count++;
            const r = RELIC_MASTER.find(m => m.id === id);
            const div = document.createElement('div');
            div.className = 'relic-item';
            div.innerText = `★${r.star} ${r.name}`;
            rList.appendChild(div);
        }
    }
    document.getElementById('relic-count').innerText = count;
}

function renderSkills() {
    const list = document.getElementById('skill-list');
    list.innerHTML = '';
    for (let cat in SKILL_DATA) {
        SKILL_DATA[cat].forEach(s => {
            const div = document.createElement('div');
            div.className = `skill-card ${player.skills[s.id] ? 'active' : ''}`;
            div.innerHTML = `<span class="skill-name">${s.name}</span>${s.desc}`;
            div.onclick = () => {
                player.skills[s.id] = !player.skills[s.id];
                save();
                updateUI();
                renderSkills();
            };
            list.appendChild(div);
        });
    }
}

// --- 最新ロジック計算 ---
function calculateStats() {
    let boost = player.skills["mado_2"] ? 1.5 : 1.0;
    let bAtk = player.skills["ken_1"] ? player.atk * (1 + 0.2 * boost) : player.atk;
    if (player.skills["kyomu_1"]) bAtk *= (1 + 0.5 * boost);
    let bHp = player.skills["fumu_1"] ? player.hp * (1 + 0.3 * boost) : player.hp;

    let rAtk = 0, rHp = 0, starTotal = 0, typeCount = 0, highRare = 0;
    for (let id in player.relics) {
        const num = player.relics[id];
        const r = RELIC_MASTER.find(m => m.id === id);
        typeCount++; starTotal += (r.star * num);
        if (r.star >= 5) highRare++;
        let p = r.star * num * 10;
        if (player.skills["hao_3"] && r.star <= 3) p *= (10 * boost);
        if (player.skills["hao_5"]) p *= (1.5 * boost);
        if (player.skills["mado_4"]) p *= (1.2 * boost);
        rAtk += p; rHp += p * 5;
    }
    if (player.skills["mado_1"]) { rAtk *= (1.2 * boost); rHp *= (1.2 * boost); }
    
    let curAtk = bAtk + rAtk;
    let maxHp = bHp + rHp;
    if (player.skills["hao_1"]) curAtk += (starTotal * 100 * boost);

    let mult = 1.0;
    if (player.skills["ken_2"]) mult += (typeCount * 0.05 * boost);
    if (player.skills["ken_3"]) mult += (player.reincarnation * 0.01 * boost);
    if (player.skills["hao_2"]) mult += (highRare * 0.5 * boost);
    if (player.skills["hao_4"]) mult += (typeCount * 0.2 * boost);
    if (player.skills["kyomu_2"]) mult += (Math.floor(starTotal / 100) * 1.0 * boost);
    if (player.skills["kyomu_4"]) mult += (player.reincarnation / 100 * boost);

    if (player.skills["ken_5"]) mult *= (5.0 * boost);
    if (player.skills["kyomu_5"]) mult *= (3.0 * boost);

    let finalAtk = curAtk * mult;
    if (player.skills["kyomu_3"]) finalAtk *= 2;
    if (player.skills["ken_4"]) finalAtk *= 2;
    
    return { finalAtk, maxHp };
}

function executeReincarnation() {
    const s = calculateStats();
    addLog(`勇者の攻撃！魔神に ${Math.floor(s.finalAtk).toLocaleString()} ダメージ！`);
    addLog(`魔神の反撃：${MAJIN_ATK.toLocaleString()} ダメージ！`);
    addLog(`<span style="color:#e74c3c">勇者は力尽きた...</span>`);
    addLog(`<span style="color:var(--accent-color)">再起の誓いによって新たなる力を得た</span>`);

    player.reincarnation++;
    let b = player.skills["fumu_2"] ? 1.5 : 1.0;
    player.atk += 5 * b; player.hp += 50 * b;

    let dCount = player.skills["mado_3"] ? 2 : 1;
    for(let i=0; i<dCount; i++) {
        const r = RELIC_MASTER[Math.floor(Math.random() * RELIC_MASTER.length)];
        player.relics[r.id] = (player.relics[r.id] || 0) + 1;
        addLog(`遺物：[${r.name}] 獲得`);
    }
    save(); updateUI();
}

function addLog(m) {
    const c = document.getElementById('log-container');
    const d = document.createElement('div');
    d.className = 'log-entry'; d.innerHTML = m;
    c.prepend(d);
}

init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root { --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6; --primary: #007bff; --text: #212529; --hp: #28a745; --stamina: #ffc107; }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 15px 0; border: none; background: none; color: #6c757d; font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #main-content { flex-grow: 1; overflow-y: auto; position: relative; }
    .tab { display: none; padding: 15px; min-height: 100%; box-sizing: border-box; }
    .tab.active { display: block; padding-bottom: 100px; }
    .bar-container { margin-bottom: 6px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; }
    .bar { height: 10px; background: #eee; border-radius: 5px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 12px; }
    .btn-attack { width: 100%; padding: 25px; background: var(--primary); color: #fff; font-size: 1.2em; font-weight: bold; border: none; border-radius: 12px; margin-bottom: 15px; cursor: pointer; touch-action: manipulation; }
    #log { font-size: 0.8em; background: #fafafa; padding: 10px; border: 1px solid var(--border); border-radius: 8px; height: 200px; overflow-y: auto; }
</style>
</head>
<body>
<div id="header">
    <div class="bar-label"><span>魔神 (不滅)</span><span id="total-dmg">累計ダメージ: 0</span></div>
    <div class="bar-container">
        <div class="bar-label"><span>HP</span><span id="playerhp-text">100/100</span></div>
        <div class="bar"><div id="playerhp" class="fill" style="background:var(--hp); width:100%"></div></div>
    </div>
    <div class="bar-container">
        <div class="bar-label"><span>体力</span><span id="playerstamina-text">100/100</span></div>
        <div class="bar"><div id="playerstamina" class="fill" style="background:var(--stamina); width:100%"></div></div>
    </div>
    <div style="font-size:0.8em; margin-top:5px; font-weight:bold;">
        Lv: <span id="p-lv">1</span> | 次まで: <span id="p-exp">0</span>% | ATK: <span id="p-atk">0</span> | 再起: <span id="p-death">0</span>
    </div>
</div>
<div class="nav">
    <button onclick="showTab('battle', this)" class="active">討伐</button>
    <button onclick="showTab('status', this)">能力</button>
    <button onclick="showTab('power', this)">権能</button>
    <button onclick="showTab('relic', this)">遺物</button>
</div>
<div id="main-content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">魔神を削る</button><div id="log"></div></div>
    <div id="status" class="tab"></div>
    <div id="power" class="tab"></div>
    <div id="relic" class="tab"></div>
</div>
<script>
let p = { lv: 1, exp: 0, hp: 100, maxHP: 100, stamina: 100, maxStamina: 100, inventory: {}, deathCount: 0, totalDmg: 0 };
let maxDmgDealt = 0, isPressing = false;
const POWER_NAMES = ["剣神の残火","不滅の守護者","魔導王の遺志","覇王の残光","絶影の残影","修羅の咆哮","真理の残滓","神託 of 残響","虚無の深淵","機工の心臓"];

function init() {
    for(let i=0; i<100; i++) p.inventory[i] = (i%10 < 5) ? 1 : 0;
    const btn = document.getElementById("attackBtn");
    btn.addEventListener("mousedown", () => isPressing = true);
    window.addEventListener("mouseup", () => isPressing = false);
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); isPressing = true; });
    window.addEventListener("touchend", () => isPressing = false);
    setInterval(() => { if(isPressing) attack(); }, 100);
    setInterval(() => { attack(true); }, 1000); // 自動
    refreshUI();
}

function attack(isAuto = false) {
    if(!isAuto && p.stamina <= 0) return;
    let dmg = (10 + p.lv * 5) * (isPressing ? 2 : 1);
    if(Math.random() < 0.1) dmg *= 10;
    
    p.totalDmg += dmg;
    if(dmg > maxDmgDealt) maxDmgDealt = dmg;
    if(!isAuto) p.stamina = Math.max(0, p.stamina - 1);

    // ダメージに応じた経験値と遺物
    p.exp += (dmg / (p.lv * 100));
    if(p.exp >= 100) { p.lv++; p.exp = 0; addLog(`<b>Lv UP! レベル ${p.lv} に到達。</b>`); }
    if(Math.random() < 0.05) {
        let id = Math.floor(Math.random() * 5); // ⭐︎1-5のみ
        p.inventory[id]++;
        addLog(`<span style="color:var(--stamina)">遺物を獲得した。</span>`);
    }

    if(!isAuto || Math.random() < 0.1) addLog(`${isAuto?'[自動] ':''}魔神から ${Math.floor(dmg).toLocaleString()} ダメージ分を奪い取った。`);
    
    // 即死攻撃 (再起)
    if(!isAuto && Math.random() < 0.05) {
        p.deathCount++; p.stamina = p.maxStamina;
        addLog(`<span style="color:red">魔神の反撃！即死し、再起した。</span>`);
    }
    refreshUI();
}

function refreshUI() {
    document.getElementById("total-dmg").innerText = `累計ダメージ: ${Math.floor(p.totalDmg).toLocaleString()}`;
    document.getElementById("playerstamina").style.width = (p.stamina / p.maxStamina * 100) + "%";
    document.getElementById("playerstamina-text").innerText = `${p.stamina}/${p.maxStamina}`;
    document.getElementById("p-lv").innerText = p.lv;
    document.getElementById("p-exp").innerText = Math.floor(p.exp);
    document.getElementById("p-atk").innerText = Math.floor(10 + p.lv * 5).toLocaleString();
    document.getElementById("p-death").innerText = p.deathCount;
    if(document.activeTab === 'status') renderStatus();
    if(document.activeTab === 'relic') renderRelic();
}

function showTab(id, btn) {
    document.activeTab = id;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    refreshUI();
}

function renderStatus() {
    document.getElementById("status").innerHTML = `<div class="card-cell">Lv: ${p.lv}<br>再起数: ${p.deathCount}<br>最大ダメージ: ${Math.floor(maxDmgDealt).toLocaleString()}</div>`;
}

function renderRelic() {
    let h = "";
    for(let i in p.inventory) if(p.inventory[i] > 0) h += `<div class="card-cell">遺物ID ${i}: ${p.inventory[i]}個</div>`;
    document.getElementById("relic").innerHTML = h || "なし";
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 20) l.removeChild(l.lastChild);
}
init();
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic_full_potential</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --hp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; }
    .nav button { flex: 1; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.8em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .bar-container { margin-bottom: 4px; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: var(--hp); }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 10px; }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.1em; font-weight: bold; border: none; border-radius: 8px; }
    #log { font-size: 0.7em; background: #fdfdfd; padding: 8px; border: 1px solid var(--border); border-radius: 6px; height: 250px; overflow-y: auto; }
    .dmg-highlight { color: #dc3545; font-size: 1.2em; font-weight: bold; }
    .skill-trigger { color: #28a745; font-size: 0.85em; font-weight: bold; }
    .auto-attack { color: #007bff; font-weight: bold; }
</style>
</head>
<body>
<div id="header">
    <div style="display:flex; justify-content:space-between; font-size:0.8em; font-weight:bold;"><span>魔神 HP</span><span id="bosshp-text">100%</span></div>
    <div class="bar"><div id="bosshp" class="fill"></div></div>
    <div style="margin-top:5px; font-size:0.8em;">ATK: <span id="sum-atk">0</span> | 再起: <span id="death-count">0</span></div>
</div>
<div class="nav">
    <button onclick="showTab('battle', this)" class="active">討伐</button>
    <button onclick="showTab('status', this)">能力</button>
    <button onclick="showTab('power', this)">権能</button>
    <button onclick="showTab('relic', this)">遺物</button>
</div>
<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">魔神に攻撃</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="power" class="tab"><div id="powerList"></div></div>
    <div id="relic" class="tab"><div id="relicList"></div></div>
</div>
<script>
const BOSS_MAX_HP = 1e20;
const POWER_NAMES = ["剣神の残火","不滅の守護者","魔導王の遺志","覇王の残光","絶影の残影","修羅の咆哮","真理の残滓","神託の残響","虚無の深淵","機工の心臓"];
const SKILL_NAMES = [
    ["一の太刀","燕返し","心眼","無想","天断","神速","流星","真空","極・一文字","剣神降臨"],
    ["不屈","再生の楔","逆境の理","不死の魂","守護神の誇り","金剛の体","鉄壁の構え","報復の棘","絶望への抗い","不滅の聖域"],
    ["魔力導線","術式展開","詠唱破棄","多重構築","深淵の知恵","魔導の極致","元素爆発","真理の門","賢者の石","魔導王の再臨"],
    ["威圧","王の進軍","凱旋の鬨","統率の才","覇王の盾","黄金の夜明け","天をも統べる","不抜の城塞","絶対王政","至高の御座"],
    ["急所穿ち","影走り","死の刻印","虚像の舞","暗殺者の誇り","刹那の閃き","闇に溶ける","絶影の連撃","魂の収穫","虚無の終焉"],
    ["狂乱","血戦の契り","屠殺の牙","闘神の血","修羅の道","飽くなき闘争","憤怒の波動","鬼神の連撃","命を喰らう","冥府の王"],
    ["等価交換","因果の糸","世界の記憶","理の改変","根源の理解","虚構の崩壊","天の秤","知識の激流","運命の断罪","神の数式"],
    ["祈り","聖なる光","天使の加護","奇跡の予兆","天啓の調べ","聖域の盾","神の審判","福音の響き","至福の時","主の御手"],
    ["忘却","影の浸食","暗黒の底","空虚な夢","存在の否定","無への還元","深淵の眼","終焉の予言","滅びの歌","絶対零"],
    ["歯車の回転","過負荷の熱","精密演算","鋼鉄の意志","自動修復","蒸気の噴進","機工の連鎖","次元の歯車","神の設計図","究極の機構"]
];

let p, currentBossHP = BOSS_MAX_HP, longPressInterval = null, isPressing = false;
let autoAttackInterval = null;

function init() {
    // 全スキル習得状態（遺物各5000個）
    let debugInv = {};
    for(let i=0; i<100; i++) debugInv[i] = 5000;
    p = { lv: 100, inventory: debugInv, deathCount: 0 };
    
    document.getElementById("attackBtn").addEventListener("mousedown", () => isPressing = true);
    document.getElementById("attackBtn").addEventListener("mouseup", () => isPressing = false);
    document.getElementById("attackBtn").addEventListener("touchstart", (e) => { e.preventDefault(); isPressing = true; });
    document.getElementById("attackBtn").addEventListener("touchend", () => isPressing = false);
    
    // 通常攻撃ループ (100ms)
    setInterval(() => { if(isPressing) battle(false); }, 100);
    // 「主の御手」による自動神速攻撃 (10ms)
    setInterval(() => { battle(true); }, 10);
    
    refresh();
}

function battle(isAuto) {
    let activeLogs = [];
    let mageMult = 2; // 魔導王の再臨（常時2倍）
    let totalMult = 1;
    let baseAtk = 10 + (p.lv * 5000 * mageMult); // 至高の御座込み
    
    // 確率発動スキル判定
    if (Math.random() < 0.1) { totalMult *= 10000; activeLogs.push("運命の断罪"); }
    if (Math.random() < 0.2) { totalMult *= 5; activeLogs.push("燕返し"); }
    if (Math.random() < 0.25) { totalMult *= 2; activeLogs.push("詠唱破棄"); }
    
    // 条件発動
    if (isPressing) { totalMult *= (10 * mageMult); activeLogs.push("飽くなき闘争"); }
    if (isAuto) { activeLogs.push("主の御手"); }

    let dmg = baseAtk * (1 + p.deathCount * 0.001) * totalMult;
    
    // 虚構の崩壊 (割合)
    const propDmg = BOSS_MAX_HP * 0.00000001;
    dmg += propDmg;

    currentBossHP -= dmg;
    if(currentBossHP < 0) currentBossHP = 0;

    // ログの単調さを防ぐ（自動攻撃時はログを制限し、重い一撃や特殊発動時のみ強調）
    if (!isAuto || Math.random() < 0.05) {
        let skillStr = activeLogs.length > 0 ? `<span class="skill-trigger">【${activeLogs.join("・")}】</span> ` : "";
        let prefix = isAuto ? `<span class="auto-attack">[自動]</span> ` : "";
        addLog(`${prefix}${skillStr}魔神に <span class="dmg-highlight">${Math.floor(dmg).toLocaleString()}</span> ダメージ！`);
    }

    if (!isAuto) {
        addLog(`<span style="color:red">即死攻撃を「聖域の盾」で耐え、再起した。</span>`);
        p.deathCount++;
    }
    refresh();
}

function refresh() {
    document.getElementById("bosshp").style.width = (currentBossHP / BOSS_MAX_HP * 100) + "%";
    document.getElementById("bosshp-text").innerText = (currentBossHP / BOSS_MAX_HP * 100).toFixed(6) + "%";
    document.getElementById("sum-atk").innerText = "測定不能(インフレ中)";
    document.getElementById("death-count").innerText = p.deathCount;
    if(document.activeTab === 'power') renderPower();
}

function renderPower() {
    document.getElementById("powerList").innerHTML = POWER_NAMES.map((name, idx) => `
        <div class="card-cell">
            <b>${name}</b>
            <div class="skill-list">
                ${SKILL_NAMES[idx].map(s => `<div class="skill-item skill-unlocked">${s}</div>`).join("")}
            </div>
        </div>
    `).join("");
}

function showTab(id, btn) {
    document.activeTab = id;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    refresh();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if(l.childNodes.length > 40) l.removeChild(l.lastChild);
}

init();
</script>
</body>
</html>

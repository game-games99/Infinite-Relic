<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>infiniterelic</title>
<style>
    :root {
        --bg: #ffffff; --panel: #f8f9fa; --border: #dee2e6;
        --primary: #007bff; --text: #212529; --sub: #6c757d;
        --accent: #dc3545; --gold: #d39e00; --hp: #28a745;
    }
    body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
    #header { background: var(--panel); padding: 10px; border-bottom: 2px solid var(--border); flex-shrink: 0; }
    .nav { display: flex; background: var(--panel); border-bottom: 1px solid var(--border); flex-shrink: 0; overflow-x: auto; }
    .nav button { flex: 1; min-width: 80px; padding: 12px 0; border: none; background: none; color: var(--sub); font-weight: bold; font-size: 0.75em; cursor: pointer; }
    .nav button.active { color: var(--primary); border-bottom: 3px solid var(--primary); background: #fff; }
    #content { flex-grow: 1; overflow: hidden; position: relative; background: #fff; }
    .tab { display: none; padding: 10px; height: 100%; box-sizing: border-box; overflow-y: auto; }
    .tab.active { display: block; }
    .bar-container { margin-bottom: 4px; }
    .bar-label { display: flex; justify-content: space-between; font-size: 0.75em; font-weight: bold; }
    .bar { height: 8px; background: #eee; border-radius: 4px; overflow: hidden; }
    .fill { height: 100%; transition: width 0.1s ease; }
    #bosshp { background: linear-gradient(90deg, #ffc107, #dc3545); }
    #playerhp { background: var(--hp); }
    #exp-bar { background: var(--primary); }
    .stats-summary { margin-top: 6px; background: rgba(0,0,0,0.03); padding: 8px; border-radius: 4px; font-size: 0.8em; }
    .card-cell { background: #fff; border: 1px solid var(--border); padding: 12px; border-radius: 8px; margin-bottom: 10px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
    .skill-list { display: grid; grid-template-columns: 1fr 1fr; gap: 4px; margin-top: 8px; }
    .skill-item { font-size: 0.52em; padding: 4px; border-radius: 4px; background: #f1f3f5; border-left: 2px solid var(--border); color: #888; line-height: 1.2; }
    .skill-unlocked { border-left-color: var(--primary); background: #e7f5ff; color: #000; font-weight: bold; }
    .btn-attack { width: 100%; padding: 20px; background: var(--primary); color: #fff; font-size: 1.1em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; margin-bottom: 10px; }
    #log { font-size: 0.75em; background: #fdfdfd; padding: 8px; border: 1px solid var(--border); border-radius: 6px; height: 150px; overflow-y: auto; }
    .status-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; font-size: 0.9em; }
    .relic-effect { font-size: 0.75em; color: var(--hp); font-weight: bold; margin-top: 4px; }
    .unique-tag { background: var(--accent); color: #fff; font-size: 0.7em; padding: 1px 4px; border-radius: 3px; margin-left: 5px; font-weight: normal; }
</style>
</head>
<body>
<div id="header">
    <div class="bar-container"><div class="bar-label"><span>é­”ç¥</span><span id="bosshp-text">100%</span></div><div class="bar"><div id="bosshp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span>HP</span><span id="playerhp-text">0/0</span></div><div class="bar"><div id="playerhp" class="fill"></div></div></div>
    <div class="bar-container"><div class="bar-label"><span id="p-lv-text">Lv.1</span><span id="exp-text">0%</span></div><div class="bar"><div id="exp-bar" class="fill"></div></div></div>
    <div class="stats-summary"><div style="display:flex; justify-content:space-between;"><span>ATK:</span><span id="sum-atk">0</span></div></div>
</div>
<div class="nav">
    <button onclick="showTab('battle', this)" class="active">è¨ä¼</button>
    <button onclick="showTab('status', this)">èƒ½åŠ›</button>
    <button onclick="showTab('power', this)">æ¨©èƒ½</button>
    <button onclick="showTab('relic', this)">éºç‰©</button>
</div>
<div id="content">
    <div id="battle" class="tab active"><button class="btn-attack" id="attackBtn">é­”ç¥ã«æ”»æ’ƒ</button><div id="log"></div></div>
    <div id="status" class="tab"><div id="statusList"></div></div>
    <div id="power" class="tab"><div id="powerList"></div></div>
    <div id="relic" class="tab"><div id="relicList"></div></div>
</div>
<script>
const BOSS_MAX_HP = 1e20;
const SAVE_KEY = "MAJIN_DPS_V8_RESET";
const RELIC_GRADES = ["æ¬ ç‰‡", "å¿ƒå¾—", "è¨˜æ†¶", "æ¥µæ„", "é­‚", "ç¥åŸŸ", "æ·±æ·µ", "è™šç„¡", "çœŸç†", "è¶…è¶Š"];
const STEPS = [10, 50, 150, 300, 500, 800, 1200, 2000, 3500, 5000];
const POWER_NAMES = ["å‰£ç¥ã®æ®‹ç«","ä¸æ»…ã®å®ˆè­·è€…","é­”å°ç‹ã®éºå¿—","è¦‡ç‹ã®æ®‹å…‰","çµ¶å½±ã®æ®‹å½±","ä¿®ç¾…ã®å’†å“®","çœŸç†ã®æ®‹æ»“","ç¥è¨—ã®æ®‹éŸ¿","è™šç„¡ã®æ·±æ·µ","æ©Ÿå·¥ã®å¿ƒè‡“"];

const SKILL_MASTER = {
    "å‰£ç¥ã®æ®‹ç«": [{n:"ä¸€ã®å¤ªåˆ€", e:"ATK 5å€"}, {n:"ç‡•è¿”ã—", e:"è¿½æ’ƒç‡+30%"}, {n:"å¿ƒçœ¼", e:"ã‚¯ãƒªç‡+40%"}, {n:"ç„¡æƒ³", e:"ã‚¯ãƒªå¨åŠ›10å€"}, {n:"å¤©æ–­", e:"1000å€æ’ƒ"}, {n:"ç¥é€Ÿ", e:"é€Ÿåº¦2å€"}, {n:"æµæ˜Ÿ", e:"ãƒ’ãƒƒãƒˆ+5"}, {n:"çœŸç©º", e:"ATK 20å€"}, {n:"æ¥µãƒ»ä¸€æ–‡å­—", e:"ã‚¯ãƒª100%"}, {n:"å‰£ç¥é™è‡¨", e:"ãƒ€ãƒ¡1ä¸‡å€"}],
    "ä¸æ»…ã®å®ˆè­·è€…": [{n:"ä¸å±ˆ", e:"å†èµ·+5000"}, {n:"å†ç”Ÿã®æ¥”", e:"HPå›å¾©10%"}, {n:"é€†å¢ƒã®ç†", e:"HPæ¸›ã§ATKå€"}, {n:"ä¸æ­»ã®é­‚", e:"å³æ­»è€æ€§"}, {n:"å®ˆè­·ç¥ã®èª‡ã‚Š", e:"ATK 10å€"}, {n:"é‡‘å‰›ã®ä½“", e:"HP 100å€"}, {n:"é‰„å£ã®æ§‹ãˆ", e:"è¢«ãƒ€ãƒ¡æ¿€æ¸›"}, {n:"å ±å¾©ã®æ£˜", e:"åå°„100å€"}, {n:"çµ¶æœ›ã¸ã®æŠ—ã„", e:"å…¨è£œæ­£2å€"}, {n:"ä¸æ»…ã®è–åŸŸ", e:"ä¸æ­»èº«åŒ–"}],
    "é­”å°ç‹ã®éºå¿—": [{n:"é­”åŠ›å°ç·š", e:"éºç‰©ATK+10%"}, {n:"è¡“å¼å±•é–‹", e:"ATK 3å€"}, {n:"è© å”±ç ´æ£„", e:"é€Ÿåº¦1.5å€"}, {n:"å¤šé‡æ§‹ç¯‰", e:"ãƒ’ãƒƒãƒˆ+2"}, {n:"æ·±æ·µã®çŸ¥æµ", e:"EXP 2å€"}, {n:"é­”å°ã®æ¥µè‡´", e:"ATK 30å€"}, {n:"å…ƒç´ çˆ†ç™º", e:"ç¯„å›²ãƒ€ãƒ¡"}, {n:"çœŸç†ã®é–€", e:"å…¨ã‚¹ã‚­å¼·åŒ–"}, {n:"è³¢è€…ã®çŸ³", e:"éºç‰©æ•°ATK"}, {n:"é­”å°ç‹ã®å†è‡¨", e:"é­”åŠ›ç„¡é™"}],
    "è¦‡ç‹ã®æ®‹å…‰": [{n:"å¨åœ§", e:"æ•µå¼±ä½“åŒ–"}, {n:"ç‹ã®é€²è»", e:"ATK 8å€"}, {n:"å‡±æ—‹ã®é¬¨", e:"EXP 5å€"}, {n:"çµ±ç‡ã®æ‰", e:"éºç‰©ATK+50%"}, {n:"è¦‡ç‹ã®ç›¾", e:"HP 10å€"}, {n:"é»„é‡‘ã®å¤œæ˜ã‘", e:"å…¨ãƒ€ãƒ¡50å€"}, {n:"å¤©ã‚’ã‚‚çµ±ã¹ã‚‹", e:"ãƒ’ãƒƒãƒˆ+10"}, {n:"ä¸æŠœã®åŸå¡", e:"å®Œå…¨é˜²å¾¡"}, {n:"çµ¶å¯¾ç‹æ”¿", e:"ATK 500å€"}, {n:"è‡³é«˜ã®å¾¡åº§", e:"è¦‡é“æ¥µè‡´"}],
    "çµ¶å½±ã®æ®‹å½±": [{n:"æ€¥æ‰€ç©¿ã¡", e:"ã‚¯ãƒªå¨åŠ›5å€"}, {n:"å½±èµ°ã‚Š", e:"å›é¿+50%"}, {n:"æ­»ã®åˆ»å°", e:"å‰²åˆãƒ€ãƒ¡"}, {n:"è™šåƒã®èˆ", e:"é€Ÿåº¦5å€"}, {n:"æš—æ®ºè€…ã®èª‡ã‚Š", e:"ATK 15å€"}, {n:"åˆ¹é‚£ã®é–ƒã", e:"å³æ­»ä»˜ä¸"}, {n:"é—‡ã«æº¶ã‘ã‚‹", e:"ç„¡æ•µåŒ–"}, {n:"çµ¶å½±ã®é€£æ’ƒ", e:"ãƒ’ãƒƒãƒˆ+20"}, {n:"é­‚ã®åç©«", e:"æ’ƒç ´ATKå¢—"}, {n:"è™šç„¡ã®çµ‚ç„‰", e:"ä¸€æ’ƒå¿…æ®º"}],
    "ä¿®ç¾…ã®å’†å“®": [{n:"ç‹‚ä¹±", e:"ATK 12å€"}, {n:"è¡€æˆ¦ã®å¥‘ã‚Š", e:"HPæ¶ˆè²»ATKå¢—"}, {n:"å± æ®ºã®ç‰™", e:"ã‚¯ãƒªç‡+20%"}, {n:"é—˜ç¥ã®è¡€", e:"å†èµ·ATK+10%"}, {n:"ä¿®ç¾…ã®é“", e:"é€Ÿåº¦3å€"}, {n:"é£½ããªãé—˜äº‰", e:"é€£æ’ƒæ•°å¢—åŠ "}, {n:"æ†¤æ€’ã®æ³¢å‹•", e:"å…¨ä½“ãƒ€ãƒ¡"}, {n:"é¬¼ç¥ã®é€£æ’ƒ", e:"ãƒ’ãƒƒãƒˆ+15"}, {n:"å‘½ã‚’å–°ã‚‰ã†", e:"å¸å10%"}, {n:"å†¥åºœã®ç‹", e:"ä¿®ç¾…è¦šé†’"}],
    "çœŸç†ã®æ®‹æ»“": [{n:"ç­‰ä¾¡äº¤æ›", e:"EXPã‚’ATKã¸"}, {n:"å› æœã®ç³¸", e:"ãƒ€ãƒ¡2å€åè»¢"}, {n:"ä¸–ç•Œã®è¨˜æ†¶", e:"éºç‰©ATK100%"}, {n:"ç†ã®æ”¹å¤‰", e:"ã‚¯ãƒªç¢ºå®š"}, {n:"æ ¹æºã®ç†è§£", e:"ATK 100å€"}, {n:"è™šæ§‹ã®å´©å£Š", e:"é˜²å¾¡ç„¡è¦–"}, {n:"å¤©ã®ç§¤", e:"ãƒãƒ©ãƒ³ã‚¹èª¿æ•´"}, {n:"çŸ¥è­˜ã®æ¿€æµ", e:"é€Ÿåº¦10å€"}, {n:"é‹å‘½ã®æ–­ç½ª", e:"ãƒ€ãƒ¡1000å€"}, {n:"ç¥ã®æ•°å¼", e:"çœŸç†åˆ°é”"}],
    "ç¥è¨—ã®æ®‹éŸ¿": [{n:"ç¥ˆã‚Š", e:"å…¨å›å¾©"}, {n:"è–ãªã‚‹å…‰", e:"ATK 4å€"}, {n:"å¤©ä½¿ã®åŠ è­·", e:"è¢«ãƒ€ãƒ¡åŠæ¸›"}, {n:"å¥‡è·¡ã®äºˆå…†", e:"ãƒ‰ãƒ­ãƒƒãƒ—ç‡UP"}, {n:"å¤©å•“ã®èª¿ã¹", e:"å…¨ã‚¹ãƒ†1.5å€"}, {n:"è–åŸŸã®ç›¾", e:"çŠ¶æ…‹ç•°å¸¸ç„¡åŠ¹"}, {n:"ç¥ã®å¯©åˆ¤", e:"å…‰ãƒ€ãƒ¡"}, {n:"ç¦éŸ³ã®éŸ¿ã", e:"å†èµ·æ•°Ã—10ATK"}, {n:"è‡³ç¦ã®æ™‚", e:"EXP 10å€"}, {n:"ä¸»ã®å¾¡æ‰‹", e:"ç¥è¨—æˆå°±"}],
    "è™šç„¡ã®æ·±æ·µ": [{n:"å¿˜å´", e:"æ•µHP 5%å‰Šã‚Š"}, {n:"å½±ã®æµ¸é£Ÿ", e:"ATK 7å€"}, {n:"æš—é»’ã®åº•", e:"é€Ÿåº¦æ¸›è¡°ç„¡è¦–"}, {n:"ç©ºè™šãªå¤¢", e:"ãƒ€ãƒ¡ç„¡åŠ¹"}, {n:"å­˜åœ¨ã®å¦å®š", e:"æ¶ˆæ»…ãƒ€ãƒ¡"}, {n:"ç„¡ã¸ã®é‚„å…ƒ", e:"å…¨ã‚¹ãƒ†ãƒªã‚»ãƒƒãƒˆ"}, {n:"æ·±æ·µã®çœ¼", e:"å¼±ç‚¹çœ‹ç ´"}, {n:"çµ‚ç„‰ã®äºˆè¨€", e:"ç§’æ®ºã‚«ã‚¦ãƒ³ãƒˆ"}, {n:"æ»…ã³ã®æ­Œ", e:"ATK 666å€"}, {n:"çµ¶å¯¾é›¶", e:"å®Œå…¨é™æ­¢"}],
    "æ©Ÿå·¥ã®å¿ƒè‡“": [{n:"æ­¯è»Šã®å›è»¢", e:"é€Ÿåº¦1.2å€"}, {n:"éè² è·ã®ç†±", e:"ATK 20å€"}, {n:"ç²¾å¯†æ¼”ç®—", e:"ã‚¯ãƒªç‡100%"}, {n:"é‹¼é‰„ã®æ„å¿—", e:"HP 5å€"}, {n:"è‡ªå‹•ä¿®å¾©", e:"æ¯ç§’å›å¾©"}, {n:"è’¸æ°—ã®å™´é€²", e:"ãƒ’ãƒƒãƒˆ+8"}, {n:"æ©Ÿå·¥ã®é€£é–", e:"é€£æ’ƒATKå¢—"}, {n:"æ¬¡å…ƒã®æ­¯è»Š", e:"æ™‚é–“æ“ä½œ"}, {n:"ç¥ã®è¨­è¨ˆå›³", e:"åŸºç¤ATK10å€"}, {n:"ç©¶æ¥µã®æ©Ÿæ§‹", e:"æ©Ÿå·¥ç¥åŒ–"}]
};

let p, currentBossHP = BOSS_MAX_HP, longPressInterval = null;

function init() {
    const saved = localStorage.getItem(SAVE_KEY);
    p = saved ? JSON.parse(saved) : { lv: 1, exp: 0, inventory: {}, deathCount: 0 };
    if (!p.inventory) p.inventory = {};
    const btn = document.getElementById("attackBtn");
    const start = (e) => { e.preventDefault(); if(!longPressInterval){ battle(); longPressInterval = setInterval(battle, 100); } };
    const stop = () => { if(longPressInterval){ clearInterval(longPressInterval); longPressInterval = null; } };
    btn.addEventListener("touchstart", start); btn.addEventListener("touchend", stop);
    btn.addEventListener("mousedown", start); btn.addEventListener("mouseup", stop); btn.addEventListener("mouseleave", stop);
    refresh();
}

function calcStats() {
    const maxHP = p.lv * 100 + 10;
    let relicAtkBonus = 0;
    Object.keys(p.inventory).forEach(id => {
        const grade = id % 10;
        const count = p.inventory[id];
        // â­ï¸6ä»¥ä¸Š(grade 5-9)ã¯1å€‹é™å®šã®è¶…å¼·åŠ›è£œæ­£
        const power = (grade < 5) ? (100 * (grade + 1) * count) : (200000 * (grade - 4));
        relicAtkBonus += power;
    });

    let s = { 
        maxHP: maxHP,
        baseAtk: 10 + (p.lv * 5) + relicAtkBonus, 
        deathM: 1 + (p.deathCount * 0.001), 
        multi: 1
    };
    
    if(getRelicCountByName("å‰£ç¥ã®æ®‹ç«") >= STEPS[0]) s.multi *= 1.5;
    s.finalAtk = s.baseAtk * s.deathM * s.multi;
    return s;
}

function getRelicCountByName(name) {
    const sIdx = POWER_NAMES.indexOf(name);
    let count = 0;
    for(let i=0; i<10; i++) count += (p.inventory[sIdx * 10 + i] || 0);
    return count;
}

function battle() {
    const s = calcStats();
    currentBossHP -= s.finalAtk;
    if(currentBossHP < 0) currentBossHP = 0;

    p.deathCount++;
    p.exp += 10 + (p.lv * 2);

    if (Math.random() < 0.2) {
        const rid = Math.floor(Math.random() * 100);
        const grade = rid % 10;
        // â­ï¸6ä»¥ä¸Šã¯ã€ŒæŒã£ã¦ã„ãªã‘ã‚Œã°ã€æ‰‹ã«å…¥ã‚‹è¨­å®š
        if(grade < 5 || !p.inventory[rid]) {
            p.inventory[rid] = (p.inventory[rid] || 0) + 1;
            const sysName = POWER_NAMES[Math.floor(rid/10)].split("ã®")[0];
            const color = grade >= 5 ? 'var(--accent)' : 'var(--gold)';
            addLog(`<span style="color:${color}">ğŸ’ â­ï¸${grade+1} ${sysName}ã®${RELIC_GRADES[grade]} ç²å¾—</span>`);
        }
    }

    const nextExp = p.lv * 50 + 100;
    while (p.exp >= nextExp) { p.exp -= nextExp; p.lv++; }
    refresh();
}

function refresh() {
    const s = calcStats();
    const nextExp = p.lv * 50 + 100;
    const bossPer = (currentBossHP / BOSS_MAX_HP * 100);
    document.getElementById("bosshp").style.width = bossPer + "%";
    document.getElementById("bosshp-text").innerText = bossPer.toFixed(6) + "%";
    document.getElementById("playerhp-text").innerText = `${Math.floor(s.maxHP)} / ${Math.floor(s.maxHP)}`;
    document.getElementById("playerhp").style.width = "100%";
    document.getElementById("exp-bar").style.width = (p.exp / nextExp * 100) + "%";
    document.getElementById("exp-text").innerText = Math.floor(p.exp / nextExp * 100) + "%";
    document.getElementById("p-lv-text").innerText = `Lv.${p.lv}`;
    document.getElementById("sum-atk").innerText = Math.floor(s.finalAtk).toLocaleString();

    if (document.activeTab === 'status') renderStatus(s);
    if (document.activeTab === 'power') renderPowers();
    if (document.activeTab === 'relic') renderRelics();
    localStorage.setItem(SAVE_KEY, JSON.stringify(p));
}

function renderStatus(s) {
    document.getElementById("statusList").innerHTML = `<div class="status-item"><span>æœ€å¤§HP</span><span>${Math.floor(s.maxHP)}</span></div><div class="status-item"><span>åŸºç¤æ”»æ’ƒåŠ›</span><span>${Math.floor(s.baseAtk)}</span></div><div class="status-item"><span>å†èµ·ã®èª“ã„</span><span>${p.deathCount} å›</span></div><div class="status-item"><span>æœ€çµ‚æ”»æ’ƒåŠ›</span><span>${Math.floor(s.finalAtk).toLocaleString()}</span></div>`;
}

function renderPowers() {
    document.getElementById("powerList").innerHTML = POWER_NAMES.map(name => {
        const count = getRelicCountByName(name);
        const skills = SKILL_MASTER[name];
        return `<div class="card-cell"><b>${name}</b> (éºç‰©:${count})<div class="skill-list">${skills.map((sk, i) => {
            const isUnlocked = count >= STEPS[i];
            return `<div class="skill-item ${isUnlocked ? 'skill-unlocked' : ''}">${isUnlocked ? sk.n : '???'}<br><small>${isUnlocked ? sk.e : STEPS[i]+'å€‹'}</small></div>`;
        }).join("")}</div></div>`;
    }).join("");
}

function renderRelics() {
    const ids = Object.keys(p.inventory).filter(id => p.inventory[id] > 0).sort((a,b)=>a-b);
    document.getElementById("relicList").innerHTML = ids.length ? ids.map(id => {
        const typeIdx = Math.floor(id / 10);
        const gradeIdx = id % 10;
        const baseName = POWER_NAMES[typeIdx].split("ã®")[0];
        const isUnique = gradeIdx >= 5;
        const effect = isUnique ? (200000 * (gradeIdx - 4)) : (100 * (gradeIdx + 1) * p.inventory[id]);
        return `<div class="card-cell"><div style="display:flex; justify-content:space-between;"><b>â­ï¸${gradeIdx + 1} ${baseName}ã®${RELIC_GRADES[gradeIdx]}${isUnique ? '<span class="unique-tag">å”¯ä¸€</span>' : ''}</b> <span>Ã—${p.inventory[id]}</span></div><div class="relic-effect">åŠ¹æœ: åŸºç¤ATK +${effect.toLocaleString()}</div></div>`;
    }).join("") : "<p style='text-align:center;'>éºç‰©ã¯æœªç™ºè¦‹</p>";
}

function showTab(id, btn) {
    document.activeTab = id;
    document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
    document.getElementById(id).classList.add("active");
    document.querySelectorAll(".nav button").forEach(b => b.classList.remove("active"));
    btn.classList.add("active");
    refresh();
}

function addLog(m) {
    const l = document.getElementById("log");
    const d = document.createElement("div"); d.innerHTML = m;
    l.prepend(d); if (l.childNodes.length > 20) l.removeChild(l.lastChild);
}
init();
</script>
</body>
</html>
